"use strict";(()=>{var nt="live2d-companion",Fi=`${nt}--mini`,qt=`${nt}__dragging`,It=`${nt}__content`,ei=`${It}__toggle-menu`,Yt=`${It}__words`,Tt=`${Yt}--visible`,At=`${It}__menu`,St=`${At}__hide`,bt=`${At}__switch`,ht=`${At}__toggle-words`,wt=`${At}__about`,at=`${At}__language`,pe=`${at}__toast`,ii=`${pe}--visible`,xt=`${nt}__reveal`,$i="disabled",Ht="open",Xs="https://github.com/mo-san/live2d-companion",Gs="https://github.com/mo-san/live2d-companion/blob/main/LICENSE",Ks="https://www.live2d.com/eula/live2d-open-software-license-agreement_en.html",Js="https://www.live2d.com/eula/live2d-proprietary-software-license-agreement_en.html",Ui=`<div class="${nt}">
  <div class="${It}" style="display: none;">
    <canvas></canvas>
    <div class="${Yt}"></div>
    <button class="${ei}"><div></div></button>
    <div class="${At}">
      <a class="${St}"><p></p></a>
      <a class="${bt}"><p></p></a>
      <a class="${ht}"><p></p></a>
      <div class="${at}">
        <p></p>
        <select></select>
        <div class="${pe}">Saved!</div>
      </div>
      <div class="${wt}"><p></p><ul>
        <li>Each Live2D model is copy&shy;righted by its respec&shy;tive author.</li>
        <li>This app (<b>Live2D Compa&shy;nion</b>) is under <a href="${Gs}">MIT Li&shy;cense</a>.<br>
            The source code is avail&shy;able on <a href="${Xs}">Github</a>.</li>
        <li><b>Cubism Web Frame&shy;work</b> is under <a href="${Ks}">Live2D Open Software Li&shy;cense Agree&shy;ment</a>.</li>
        <li><b>Live2D Cubism Core</b> is under <a href="${Js}">Live2D Pro&shy;prietary Software Li&shy;cense Agree&shy;ment</a>.</li>
      </div>
    </div>
  </div>
  <a class="${xt}"><p></p></a>
</div>`,ji="[Live2D-Companion] This browser does not support APIs for the app to run. Please consider using another newer browser.",zi="[Live2D-Companion] No models provided.";var Qs=300,Zs=300,si=250,fe="top",Xt="bottom",ye="left",_e="right";var tr="bottomright",er={x:0,y:0},ir="top";var Wi=10,qi=60,Yi=3,Hi=1,Xi=2,ri="unset",Gi={Idle:"Idle",TapBody:"TapBody"},ni={Head:"Head",Body:"Body"};var Ki=2,Ji="version",Lt="general",Et="datetime",kt="touch",Z="default",Vt=`${nt}-language`,Qi={version:"1",models:[],useCache:!0,modelVisible:!0,modelPosition:tr,slideInFrom:Xt,modelDistance:er,width:Qs,height:Zs,draggable:!0,wordsVisible:!0,wordsPosition:ir,words:[]};function ai(s){let t=new Blob([s],{type:"text/javascript"}),e=URL.createObjectURL(t),i=new Worker(e);return URL.revokeObjectURL(e),i}function oi(){return ai('"use strict";(()=>{var Jt="live2d-companion",vo=`${Jt}--mini`,So=`${Jt}__dragging`,Ye=`${Jt}__content`,Li=`${Ye}__toggle-menu`,Hr=`${Ye}__words`,Mo=`${Hr}--visible`,Kt=`${Ye}__menu`,Di=`${Kt}__hide`,Ni=`${Kt}__switch`,Oi=`${Kt}__toggle-words`,ki=`${Kt}__about`,Wr=`${Kt}__language`,qr=`${Wr}__toast`,Po=`${qr}--visible`,Ui=`${Jt}__reveal`;var zi="https://github.com/mo-san/live2d-companion",$i="https://github.com/mo-san/live2d-companion/blob/main/LICENSE",Gi="https://www.live2d.com/eula/live2d-open-software-license-agreement_en.html",Hi="https://www.live2d.com/eula/live2d-proprietary-software-license-agreement_en.html",Vo=`<div class="${Jt}">\n  <div class="${Ye}" style="display: none;">\n    <canvas></canvas>\n    <div class="${Hr}"></div>\n    <button class="${Li}"><div></div></button>\n    <div class="${Kt}">\n      <a class="${Di}"><p></p></a>\n      <a class="${Ni}"><p></p></a>\n      <a class="${Oi}"><p></p></a>\n      <div class="${Wr}">\n        <p></p>\n        <select></select>\n        <div class="${qr}">Saved!</div>\n      </div>\n      <div class="${ki}"><p></p><ul>\n        <li>Each Live2D model is copy&shy;righted by its respec&shy;tive author.</li>\n        <li>This app (<b>Live2D Compa&shy;nion</b>) is under <a href="${$i}">MIT Li&shy;cense</a>.<br>\n            The source code is avail&shy;able on <a href="${zi}">Github</a>.</li>\n        <li><b>Cubism Web Frame&shy;work</b> is under <a href="${Gi}">Live2D Open Software Li&shy;cense Agree&shy;ment</a>.</li>\n        <li><b>Live2D Cubism Core</b> is under <a href="${Hi}">Live2D Pro&shy;prietary Software Li&shy;cense Agree&shy;ment</a>.</li>\n      </div>\n    </div>\n  </div>\n  <a class="${Ui}"><p></p></a>\n</div>`;var Je="live2d-companion",jr="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js";var Xr={Idle:"Idle",TapBody:"TapBody"};var Te={None:0,Idle:1,Normal:2,Force:3};var Bo=`${Jt}-language`;var y=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"}),Wi;(V=>(V.HitAreaBody=y.HitAreaBody,V.HitAreaHead=y.HitAreaHead,V.HitAreaPrefix=y.HitAreaPrefix,V.ParamAngleX=y.ParamAngleX,V.ParamAngleY=y.ParamAngleY,V.ParamAngleZ=y.ParamAngleZ,V.ParamArmLA=y.ParamArmLA,V.ParamArmLB=y.ParamArmLB,V.ParamArmRA=y.ParamArmRA,V.ParamArmRB=y.ParamArmRB,V.ParamBaseX=y.ParamBaseX,V.ParamBaseY=y.ParamBaseY,V.ParamBodyAngleX=y.ParamBodyAngleX,V.ParamBodyAngleY=y.ParamBodyAngleY,V.ParamBodyAngleZ=y.ParamBodyAngleZ,V.ParamBreath=y.ParamBreath,V.ParamBrowLAngle=y.ParamBrowLAngle,V.ParamBrowLForm=y.ParamBrowLForm,V.ParamBrowLX=y.ParamBrowLX,V.ParamBrowLY=y.ParamBrowLY,V.ParamBrowRAngle=y.ParamBrowRAngle,V.ParamBrowRForm=y.ParamBrowRForm,V.ParamBrowRX=y.ParamBrowRX,V.ParamBrowRY=y.ParamBrowRY,V.ParamBustX=y.ParamBustX,V.ParamBustY=y.ParamBustY,V.ParamCheek=y.ParamCheek,V.ParamEyeBallForm=y.ParamEyeBallForm,V.ParamEyeBallX=y.ParamEyeBallX,V.ParamEyeBallY=y.ParamEyeBallY,V.ParamEyeLOpen=y.ParamEyeLOpen,V.ParamEyeLSmile=y.ParamEyeLSmile,V.ParamEyeROpen=y.ParamEyeROpen,V.ParamEyeRSmile=y.ParamEyeRSmile,V.ParamHairBack=y.ParamHairBack,V.ParamHairFluffy=y.ParamHairFluffy,V.ParamHairFront=y.ParamHairFront,V.ParamHairSide=y.ParamHairSide,V.ParamHandL=y.ParamHandL,V.ParamHandR=y.ParamHandR,V.ParamMouthForm=y.ParamMouthForm,V.ParamMouthOpenY=y.ParamMouthOpenY,V.ParamNONE=y.ParamNONE,V.ParamShoulderY=y.ParamShoulderY,V.PartsArmLPrefix=y.PartsArmLPrefix,V.PartsArmPrefix=y.PartsArmPrefix,V.PartsArmRPrefix=y.PartsArmRPrefix,V.PartsIdCore=y.PartsIdCore))(Wi||={});var Qt=class{},ji;(t=>t.ICubismModelSetting=Qt)(ji||={});var Ke=class{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){let e=new Array;for(let r=t;r<this._size;r++)e.push(this._ptr[r]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?Ke.s_defaultSize:this._capacity*2),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let i=0;i<t;i++)this._ptr[i]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,r=!0){if(this._size<t)if(this.prepareCapacity(t),r)for(let s=this._size;s<t;s++)typeof e=="function"?this._ptr[s]=JSON.parse(JSON.stringify(new e)):this._ptr[s]=e;else for(let s=this._size;s<t;s++)this._ptr[s]=e;else{let s=this._size-t;this._ptr.splice(this._size-s,s)}this._size=t}insert(t,e,r){let i=t._index,s=e._index,o=r._index,a=o-s;this.prepareCapacity(this._size+a);let u=this._size-i;if(u>0)for(let l=0;l<u;l++)this._ptr.splice(i+l,0,null);for(let l=s;l<o;l++,i++)this._ptr[i]=e._vector._ptr[l];this._size=this._size+a}remove(t){return t<0||this._size<=t?!1:(this._ptr.splice(t,1),--this._size,!0)}erase(t){let e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new et(this,e))}prepareCapacity(t){t>this._capacity&&(this._capacity==0?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return this._size==0?this.end():new et(this,0)}end(){return new et(this,this._size)}getOffset(t){let e=new Ke;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}},C=Ke;C.s_defaultSize=10;var et=class{constructor(t,e){this._vector=t??null,this._index=e??0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new et(this._vector,this._index++)}decrement(){return new et(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}},Yi;(e=>(e.csmVector=C,e.iterator=et))(Yi||={});var D=class{append(t,e){return this.s+=e!==void 0?t.substr(0,e):t,this}expansion(t,e){for(let r=0;r<t;r++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return this.s.length==0}constructor(t){this.s=t}},Ki;(t=>t.csmString=D)(Ki||={});var gt=class{getString(){return this._id}constructor(t){if(typeof t=="string"){this._id=new D(t);return}this._id=t}isEqual(t){return typeof t=="string"?this._id.isEqual(t):t instanceof D?this._id.isEqual(t.s):t instanceof gt?this._id.isEqual(t._id.s):!1}isNotEqual(t){return typeof t=="string"?!this._id.isEqual(t):t instanceof D?!this._id.isEqual(t.s):t instanceof gt?!this._id.isEqual(t._id.s):!1}},Zi;(t=>t.CubismId=gt)(Zi||={});var Zt=class{constructor(){this._ids=new C}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;if(typeof t=="string"){if((e=this.findId(t))!=null)return e;e=new gt(t),this._ids.pushBack(e)}else return this.registerId(t.s);return e}getId(t){return this.registerId(t)}isExist(t){return typeof t=="string"?this.findId(t)!=null:this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}},es;(t=>t.CubismIdManager=Zt)(es||={});var L=class{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,r){let i=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),s=4;for(let o=0;o<s;++o)for(let a=0;a<s;++a)for(let u=0;u<s;++u)i[a+o*4]+=t[u+o*4]*e[a+u*4];for(let o=0;o<16;++o)r[o]=i[o]}loadIdentity(){let t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){let r=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);L.multiply(r,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){let r=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);L.multiply(r,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){L.multiply(t.getArray(),this._tr,this._tr)}clone(){let t=new L;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}},is;(t=>t.CubismMatrix44=L)(is||={});var dt=class{static create(){return null}static delete(t){t=null}initialize(t){this._model=t}drawModel(){this.getModel()!=null&&this.doDrawModel()}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,r,i){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),r<0?r=0:r>1&&(r=1),i<0?i=0:i>1&&(i=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=r,this._modelColor.A=i}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new $,this._mvpMatrix4x4=new L,this._mvpMatrix4x4.loadIdentity()}},we=(r=>(r[r.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",r[r.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",r[r.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",r))(we||{}),$=class{constructor(){this.R=1,this.G=1,this.B=1,this.A=1}},ns;(r=>(r.CubismBlendMode=we,r.CubismRenderer=dt,r.CubismTextureColor=$))(ns||={});var ps=(n,t,e)=>{Ae.print(n,"[CSM]"+t,e)},O=(n,t,e)=>{ps(n,t+`\n`,e)},U=n=>{console.assert(n)},hs,St,W,Y,k;0<=0?(hs=(n,...t)=>{O(0,"[V]"+n,t)},St=(n,...t)=>{O(1,"[D]"+n,t)},W=(n,...t)=>{O(2,"[I]"+n,t)},Y=(n,...t)=>{O(3,"[W]"+n,t)},k=(n,...t)=>{O(4,"[E]"+n,t)}):0==1?(St=(n,...t)=>{O(1,"[D]"+n,t)},W=(n,...t)=>{O(2,"[I]"+n,t)},Y=(n,...t)=>{O(3,"[W]"+n,t)},k=(n,...t)=>{O(4,"[E]"+n,t)}):0==2?(W=(n,...t)=>{O(2,"[I]"+n,t)},Y=(n,...t)=>{O(3,"[W]"+n,t)},k=(n,...t)=>{O(4,"[E]"+n,t)}):0==3?(Y=(n,...t)=>{O(3,"[W]"+n,t)},k=(n,...t)=>{O(4,"[E]"+n,t)}):0==4&&(k=(n,...t)=>{O(4,"[E]"+n,t)});var Ae=class{static print(t,e,r){if(t<B.getLoggingLevel())return;let i=B.coreLogFunction;if(!i)return;let s=e.replace(/\\{(\\d+)\\}/g,(o,a)=>r[a]);i(s)}static dumpBytes(t,e,r){for(let i=0;i<r;i++)i%16==0&&i>0?this.print(t,`\n`):i%8==0&&i>0&&this.print(t,"  "),this.print(t,"{0} ",[e[i]&255]);this.print(t,`\n`)}constructor(){}},gs;(t=>t.CubismDebug=Ae)(gs||={});var Re=class{constructor(t,e){this.first=t??null,this.second=e??null}},Ze=class{constructor(t){t!=null?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new Re(t),this._size+=1}getValue(t){let e=-1;for(let r=0;r<this._size;r++)if(this._keyValues[r].first==t){e=r;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let r=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){r=i;break}r>=0?this._keyValues[r].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(this._keyValues.length==0?(!e&&t<Ze.DefaultSize&&(t=Ze.DefaultSize),this._keyValues.length=t):(!e&&t<this._keyValues.length*2&&(t=this._keyValues.length*2),this._keyValues.length=t))}begin(){return new rt(this,0)}end(){return new rt(this,this._size)}erase(t){let e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new rt(this,e))}dumpAsInt(){for(let t=0;t<this._size;t++)St("{0} ,",this._keyValues[t]),St(`\n`)}},N=Ze;N.DefaultSize=10;var rt=class{constructor(t,e){this._map=t??new N,this._index=e??0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new rt(this._map,this._index++)}decrement(){let t=new rt(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}},bs;(r=>(r.csmMap=N,r.csmPair=Re,r.iterator=rt))(bs||={});var Dt=class{static parseJsonObject(t,e){return Object.keys(t).forEach(r=>{typeof t[r]=="boolean"?e.put(r,new z(t[r])):typeof t[r]=="string"?e.put(r,new nt(t[r])):typeof t[r]=="number"?e.put(r,new Mt(t[r])):t[r]instanceof Array?e.put(r,Dt.parseJsonArray(t[r])):t[r]instanceof Object?e.put(r,Dt.parseJsonObject(t[r],new st)):t[r]==null?e.put(r,new it):e.put(r,t[r])}),e}static parseJsonArray(t){let e=new Nt;return Object.keys(t).forEach(r=>{let i=Number(r);if(typeof i=="number")typeof t[i]=="boolean"?e.add(new z(t[i])):typeof t[i]=="string"?e.add(new nt(t[i])):typeof t[i]=="number"?e.add(new Mt(t[i])):t[r]instanceof Array?e.add(this.parseJsonArray(t[r])):t[r]instanceof Object?e.add(this.parseJsonObject(t[r],new st)):t[r]==null?e.add(new it):e.add(t[r]);else if(t[r]instanceof Array)e.add(this.parseJsonArray(t[r]));else if(t[r]instanceof Object)e.add(this.parseJsonObject(t[r],new st));else if(t[r]==null)e.add(new it);else for(let s=0;s<t[r].length;s++)e.add(t[r][s])}),e}};var tr="Error: type mismatch",_s="Error: index out of bounds",w=class{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new C){return t}getMap(t){return t}getValueByIndex(t){return w.errorValue.setErrorNotForClientCall(tr)}getValueByString(t){return w.nullValue.setErrorNotForClientCall(tr)}getKeys(){return w.s_dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return Pt.errorValue}static staticInitializeNotForClientCall(){z.trueValue=new z(!0),z.falseValue=new z(!1),w.errorValue=new Pt("ERROR",!0),w.nullValue=new it,w.s_dummyKeys=new C}static staticReleaseNotForClientCall(){z.trueValue=null,z.falseValue=null,w.errorValue=null,w.nullValue=null,w.s_dummyKeys=null}},E=class{constructor(t,e){this._parseCallback=Dt.parseJsonObject;this._error=null,this._lineCount=0,this._root=null,t!=null&&this.parseBytes(t,e,this._parseCallback)}static create(t,e){let r=new E;return r.parseBytes(t,e,r._parseCallback)?r:(E.delete(r),null)}static delete(t){t=null}getRoot(){return this._root}static arrayBufferToString(t){let e=new Uint8Array(t),r="";for(let i=0,s=e.length;i<s;++i)r+="%"+this.pad(e[i].toString(16));return r=decodeURIComponent(r),r}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,e,r){let i=new Array(1),s=E.arrayBufferToString(t);if(r==null?this._root=this.parseValue(s,e,0,i):this._root=r(JSON.parse(s),new st),this._error){let o="\\0";return o="Json parse error : @line "+(this._lineCount+1)+`\n`,this._root=new nt(o),W("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new Pt(new D(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,r,i){if(this._error)return null;let s=null,o=r,a;for(;o<e;o++)switch(t[o]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{let l=new Array(1);return a=Yr(t.slice(o),l),i[0]=t.indexOf(l[0]),new Mt(a)}case\'"\':return new nt(this.parseString(t,e,o+1,i));case"[":return s=this.parseArray(t,e,o+1,i),s;case"{":return s=this.parseObject(t,e,o+1,i),s;case"n":return o+3<e?(s=new it,i[0]=o+4):this._error="parse null",s;case"t":return o+3<e?(s=z.trueValue,i[0]=o+4):this._error="parse true",s;case"f":return o+4<e?(s=z.falseValue,i[0]=o+5):this._error="illegal \',\' position",s;case",":return this._error="illegal \',\' position",null;case"]":return i[0]=o,null;case`\n`:this._lineCount++;case" ":case"	":case"\\r":default:break}return this._error="illegal end of value",null}parseString(t,e,r,i){if(this._error)return null;let s=r,o,a,u=new D(""),l=r;for(;s<e;s++)switch(o=t[s],o){case\'"\':return i[0]=s+1,u.append(t.slice(l),s-l),u.s;case"//":if(s++,s-1>l&&u.append(t.slice(l),s-l),l=s+1,s<e)switch(a=t[s],a){case"\\\\":u.expansion(1,"\\\\");break;case\'"\':u.expansion(1,\'"\');break;case"/":u.expansion(1,"/");break;case"b":u.expansion(1,"\\b");break;case"f":u.expansion(1,"\\f");break;case"n":u.expansion(1,`\n`);break;case"r":u.expansion(1,"\\r");break;case"t":u.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break;default:break}else this._error="parse string/escape error";default:break}return this._error="parse string/illegal end",null}parseObject(t,e,r,i){if(this._error)return null;let s=new st,o="",a=r,u="",l=Array(1),c=!1;for(;a<e;a++){t:for(;a<e;a++)switch(u=t[a],u){case\'"\':if(o=this.parseString(t,e,a+1,l),this._error)return null;a=l[0],c=!0;break t;case"}":return i[0]=a+1,s;case":":this._error="illegal \':\' position";break;case`\n`:this._lineCount++;default:break}if(!c)return this._error="key not found",null;c=!1;t:for(;a<e;a++)switch(u=t[a],u){case":":c=!0,a++;break t;case"}":this._error="illegal \'}\' position";break;case`\n`:this._lineCount++;default:break}if(!c)return this._error="\':\' not found",null;let p=this.parseValue(t,e,a,l);if(this._error)return null;a=l[0],s.put(o,p);t:for(;a<e;a++)switch(u=t[a],u){case",":break t;case"}":return i[0]=a+1,s;case`\n`:this._lineCount++;default:break}}return this._error="illegal end of perseObject",null}parseArray(t,e,r,i){if(this._error)return null;let s=new Nt,o=r,a,u=new Array(1);for(;o<e;o++){let l=this.parseValue(t,e,o,u);if(this._error)return null;o=u[0],l&&s.add(l);t:for(;o<e;o++)switch(a=t[o],a){case",":break t;case"]":return i[0]=o+1,s;case`\n`:++this._lineCount;default:break}}return s=void 0,this._error="illegal end of parseObject",null}},Mt=class extends w{constructor(e){super();this._value=e}isFloat(){return!0}getString(e,r){let i="\\0";return this._value=parseFloat(i),this._stringBuffer=i,this._stringBuffer}toInt(e=0){return parseInt(this._value.toString())}toFloat(e=0){return this._value}equals(e){return typeof e=="number"?Math.round(e)?!1:e==this._value:!1}},z=class extends w{constructor(e){super();this._boolValue=e}isBool(){return!0}toBoolean(e=!1){return this._boolValue}getString(e,r){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(e){return typeof e=="boolean"?e==this._boolValue:!1}isStatic(){return!0}},nt=class extends w{constructor(t){super(),typeof t=="string"&&(this._stringBuffer=t),t instanceof D&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return typeof t=="string"?this._stringBuffer==t:t instanceof D?this._stringBuffer==t.s:!1}},Pt=class extends nt{constructor(e,r){var t=(...args)=>{super(...args)};t(e),this._isStatic=r}isStatic(){return this._isStatic}setErrorNotForClientCall(e){return this._stringBuffer=e,this}isError(){return!0}},it=class extends w{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,Pt.nullValue}constructor(){super(),this._stringBuffer="NullValue"}},Nt=class extends w{constructor(){super();this._array=new C}release(){for(let e=this._array.begin();e.notEqual(this._array.end());e.preIncrement()){let r=e.ptr();r&&!r.isStatic()&&(r=void 0,r=null)}}isArray(){return!0}getValueByIndex(e){if(e<0||this._array.getSize()<=e)return w.errorValue.setErrorNotForClientCall(_s);let r=this._array.at(e);return r??w.nullValue}getValueByString(e){return w.errorValue.setErrorNotForClientCall(tr)}getString(e,r){let i=r+`[\n`;for(let s=this._array.begin();s.notEqual(this._array.end());s.increment()){let o=s.ptr();this._stringBuffer+=r+""+o.getString(r+" ")+`\n`}return this._stringBuffer=i+r+`]\n`,this._stringBuffer}add(e){this._array.pushBack(e)}getVector(e=null){return this._array}getSize(){return this._array.getSize()}},st=class extends w{constructor(){super();this._map=new N}release(){let e=this._map.begin();for(;e.notEqual(this._map.end());){let r=e.ptr().second;r&&!r.isStatic()&&(r=void 0,r=null),e.preIncrement()}}isMap(){return!0}getValueByString(e){if(e instanceof D){let r=this._map.getValue(e.s);return r??w.nullValue}for(let r=this._map.begin();r.notEqual(this._map.end());r.preIncrement())if(r.ptr().first==e)return r.ptr().second==null?w.nullValue:r.ptr().second;return w.nullValue}getValueByIndex(e){return w.errorValue.setErrorNotForClientCall(tr)}getString(e,r){this._stringBuffer=r+`{\n`;let i=this._map.begin();for(;i.notEqual(this._map.end());){let s=i.ptr().first,o=i.ptr().second;this._stringBuffer+=r+" "+s+" : "+o.getString(r+"   ")+` \n`,i.preIncrement()}return this._stringBuffer+=r+`}\n`,this._stringBuffer}getMap(e){return this._map}put(e,r){this._map.setValue(e,r)}getKeys(){if(!this._keys){this._keys=new C;let e=this._map.begin();for(;e.notEqual(this._map.end());){let r=e.ptr().first;this._keys.pushBack(r),e.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}},ys;(l=>(l.CubismJson=E,l.JsonArray=Nt,l.JsonBoolean=z,l.JsonError=Pt,l.JsonFloat=Mt,l.JsonMap=st,l.JsonNullvalue=it,l.JsonString=nt,l.Value=w))(ys||={});function Yr(n,t){let e=0;for(let i=1;;i++){let s=n.slice(i-1,i);if(s=="e"||s=="-"||s=="E")continue;let o=n.substring(0,i),a=Number(o);if(isNaN(a))break;e=i}let r=parseFloat(n);return isNaN(r)&&(r=NaN),t[0]=n.slice(e),r}var J=!1,te=!1,ee=null,Fe=null,K=Object.freeze({vertexOffset:0,vertexStep:2});function Jr(n){!n||(n=void 0)}var B=class{static startUp(t=null){if(J)return W("CubismFramework.startUp() is already done."),J;if(ee=t,ee!=null&&Live2DCubismCore.Logging.csmSetLogFunction(ee.logFunction),J=!0,J){let e=Live2DCubismCore.Version.csmGetVersion(),r=(e&4278190080)>>24,i=(e&16711680)>>16,s=e&65535,o=e;W("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+r).slice(-2),("00"+i).slice(-2),("0000"+s).slice(-4),o)}return W("CubismFramework.startUp() is complete."),J}static cleanUp(){J=!1,te=!1,ee=null,Fe=null}static initialize(){if(U(J),!J){Y("CubismFramework is not started.");return}if(te){Y("CubismFramework.initialize() skipped, already initialized.");return}w.staticInitializeNotForClientCall(),Fe=new Zt,te=!0,W("CubismFramework.initialize() is complete.")}static dispose(){if(U(J),!J){Y("CubismFramework is not started.");return}if(!te){Y("CubismFramework.dispose() skipped, not initialized.");return}w.staticReleaseNotForClientCall(),Fe.release(),Fe=null,dt.staticRelease(),te=!1,W("CubismFramework.dispose() is complete.")}static isStarted(){return J}static isInitialized(){return te}static coreLogFunction(t){!Live2DCubismCore.Logging.csmGetLogFunction()||Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return ee!=null?ee.loggingLevel:Qe.LogLevel_Off}static getIdManager(){return Fe}constructor(){}};var Qe=(o=>(o[o.LogLevel_Verbose=0]="LogLevel_Verbose",o[o.LogLevel_Debug=1]="LogLevel_Debug",o[o.LogLevel_Info=2]="LogLevel_Info",o[o.LogLevel_Warning=3]="LogLevel_Warning",o[o.LogLevel_Error=4]="LogLevel_Error",o[o.LogLevel_Off=5]="LogLevel_Off",o))(Qe||{}),xs;(r=>(r.Constant=K,r.csmDelete=Jr,r.CubismFramework=B))(xs||={});var Vt="FileReferences",Ss="Groups",Ms="Layout",Ps="HitAreas",Vs="Moc",Bs="Textures",Is="Physics",Ts="Pose",ws="Expressions",Es="Motions",Kr="UserData",Bt="Name",Qr="File",As="Id",er="Ids";var Zr="Sound",ti="FadeInTime",ei="FadeOutTime";var xr="LipSync",vr="EyeBlink";var re=class extends Qt{constructor(e,r){super();this._json=E.create(e,r),this._json&&(this._jsonValue=new C,this._jsonValue.pushBack(this._json.getRoot().getValueByString(Ss)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Vt).getValueByString(Vs)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Vt).getValueByString(Es)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Vt).getValueByString(ws)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Vt).getValueByString(Bs)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Vt).getValueByString(Is)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Vt).getValueByString(Ts)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Ps)))}release(){E.delete(this._json),this._jsonValue=null}GetJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){let r=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),i=r.length-1,s="";for(let o=0;o<i;o++)s+=r[o],o<i-1&&(s+="/");return s}getTextureFileName(e){return this._jsonValue.at(4).getValueByIndex(e).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(e){return B.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(e).getValueByString(As).getRawString())}getHitAreaName(e){return this._jsonValue.at(7).getValueByIndex(e).getValueByString(Bt).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(e){return this._jsonValue.at(3).getValueByIndex(e).getValueByString(Bt).getRawString()}getExpressionFileName(e){return this._jsonValue.at(3).getValueByIndex(e).getValueByString(Qr).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(e){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(e):null}getMotionCount(e){return this.isExistMotionGroupName(e)?this._jsonValue.at(2).getValueByString(e).getSize():0}getMotionFileName(e,r){return this.isExistMotionGroupName(e)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(r).getValueByString(Qr).getRawString():""}getMotionSoundFileName(e,r){return this.isExistMotionSoundFile(e,r)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(r).getValueByString(Zr).getRawString():""}getMotionFadeInTimeValue(e,r){return this.isExistMotionFadeIn(e,r)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(r).getValueByString(ti).toFloat():-1}getMotionFadeOutTimeValue(e,r){return this.isExistMotionFadeOut(e,r)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(r).getValueByString(ei).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this._json.getRoot().getValueByString(Vt).getValueByString(Kr).getRawString():""}getLayoutMap(e){let r=this._json.getRoot().getValueByString(Ms).getMap();if(r==null)return!1;let i=!1;for(let s=r.begin();s.notEqual(r.end());s.preIncrement())e.setValue(s.ptr().first,s.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let e=0;for(let r=0;r<this._jsonValue.at(0).getSize();r++){let i=this._jsonValue.at(0).getValueByIndex(r);if(!(i.isNull()||i.isError())&&i.getValueByString(Bt).getRawString()==vr){e=i.getValueByString(er).getVector().getSize();break}}return e}getEyeBlinkParameterId(e){if(!this.isExistEyeBlinkParameters())return null;for(let r=0;r<this._jsonValue.at(0).getSize();r++){let i=this._jsonValue.at(0).getValueByIndex(r);if(!(i.isNull()||i.isError())&&i.getValueByString(Bt).getRawString()==vr)return B.getIdManager().getId(i.getValueByString(er).getValueByIndex(e).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let e=0;for(let r=0;r<this._jsonValue.at(0).getSize();r++){let i=this._jsonValue.at(0).getValueByIndex(r);if(!(i.isNull()||i.isError())&&i.getValueByString(Bt).getRawString()==xr){e=i.getValueByString(er).getVector().getSize();break}}return e}getLipSyncParameterId(e){if(!this.isExistLipSyncParameters())return null;for(let r=0;r<this._jsonValue.at(0).getSize();r++){let i=this._jsonValue.at(0).getValueByIndex(r);if(!(i.isNull()||i.isError())&&i.getValueByString(Bt).getRawString()==xr)return B.getIdManager().getId(i.getValueByString(er).getValueByIndex(e).getRawString())}return null}isExistModelFile(){let e=this._jsonValue.at(1);return!e.isNull()&&!e.isError()}isExistTextureFiles(){let e=this._jsonValue.at(4);return!e.isNull()&&!e.isError()}isExistHitAreas(){let e=this._jsonValue.at(7);return!e.isNull()&&!e.isError()}isExistPhysicsFile(){let e=this._jsonValue.at(5);return!e.isNull()&&!e.isError()}isExistPoseFile(){let e=this._jsonValue.at(6);return!e.isNull()&&!e.isError()}isExistExpressionFile(){let e=this._jsonValue.at(3);return!e.isNull()&&!e.isError()}isExistMotionGroups(){let e=this._jsonValue.at(2);return!e.isNull()&&!e.isError()}isExistMotionGroupName(e){let r=this._jsonValue.at(2).getValueByString(e);return!r.isNull()&&!r.isError()}isExistMotionSoundFile(e,r){let i=this._jsonValue.at(2).getValueByString(e).getValueByIndex(r).getValueByString(Zr);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(e,r){let i=this._jsonValue.at(2).getValueByString(e).getValueByIndex(r).getValueByString(ti);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(e,r){let i=this._jsonValue.at(2).getValueByString(e).getValueByIndex(r).getValueByString(ei);return!i.isNull()&&!i.isError()}isExistUserDataFile(){let e=this._json.getRoot().getValueByString(Vt).getValueByString(Kr);return!e.isNull()&&!e.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let e=0;e<this._jsonValue.at(0).getSize();++e)if(this._jsonValue.at(0).getValueByIndex(e).getValueByString(Bt).getRawString()==vr)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let e=0;e<this._jsonValue.at(0).getSize();++e)if(this._jsonValue.at(0).getValueByIndex(e).getValueByString(Bt).getRawString()==xr)return!0;return!1}},Rs;(t=>t.CubismModelSettingJson=re)(Rs||={});var at=class{static create(){return new at}static delete(t){t!=null&&(t=null)}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;let r=this._currentTime*2*3.14159;for(let i=0;i<this._breathParameters.getSize();++i){let s=this._breathParameters.at(i);t.addParameterValueById(s.parameterId,s.offset+s.peak*Math.sin(r/s.cycle),s.weight)}}constructor(){this._currentTime=0}},ie=class{constructor(t,e,r,i,s){this.parameterId=t??null,this.offset=e??0,this.peak=r??0,this.cycle=i??0,this.weight=s??0}},Ls;(e=>(e.BreathParameterData=ie,e.CubismBreath=at))(Ls||={});var rr=class{static create(t=null){return new rr(t)}static delete(t){t!=null&&(t=null)}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,r){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=r}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){this._userTimeSeconds+=e;let r,i=0;switch(this._blinkingState){case G.EyeState_Closing:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,i>=1&&(i=1,this._blinkingState=G.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),r=1-i;break;case G.EyeState_Closed:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,i>=1&&(this._blinkingState=G.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),r=0;break;case G.EyeState_Opening:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,i>=1&&(i=1,this._blinkingState=G.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),r=i;break;case G.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=G.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),r=1;break;case G.EyeState_First:default:this._blinkingState=G.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),r=1;break}rr.CloseIfZero||(r=-r);for(let s=0;s<this._parameterIds.getSize();++s)t.setParameterValueById(this._parameterIds.at(s),r)}constructor(t){if(this._blinkingState=G.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new C,t!=null)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}determinNextBlinkingTiming(){let t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}},bt=rr;bt.CloseIfZero=!0;var G=(s=>(s[s.EyeState_First=0]="EyeState_First",s[s.EyeState_Interval=1]="EyeState_Interval",s[s.EyeState_Closing=2]="EyeState_Closing",s[s.EyeState_Closed=3]="EyeState_Closed",s[s.EyeState_Opening=4]="EyeState_Opening",s))(G||{}),Ns;(e=>(e.CubismEyeBlink=bt,e.EyeState=G))(Ns||={});var ks=.001,Sr=.5,ri="FadeInTime",ii="Link",Us="Groups",zs="Id",ft=class{static create(t,e){let r=new ft,i=E.create(t,e),s=i.getRoot();s.getValueByString(ri).isNull()||(r._fadeTimeSeconds=s.getValueByString(ri).toFloat(Sr),r._fadeTimeSeconds<=0&&(r._fadeTimeSeconds=Sr));let o=s.getValueByString(Us),a=o.getSize();for(let u=0;u<a;++u){let l=o.getValueByIndex(u),c=l.getSize(),p=0;for(let b=0;b<c;++b){let g=l.getValueByIndex(b),d=new It,h=B.getIdManager().getId(g.getValueByString(zs).getRawString());if(d.partId=h,!g.getValueByString(ii).isNull()){let m=g.getValueByString(ii),P=m.getSize();for(let S=0;S<P;++S){let v=new It,f=B.getIdManager().getId(m.getValueByIndex(S).getString());v.partId=f,d.link.pushBack(v)}}r._partGroups.pushBack(d.clone()),++p}r._partGroupCounts.pushBack(p)}return E.delete(i),r}static delete(t){t!=null&&(t=null)}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let r=0;for(let i=0;i<this._partGroupCounts.getSize();i++){let s=this._partGroupCounts.at(i);this.doFade(t,e,r,s),r+=s}this.copyPartOpacities(t)}reset(t){let e=0;for(let r=0;r<this._partGroupCounts.getSize();++r){let i=this._partGroupCounts.at(r);for(let s=e;s<e+i;++s){this._partGroups.at(s).initialize(t);let o=this._partGroups.at(s).partIndex,a=this._partGroups.at(s).parameterIndex;if(!(o<0)){t.setPartOpacityByIndex(o,s==e?1:0),t.setParameterValueByIndex(a,s==e?1:0);for(let u=0;u<this._partGroups.at(s).link.getSize();++u)this._partGroups.at(s).link.at(u).initialize(t)}}e+=i}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){let r=this._partGroups.at(e);if(r.link.getSize()==0)continue;let i=this._partGroups.at(e).partIndex,s=t.getPartOpacityByIndex(i);for(let o=0;o<r.link.getSize();++o){let u=r.link.at(o).partIndex;u<0||t.setPartOpacityByIndex(u,s)}}}doFade(t,e,r,i){let s=-1,o=1,a=.5,u=.15;for(let l=r;l<r+i;++l){let c=this._partGroups.at(l).partIndex,p=this._partGroups.at(l).parameterIndex;if(t.getParameterValueByIndex(p)>ks){if(s>=0)break;s=l,o=t.getPartOpacityByIndex(c),o+=e/this._fadeTimeSeconds,o>1&&(o=1)}}s<0&&(s=0,o=1);for(let l=r;l<r+i;++l){let c=this._partGroups.at(l).partIndex;if(s==l)t.setPartOpacityByIndex(c,o);else{let p=t.getPartOpacityByIndex(c),b;o<a?b=o*(a-1)/a+1:b=(1-o)*a/(1-a),(1-b)*(1-o)>u&&(b=1-u/(1-o)),p>b&&(p=b),t.setPartOpacityByIndex(c,p)}}}constructor(){this._fadeTimeSeconds=Sr,this._lastModel=null,this._partGroups=new C,this._partGroupCounts=new C}},It=class{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new C,t!=null){this.partId=t.partId;for(let e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(let e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){let t=new It;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new C;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}},$s;(e=>(e.CubismPose=ft,e.PartData=It))($s||={});var se=class extends L{constructor(e,r){super();this._width=e!==void 0?e:0,this._height=r!==void 0?r:0,this.setHeight(2)}setWidth(e){let r=e/this._width,i=r;this.scale(r,i)}setHeight(e){let r=e/this._height,i=r;this.scale(r,i)}setPosition(e,r){this.translate(e,r)}setCenterPosition(e,r){this.centerX(e),this.centerY(r)}top(e){this.setY(e)}bottom(e){let r=this._height*this.getScaleY();this.translateY(e-r)}left(e){this.setX(e)}right(e){let r=this._width*this.getScaleX();this.translateX(e-r)}centerX(e){let r=this._width*this.getScaleX();this.translateX(e-r/2)}setX(e){this.translateX(e)}centerY(e){let r=this._height*this.getScaleY();this.translateY(e-r/2)}setY(e){this.translateY(e)}setupFromLayout(e){let r="width",i="height",s="x",o="y",a="center_x",u="center_y",l="top",c="bottom",p="left",b="right";for(let g=e.begin();g.notEqual(e.end());g.preIncrement()){let d=g.ptr().first,h=g.ptr().second;d==r?this.setWidth(h):d==i&&this.setHeight(h)}for(let g=e.begin();g.notEqual(e.end());g.preIncrement()){let d=g.ptr().first,h=g.ptr().second;d==s?this.setX(h):d==o?this.setY(h):d==a?this.centerX(h):d==u?this.centerY(h):d==l?this.top(h):d==c?this.bottom(h):d==p?this.left(h):d==b&&this.right(h)}}},Hs;(t=>t.CubismModelMatrix=se)(Hs||={});var _=class{constructor(t,e){this.x=t;this.y=e;this.x=t??0,this.y=e??0}add(t){let e=new _(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){let e=new _(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){let e=new _(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new _(t,t))}division(t){let e=new _(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new _(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){let t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}},qs;(t=>t.CubismVector2=_)(qs||={});var Le=class{static range(t,e,r){return t<e?t=e:t>r&&(t=r),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let e=t,r=e<0;r&&(e=-e);let i;return e===1/0?i=1/0:(i=Math.exp(Math.log(e)/3),i=(e/(i*i)+2*i)/3),r?-i:i}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,e){let r=Math.atan2(e.y,e.x),i=Math.atan2(t.y,t.x),s=r-i;for(;s<-Math.PI;)s+=Math.PI*2;for(;s>Math.PI;)s-=Math.PI*2;return s}static directionToDegrees(t,e){let r=this.directionToRadian(t,e),i=this.radianToDegrees(r);return e.x-t.x>0&&(i=-i),i}static radianToDirection(t){let e=new _;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,r){return this.abs(t)<Le.Epsilon?this.abs(e)<Le.Epsilon?-r:-r/e:-(e+this.sqrt(e*e-4*t*r))/(2*t)}static cardanoAlgorithmForBezier(t,e,r,i){if(this.sqrt(t)<Le.Epsilon)return this.range(this.quadraticEquation(e,r,i),0,1);let s=e/t,o=r/t,a=i/t,u=(3*o-s*s)/3,l=u/3,c=(2*s*s*s-9*s*o+27*a)/27,p=c/2,b=p*p+l*l*l,g=.5,d=g+.01;if(b<0){let v=-u/3,f=v*v*v,I=this.sqrt(f),x=-c/(2*I),F=this.range(x,-1,1),R=Math.acos(F),mt=2*this.cbrt(I),Be=mt*this.cos(R/3)-s/3;if(this.abs(Be-g)<d)return this.range(Be,0,1);let Xt=mt*this.cos((R+2*Math.PI)/3)-s/3;if(this.abs(Xt-g)<d)return this.range(Xt,0,1);let pt=mt*this.cos((R+4*Math.PI)/3)-s/3;return this.range(pt,0,1)}if(b==0){let v;p<0?v=this.cbrt(-p):v=-this.cbrt(p);let f=2*v-s/3;if(this.abs(f-g)<d)return this.range(f,0,1);let I=-v-s/3;return this.range(I,0,1)}let h=this.sqrt(b),m=this.cbrt(h-p),P=this.cbrt(h+p),S=m-P-s/3;return this.range(S,0,1)}constructor(){}},M=Le;M.Epsilon=1e-5;var Xs;(t=>t.CubismMath=M)(Xs||={});var Mr=30,si=.01,ne=class{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;let r=40/10*1/Mr;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}let i=(this._userTimeSeconds-this._lastTimeSeconds)*Mr;this._lastTimeSeconds=this._userTimeSeconds;let o=.15*Mr,a=i*r/o,u=this._faceTargetX-this._faceX,l=this._faceTargetY-this._faceY;if(M.abs(u)<=si&&M.abs(l)<=si)return;let c=M.sqrt(u*u+l*l),p=r*u/c,b=r*l/c,g=p-this._faceVX,d=b-this._faceVY,h=M.sqrt(g*g+d*d);(h<-a||h>a)&&(g*=a/h,d*=a/h),this._faceVX+=g,this._faceVY+=d;{let m=.5*(M.sqrt(a*a+16*a*c-8*a*c)-a),P=M.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);P>m&&(this._faceVX*=m/P,this._faceVY*=m/P)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}},Js;(t=>t.CubismTargetPoint=ne)(Js||={});var ot=class{constructor(){this.setFinishedMotionHandler=t=>this._onFinishedMotion=t;this.getFinishedMotionHandler=()=>this._onFinishedMotion;this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new C}static delete(t){t.release(),t=null}release(){this._weight=0}updateParameters(t,e,r){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(r-this._offsetSeconds),e.setFadeInStartTime(r);let a=this.getDuration();e.getEndTime()<0&&e.setEndTime(a<=0?-1:e.getStartTime()+a)}let i=this._weight,s=this._fadeInSeconds==0?1:M.getEasingSine((r-e.getFadeInStartTime())/this._fadeInSeconds),o=this._fadeOutSeconds==0||e.getEndTime()<0?1:M.getEasingSine((e.getEndTime()-r)/this._fadeOutSeconds);i=i*s*o,e.setState(r,i),U(0<=i&&i<=1),this.doUpdateParameters(t,r,i,e),e.getEndTime()>0&&e.getEndTime()<r&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}},Qs;(t=>t.ACubismMotion=ot)(Qs||={});var tn="FadeInTime",en="FadeOutTime",ni="Parameters",rn="Id",sn="Value",ir="Blend",nn="Add",an="Multiply",on="Overwrite",ai=1,Tt=class extends ot{constructor(){super();this._parameters=new C}static create(e,r){let i=new Tt,s=E.create(e,r),o=s.getRoot();i.setFadeInTime(o.getValueByString(tn).toFloat(ai)),i.setFadeOutTime(o.getValueByString(en).toFloat(ai));let a=o.getValueByString(ni).getSize();i._parameters.prepareCapacity(a);for(let u=0;u<a;++u){let l=o.getValueByString(ni).getValueByIndex(u),c=B.getIdManager().getId(l.getValueByString(rn).getRawString()),p=l.getValueByString(sn).toFloat(),b;l.getValueByString(ir).isNull()||l.getValueByString(ir).getString()==nn?b=ut.ExpressionBlendType_Add:l.getValueByString(ir).getString()==an?b=ut.ExpressionBlendType_Multiply:l.getValueByString(ir).getString()==on?b=ut.ExpressionBlendType_Overwrite:b=ut.ExpressionBlendType_Add;let g=new De;g.parameterId=c,g.blendType=b,g.value=p,i._parameters.pushBack(g)}return E.delete(s),i}doUpdateParameters(e,r,i,s){for(let o=0;o<this._parameters.getSize();++o){let a=this._parameters.at(o);switch(a.blendType){case ut.ExpressionBlendType_Add:{e.addParameterValueById(a.parameterId,a.value,i);break}case ut.ExpressionBlendType_Multiply:{e.multiplyParameterValueById(a.parameterId,a.value,i);break}case ut.ExpressionBlendType_Overwrite:{e.setParameterValueById(a.parameterId,a.value,i);break}default:break}}}},ut=(r=>(r[r.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",r[r.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",r[r.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite",r))(ut||{}),De=class{},un;(r=>(r.CubismExpressionMotion=Tt,r.ExpressionBlendType=ut,r.ExpressionParameter=De))(un||={});var sr=(r=>(r[r.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",r[r.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",r[r.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",r))(sr||{}),nr=(i=>(i[i.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",i[i.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",i[i.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",i[i.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",i))(nr||{}),Ot=class{constructor(){this.time=0;this.value=0}},ae=class{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}},oe=class{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}},ue=class{constructor(){this.fireTime=0}},le=class{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new C,this.segments=new C,this.points=new C,this.events=new C}},cn;(a=>(a.CubismMotionCurve=oe,a.CubismMotionCurveTarget=sr,a.CubismMotionData=le,a.CubismMotionEvent=ue,a.CubismMotionPoint=Ot,a.CubismMotionSegment=ae,a.CubismMotionSegmentType=nr))(cn||={});var q="Meta",pn="Duration",hn="Loop",gn="AreBeziersRestricted",dn="CurveCount",bn="Fps",fn="TotalSegmentCount",_n="TotalPointCount",wt="Curves",yn="Target",Cn="Id",ar="FadeInTime",or="FadeOutTime",oi="Segments",ui="UserData",xn="UserDataCount",vn="TotalUserDataSize",Sn="Time",Mn="Value",ce=class{constructor(t,e){this._json=E.create(t,e)}release(){E.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(q).getValueByString(pn).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(q).getValueByString(hn).toBoolean()}getEvaluationOptionFlag(t){return Pr.EvaluationOptionFlag_AreBeziersRistricted==t?this._json.getRoot().getValueByString(q).getValueByString(gn).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString(q).getValueByString(dn).toInt()}getMotionFps(){return this._json.getRoot().getValueByString(q).getValueByString(bn).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(q).getValueByString(fn).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(q).getValueByString(_n).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(q).getValueByString(ar).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(q).getValueByString(or).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(q).getValueByString(ar).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(q).getValueByString(or).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(wt).getValueByIndex(t).getValueByString(yn).getRawString()}getMotionCurveId(t){return B.getIdManager().getId(this._json.getRoot().getValueByString(wt).getValueByIndex(t).getValueByString(Cn).getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(wt).getValueByIndex(t).getValueByString(ar).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(wt).getValueByIndex(t).getValueByString(or).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(wt).getValueByIndex(t).getValueByString(ar).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(wt).getValueByIndex(t).getValueByString(or).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(wt).getValueByIndex(t).getValueByString(oi).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(wt).getValueByIndex(t).getValueByString(oi).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(q).getValueByString(xn).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(q).getValueByString(vn).toInt()}getEventTime(t){return this._json.getRoot().getValueByString(ui).getValueByIndex(t).getValueByString(Sn).toFloat()}getEventValue(t){return new D(this._json.getRoot().getValueByString(ui).getValueByIndex(t).getValueByString(Mn).getRawString())}},Pr=(t=>(t[t.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",t))(Pr||{}),Pn;(t=>t.CubismMotionJson=ce)(Pn||={});var Bn="EyeBlink",In="LipSync",Tn="Model",wn="Parameter",En="PartOpacity",An=!1;function X(n,t,e){let r=new Ot;return r.time=n.time+(t.time-n.time)*e,r.value=n.value+(t.value-n.value)*e,r}function Rn(n,t){let e=(t-n[0].time)/(n[1].time-n[0].time);return e<0&&(e=0),n[0].value+(n[1].value-n[0].value)*e}function Fn(n,t){let e=(t-n[0].time)/(n[3].time-n[0].time);e<0&&(e=0);let r=X(n[0],n[1],e),i=X(n[1],n[2],e),s=X(n[2],n[3],e),o=X(r,i,e),a=X(i,s,e);return X(o,a,e).value}function Ln(n,t){let e=t,r=n[0].time,i=n[3].time,s=n[1].time,o=n[2].time,a=i-3*o+3*s-r,u=3*o-6*s+3*r,l=3*s-3*r,c=r-e,p=M.cardanoAlgorithmForBezier(a,u,l,c),b=X(n[0],n[1],p),g=X(n[1],n[2],p),d=X(n[2],n[3],p),h=X(b,g,p),m=X(g,d,p);return X(h,m,p).value}function Dn(n,t){return n[0].value}function Nn(n,t){return n[1].value}function Vr(n,t,e){let r=n.curves.at(t),i=-1,s=r.baseSegmentIndex+r.segmentCount,o=0;for(let u=r.baseSegmentIndex;u<s;++u)if(o=n.segments.at(u).basePointIndex+(n.segments.at(u).segmentType==1?3:1),n.points.at(o).time>e){i=u;break}if(i==-1)return n.points.at(o).value;let a=n.segments.at(i);return a.evaluate(n.points.get(a.basePointIndex),e)}var lt=class extends ot{constructor(){super();this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null}static create(e,r,i){let s=new lt;return s.parse(e,r),s._sourceFrameRate=s._motionData.fps,s._loopDurationSeconds=s._motionData.duration,s._onFinishedMotion=i,s}doUpdateParameters(e,r,i,s){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=B.getIdManager().getId(Bn)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=B.getIdManager().getId(In));let o=r-s.getStartTime();o<0&&(o=0);let a=Number.MAX_VALUE,u=Number.MAX_VALUE,l=64,c=0,p=0;this._eyeBlinkParameterIds.getSize()>l&&St("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>l&&St("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());let b=this._fadeInSeconds<=0?1:M.getEasingSine((r-s.getFadeInStartTime())/this._fadeInSeconds),g=this._fadeOutSeconds<=0||s.getEndTime()<0?1:M.getEasingSine((s.getEndTime()-r)/this._fadeOutSeconds),d,h,m,P=o;if(this._isLoop)for(;P>this._motionData.duration;)P-=this._motionData.duration;let S=this._motionData.curves;for(h=0;h<this._motionData.curveCount&&S.at(h).type==0;++h)d=Vr(this._motionData,h,P),S.at(h).id==this._modelCurveIdEyeBlink?u=d:S.at(h).id==this._modelCurveIdLipSync&&(a=d);let v=0;for(;h<this._motionData.curveCount&&S.at(h).type==1;++h){if(v++,m=e.getParameterIndex(S.at(h).id),m==-1)continue;let f=e.getParameterValueByIndex(m);if(d=Vr(this._motionData,h,P),u!=Number.MAX_VALUE){for(let x=0;x<this._eyeBlinkParameterIds.getSize()&&x<l;++x)if(this._eyeBlinkParameterIds.at(x)==S.at(h).id){d*=u,p|=1<<x;break}}if(a!=Number.MAX_VALUE){for(let x=0;x<this._lipSyncParameterIds.getSize()&&x<l;++x)if(this._lipSyncParameterIds.at(x)==S.at(h).id){d+=a,c|=1<<x;break}}let I;if(S.at(h).fadeInTime<0&&S.at(h).fadeOutTime<0)I=f+(d-f)*i;else{let x,F;S.at(h).fadeInTime<0?x=b:x=S.at(h).fadeInTime==0?1:M.getEasingSine((r-s.getFadeInStartTime())/S.at(h).fadeInTime),S.at(h).fadeOutTime<0?F=g:F=S.at(h).fadeOutTime==0||s.getEndTime()<0?1:M.getEasingSine((s.getEndTime()-r)/S.at(h).fadeOutTime);let R=this._weight*x*F;I=f+(d-f)*R}e.setParameterValueByIndex(m,I,1)}{if(u!=Number.MAX_VALUE)for(let f=0;f<this._eyeBlinkParameterIds.getSize()&&f<l;++f){let I=e.getParameterValueById(this._eyeBlinkParameterIds.at(f));if(p>>f&1)continue;let x=I+(u-I)*i;e.setParameterValueById(this._eyeBlinkParameterIds.at(f),x)}if(a!=Number.MAX_VALUE)for(let f=0;f<this._lipSyncParameterIds.getSize()&&f<l;++f){let I=e.getParameterValueById(this._lipSyncParameterIds.at(f));if(c>>f&1)continue;let x=I+(a-I)*i;e.setParameterValueById(this._lipSyncParameterIds.at(f),x)}}for(;h<this._motionData.curveCount&&S.at(h).type==2;++h)m=e.getParameterIndex(S.at(h).id),m!=-1&&(d=Vr(this._motionData,h,P),e.setParameterValueByIndex(m,d));o>=this._motionData.duration&&(this._isLoop?(s.setStartTime(r),this._isLoopFadeIn&&s.setFadeInStartTime(r)):(this._onFinishedMotion&&this._onFinishedMotion(this),s.setIsFinished(!0))),this._lastWeight=i}setIsLoop(e){this._isLoop=e}isLoop(){return this._isLoop}setIsLoopFadeIn(e){this._isLoopFadeIn=e}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(e,r){let i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(e==i.at(s).id){i.at(s).fadeInTime=r;return}}setParameterFadeOutTime(e,r){let i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(e==i.at(s).id){i.at(s).fadeOutTime=r;return}}getParameterFadeInTime(e){let r=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==r.at(i).id)return r.at(i).fadeInTime;return-1}getParameterFadeOutTime(e){let r=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==r.at(i).id)return r.at(i).fadeOutTime;return-1}setEffectIds(e,r){this._eyeBlinkParameterIds=e,this._lipSyncParameterIds=r}release(){this._motionData=void 0,this._motionData=null}parse(e,r){this._motionData=new le;let i=new ce(e,r);this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();let s=i.getEvaluationOptionFlag(0);i.isExistMotionFadeInTime()?this._fadeInSeconds=i.getMotionFadeInTime()<0?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=i.getMotionFadeOutTime()<0?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,oe,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),ae,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),Ot,!0),this._motionData.events.updateSize(this._motionData.eventCount,ue,!0);let o=0,a=0;for(let u=0;u<this._motionData.curveCount;++u){i.getMotionCurveTarget(u)==Tn?this._motionData.curves.at(u).type=0:i.getMotionCurveTarget(u)==wn?this._motionData.curves.at(u).type=1:i.getMotionCurveTarget(u)==En?this._motionData.curves.at(u).type=2:Y(\'Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!\'),this._motionData.curves.at(u).id=i.getMotionCurveId(u),this._motionData.curves.at(u).baseSegmentIndex=a,this._motionData.curves.at(u).fadeInTime=i.isExistMotionCurveFadeInTime(u)?i.getMotionCurveFadeInTime(u):-1,this._motionData.curves.at(u).fadeOutTime=i.isExistMotionCurveFadeOutTime(u)?i.getMotionCurveFadeOutTime(u):-1;for(let l=0;l<i.getMotionCurveSegmentCount(u);){switch(l==0?(this._motionData.segments.at(a).basePointIndex=o,this._motionData.points.at(o).time=i.getMotionCurveSegment(u,l),this._motionData.points.at(o).value=i.getMotionCurveSegment(u,l+1),o+=1,l+=2):this._motionData.segments.at(a).basePointIndex=o-1,i.getMotionCurveSegment(u,l)){case 0:{this._motionData.segments.at(a).segmentType=0,this._motionData.segments.at(a).evaluate=Rn,this._motionData.points.at(o).time=i.getMotionCurveSegment(u,l+1),this._motionData.points.at(o).value=i.getMotionCurveSegment(u,l+2),o+=1,l+=3;break}case 1:{this._motionData.segments.at(a).segmentType=1,s||An?this._motionData.segments.at(a).evaluate=Fn:this._motionData.segments.at(a).evaluate=Ln,this._motionData.points.at(o).time=i.getMotionCurveSegment(u,l+1),this._motionData.points.at(o).value=i.getMotionCurveSegment(u,l+2),this._motionData.points.at(o+1).time=i.getMotionCurveSegment(u,l+3),this._motionData.points.at(o+1).value=i.getMotionCurveSegment(u,l+4),this._motionData.points.at(o+2).time=i.getMotionCurveSegment(u,l+5),this._motionData.points.at(o+2).value=i.getMotionCurveSegment(u,l+6),o+=3,l+=7;break}case 2:{this._motionData.segments.at(a).segmentType=2,this._motionData.segments.at(a).evaluate=Dn,this._motionData.points.at(o).time=i.getMotionCurveSegment(u,l+1),this._motionData.points.at(o).value=i.getMotionCurveSegment(u,l+2),o+=1,l+=3;break}case 3:{this._motionData.segments.at(a).segmentType=3,this._motionData.segments.at(a).evaluate=Nn,this._motionData.points.at(o).time=i.getMotionCurveSegment(u,l+1),this._motionData.points.at(o).value=i.getMotionCurveSegment(u,l+2),o+=1,l+=3;break}default:{U(0);break}}++this._motionData.curves.at(u).segmentCount,++a}}for(let u=0;u<i.getEventCount();++u)this._motionData.events.at(u).fireTime=i.getEventTime(u),this._motionData.events.at(u).value=i.getEventValue(u);i.release(),i=void 0,i=null}getFiredEvent(e,r){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>e&&this._motionData.events.at(i).fireTime<=r&&this._firedEventValues.pushBack(new D(this._motionData.events.at(i).value.s));return this._firedEventValues}},On;(t=>t.CubismMotion=lt)(On||={});var me=class{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&ot.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){let r=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||r<this._endTimeSeconds)&&(this._endTimeSeconds=r)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}},Un;(t=>t.CubismMotionQueueEntry=me)(Un||={});var pe=class{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new C}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,e,r){if(t==null)return he;let i=null;for(let s=0;s<this._motions.getSize();++s)i=this._motions.at(s),i?.setFadeOut(i._motion.getFadeOutTime());return i=new me,i._autoDelete=e,i._motion=t,this._motions.pushBack(i),i._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}if(e._motion==null){e.release(),e=null,t=this._motions.erase(t);continue}if(e.isFinished())t.preIncrement();else return!1}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){let r=e.ptr();if(r!=null&&r._motionQueueEntryHandle==t&&!r.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}e.release(),e=null,t=this._motions.erase(t)}}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){let r=e.ptr();if(r!=null&&r._motionQueueEntryHandle==t)return r}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let r=!1;for(let i=this._motions.begin();i.notEqual(this._motions.end());){let s=i.ptr();if(s==null){i=this._motions.erase(i);continue}let o=s._motion;if(o==null){s.release(),s=null,i=this._motions.erase(i);continue}o.updateParameters(t,s,e),r=!0;let a=o.getFiredEvent(s.getLastCheckEventSeconds()-s.getStartTime(),e-s.getStartTime());for(let u=0;u<a.getSize();++u)this._eventCallBack(this,a.at(u),this._eventCustomData);s.setLastCheckEventSeconds(e),s.isFinished()?(s.release(),s=null,i=this._motions.erase(i)):(s.isTriggeredFadeOut()&&s.startFadeOut(s.getFadeOutSeconds(),e),i.preIncrement())}return r}},he=-1,$n;(e=>(e.CubismMotionQueueManager=pe,e.InvalidMotionQueueEntryHandleValue=he))($n||={});var kt=class extends pe{constructor(){super();this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(e){this._reservePriority=e}startMotionPriority(e,r,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(e,r,this._userTimeSeconds)}updateMotion(e,r){this._userTimeSeconds+=r;let i=super.doUpdateMotion(e,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(e){return e<=this._reservePriority||e<=this._currentPriority?!1:(this._reservePriority=e,!0)}},Hn;(t=>t.CubismMotionManager=kt)(Hn||={});var lr=(t=>(t[t.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",t))(lr||{}),cr=(r=>(r[r.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",r[r.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",r[r.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",r))(cr||{}),ur=class{constructor(){this.gravity=new _(0,0),this.wind=new _(0,0)}},ge=class{},de=class{},be=class{constructor(){this.initialPosition=new _(0,0),this.position=new _(0,0),this.lastPosition=new _(0,0),this.lastGravity=new _(0,0),this.force=new _(0,0),this.velocity=new _(0,0)}},fe=class{constructor(){this.normalizationPosition=new de,this.normalizationAngle=new de}},_e=class{constructor(){this.source=new ge}},ye=class{constructor(){this.destination=new ge,this.translationScale=new _(0,0)}},Ce=class{constructor(){this.settings=new C,this.inputs=new C,this.outputs=new C,this.particles=new C,this.gravity=new _(0,0),this.wind=new _(0,0),this.fps=0}},qn;(c=>(c.CubismPhysicsInput=_e,c.CubismPhysicsNormalization=de,c.CubismPhysicsOutput=ye,c.CubismPhysicsParameter=ge,c.CubismPhysicsParticle=be,c.CubismPhysicsRig=Ce,c.CubismPhysicsSource=cr,c.CubismPhysicsSubRig=fe,c.CubismPhysicsTargetType=lr,c.PhysicsJsonEffectiveForces=ur))(qn||={});var Ne="Position",Br="X",Ir="Y",Tr="Angle",li="Type",ci="Id",_t="Meta",mr="EffectiveForces",Xn="TotalInputCount",Yn="TotalOutputCount",Jn="PhysicsSettingCount",mi="Gravity",pi="Wind",Kn="VertexCount",Qn="Fps",A="PhysicsSettings",xe="Normalization",hi="Minimum",gi="Maximum",di="Default",bi="Reflect",fi="Weight",Oe="Input",Zn="Source",Ut="Output",ta="Scale",ea="VertexIndex",ra="Destination",zt="Vertices",ia="Mobility",sa="Delay",na="Radius",aa="Acceleration",ve=class{constructor(t,e){this._json=E.create(t,e)}release(){E.delete(this._json)}getGravity(){let t=new _(0,0);return t.x=this._json.getRoot().getValueByString(_t).getValueByString(mr).getValueByString(mi).getValueByString(Br).toFloat(),t.y=this._json.getRoot().getValueByString(_t).getValueByString(mr).getValueByString(mi).getValueByString(Ir).toFloat(),t}getWind(){let t=new _(0,0);return t.x=this._json.getRoot().getValueByString(_t).getValueByString(mr).getValueByString(pi).getValueByString(Br).toFloat(),t.y=this._json.getRoot().getValueByString(_t).getValueByString(mr).getValueByString(pi).getValueByString(Ir).toFloat(),t}getFps(){return this._json.getRoot().getValueByString(_t).getValueByString(Qn).toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(_t).getValueByString(Jn).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(_t).getValueByString(Xn).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(_t).getValueByString(Yn).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(_t).getValueByString(Kn).toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(xe).getValueByString(Ne).getValueByString(hi).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(xe).getValueByString(Ne).getValueByString(gi).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(xe).getValueByString(Ne).getValueByString(di).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(xe).getValueByString(Tr).getValueByString(hi).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(xe).getValueByString(Tr).getValueByString(gi).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(xe).getValueByString(Tr).getValueByString(di).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Oe).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Oe).getValueByIndex(e).getValueByString(fi).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Oe).getValueByIndex(e).getValueByString(bi).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Oe).getValueByIndex(e).getValueByString(li).getRawString()}getInputSourceId(t,e){return B.getIdManager().getId(this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Oe).getValueByIndex(e).getValueByString(Zn).getValueByString(ci).getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Ut).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Ut).getValueByIndex(e).getValueByString(ea).toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Ut).getValueByIndex(e).getValueByString(ta).toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Ut).getValueByIndex(e).getValueByString(fi).toFloat()}getOutputDestinationId(t,e){return B.getIdManager().getId(this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Ut).getValueByIndex(e).getValueByString(ra).getValueByString(ci).getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Ut).getValueByIndex(e).getValueByString(li).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Ut).getValueByIndex(e).getValueByString(bi).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(zt).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(zt).getValueByIndex(e).getValueByString(ia).toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(zt).getValueByIndex(e).getValueByString(sa).toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(zt).getValueByIndex(e).getValueByString(aa).toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(zt).getValueByIndex(e).getValueByString(na).toFloat()}getParticlePosition(t,e){let r=new _(0,0);return r.x=this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(zt).getValueByIndex(e).getValueByString(Ne).getValueByString(Br).toFloat(),r.y=this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(zt).getValueByIndex(e).getValueByString(Ne).getValueByString(Ir).toFloat(),r}},oa;(t=>t.CubismPhysicsJson=ve)(oa||={});var _i="X",yi="Y",Ci="Angle",la=5,Er=100,xi=.001,ca=5,yt=class{static create(t,e){let r=new yt;return r.parse(t,e),r._physicsRig.gravity.y=0,r}static delete(t){t!=null&&(t.release(),t=null)}parse(t,e){this._physicsRig=new Ce;let r=new ve(t,e);this._physicsRig.gravity=r.getGravity(),this._physicsRig.wind=r.getWind(),this._physicsRig.subRigCount=r.getSubRigCount(),this._physicsRig.fps=r.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,fe,!0),this._physicsRig.inputs.updateSize(r.getTotalInputCount(),_e,!0),this._physicsRig.outputs.updateSize(r.getTotalOutputCount(),ye,!0),this._physicsRig.particles.updateSize(r.getVertexCount(),be,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let i=0,s=0,o=0;for(let a=0;a<this._physicsRig.settings.getSize();++a){this._physicsRig.settings.at(a).normalizationPosition.minimum=r.getNormalizationPositionMinimumValue(a),this._physicsRig.settings.at(a).normalizationPosition.maximum=r.getNormalizationPositionMaximumValue(a),this._physicsRig.settings.at(a).normalizationPosition.defalut=r.getNormalizationPositionDefaultValue(a),this._physicsRig.settings.at(a).normalizationAngle.minimum=r.getNormalizationAngleMinimumValue(a),this._physicsRig.settings.at(a).normalizationAngle.maximum=r.getNormalizationAngleMaximumValue(a),this._physicsRig.settings.at(a).normalizationAngle.defalut=r.getNormalizationAngleDefaultValue(a),this._physicsRig.settings.at(a).inputCount=r.getInputCount(a),this._physicsRig.settings.at(a).baseInputIndex=i;for(let c=0;c<this._physicsRig.settings.at(a).inputCount;++c)this._physicsRig.inputs.at(i+c).sourceParameterIndex=-1,this._physicsRig.inputs.at(i+c).weight=r.getInputWeight(a,c),this._physicsRig.inputs.at(i+c).reflect=r.getInputReflect(a,c),r.getInputType(a,c)==_i?(this._physicsRig.inputs.at(i+c).type=0,this._physicsRig.inputs.at(i+c).getNormalizedParameterValue=pa):r.getInputType(a,c)==yi?(this._physicsRig.inputs.at(i+c).type=1,this._physicsRig.inputs.at(i+c).getNormalizedParameterValue=ha):r.getInputType(a,c)==Ci&&(this._physicsRig.inputs.at(i+c).type=2,this._physicsRig.inputs.at(i+c).getNormalizedParameterValue=ga),this._physicsRig.inputs.at(i+c).source.targetType=0,this._physicsRig.inputs.at(i+c).source.id=r.getInputSourceId(a,c);i+=this._physicsRig.settings.at(a).inputCount,this._physicsRig.settings.at(a).outputCount=r.getOutputCount(a),this._physicsRig.settings.at(a).baseOutputIndex=s;let u=new pr;u.outputs.resize(this._physicsRig.settings.at(a).outputCount);let l=new pr;l.outputs.resize(this._physicsRig.settings.at(a).outputCount);for(let c=0;c<this._physicsRig.settings.at(a).outputCount;++c)u.outputs[c]=0,l.outputs[c]=0,this._physicsRig.outputs.at(s+c).destinationParameterIndex=-1,this._physicsRig.outputs.at(s+c).vertexIndex=r.getOutputVertexIndex(a,c),this._physicsRig.outputs.at(s+c).angleScale=r.getOutputAngleScale(a,c),this._physicsRig.outputs.at(s+c).weight=r.getOutputWeight(a,c),this._physicsRig.outputs.at(s+c).destination.targetType=0,this._physicsRig.outputs.at(s+c).destination.id=r.getOutputDestinationId(a,c),r.getOutputType(a,c)==_i?(this._physicsRig.outputs.at(s+c).type=0,this._physicsRig.outputs.at(s+c).getValue=da,this._physicsRig.outputs.at(s+c).getScale=Ca):r.getOutputType(a,c)==yi?(this._physicsRig.outputs.at(s+c).type=1,this._physicsRig.outputs.at(s+c).getValue=ba,this._physicsRig.outputs.at(s+c).getScale=xa):r.getOutputType(a,c)==Ci&&(this._physicsRig.outputs.at(s+c).type=2,this._physicsRig.outputs.at(s+c).getValue=fa,this._physicsRig.outputs.at(s+c).getScale=va),this._physicsRig.outputs.at(s+c).reflect=r.getOutputReflect(a,c);this._currentRigOutputs.pushBack(u),this._previousRigOutputs.pushBack(l),s+=this._physicsRig.settings.at(a).outputCount,this._physicsRig.settings.at(a).particleCount=r.getParticleCount(a),this._physicsRig.settings.at(a).baseParticleIndex=o;for(let c=0;c<this._physicsRig.settings.at(a).particleCount;++c)this._physicsRig.particles.at(o+c).mobility=r.getParticleMobility(a,c),this._physicsRig.particles.at(o+c).delay=r.getParticleDelay(a,c),this._physicsRig.particles.at(o+c).acceleration=r.getParticleAcceleration(a,c),this._physicsRig.particles.at(o+c).radius=r.getParticleRadius(a,c),this._physicsRig.particles.at(o+c).position=r.getParticlePosition(a,c);o+=this._physicsRig.settings.at(a).particleCount}this.initialize(),r.release(),r=void 0,r=null}stabilization(t){let e,r,i,s,o=new _,a,u,l,c,p,b,g,d;p=t.getModel().parameters.values,b=t.getModel().parameters.maximumValues,g=t.getModel().parameters.minimumValues,d=t.getModel().parameters.defaultValues,(this._parameterCaches?.length??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(this._parameterInputCaches?.length??0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let h=0;h<t.getParameterCount();++h)this._parameterCaches[h]=p[h],this._parameterInputCaches[h]=p[h];for(let h=0;h<this._physicsRig.subRigCount;++h){e={angle:0},o.x=0,o.y=0,a=this._physicsRig.settings.at(h),u=this._physicsRig.inputs.get(a.baseInputIndex),l=this._physicsRig.outputs.get(a.baseOutputIndex),c=this._physicsRig.particles.get(a.baseParticleIndex);for(let m=0;m<a.inputCount;++m)r=u[m].weight/Er,u[m].sourceParameterIndex==-1&&(u[m].sourceParameterIndex=t.getParameterIndex(u[m].source.id)),u[m].getNormalizedParameterValue(o,e,p[u[m].sourceParameterIndex],g[u[m].sourceParameterIndex],b[u[m].sourceParameterIndex],d[u[m].sourceParameterIndex],a.normalizationPosition,a.normalizationAngle,u[m].reflect,r),this._parameterCaches[u[m].sourceParameterIndex]=p[u[m].sourceParameterIndex];i=M.degreesToRadian(-e.angle),o.x=o.x*M.cos(i)-o.y*M.sin(i),o.y=o.x*M.sin(i)+o.y*M.cos(i),Ma(c,a.particleCount,o,e.angle,this._options.wind,xi*a.normalizationPosition.maximum);for(let m=0;m<a.outputCount;++m){let P=l[m].vertexIndex;if(l[m].destinationParameterIndex==-1&&(l[m].destinationParameterIndex=t.getParameterIndex(l[m].destination.id)),P<1||P>=a.particleCount)continue;let S=new _;S=c[P].position.substract(c[P-1].position),s=l[m].getValue(S,c,P,l[m].reflect,this._options.gravity),this._currentRigOutputs.at(h).outputs[m]=s,this._previousRigOutputs.at(h).outputs[m]=s;let v=l[m].destinationParameterIndex,f=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(p.subarray(v))):p.slice(v);wr(f,g[v],b[v],s,l[m]);for(let I=v,x=0;I<this._parameterCaches.length;I++,x++)p[I]=this._parameterCaches[I]=f[x]}}}evaluate(t,e){let r,i,s,o,a=new _,u,l,c,p;if(0>=e)return;let b,g,d,h,m;if(this._currentRemainTime+=e,this._currentRemainTime>ca&&(this._currentRemainTime=0),b=t.getModel().parameters.values,g=t.getModel().parameters.maximumValues,d=t.getModel().parameters.minimumValues,h=t.getModel().parameters.defaultValues,(this._parameterCaches?.length??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(this._parameterInputCaches?.length??0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let S=0;S<t.getParameterCount();++S)this._parameterInputCaches[S]=b[S]}for(this._physicsRig.fps>0?m=1/this._physicsRig.fps:m=e;this._currentRemainTime>=m;){for(let v=0;v<this._physicsRig.subRigCount;++v){u=this._physicsRig.settings.at(v),c=this._physicsRig.outputs.get(u.baseOutputIndex);for(let f=0;f<u.outputCount;++f)this._previousRigOutputs.at(v).outputs[f]=this._currentRigOutputs.at(v).outputs[f]}let S=m/this._currentRemainTime;for(let v=0;v<t.getParameterCount();++v)this._parameterCaches[v]=this._parameterInputCaches[v]*(1-S)+b[v]*S,this._parameterInputCaches[v]=this._parameterCaches[v];for(let v=0;v<this._physicsRig.subRigCount;++v){r={angle:0},a.x=0,a.y=0,u=this._physicsRig.settings.at(v),l=this._physicsRig.inputs.get(u.baseInputIndex),c=this._physicsRig.outputs.get(u.baseOutputIndex),p=this._physicsRig.particles.get(u.baseParticleIndex);for(let f=0;f<u.inputCount;++f)i=l[f].weight/Er,l[f].sourceParameterIndex==-1&&(l[f].sourceParameterIndex=t.getParameterIndex(l[f].source.id)),l[f].getNormalizedParameterValue(a,r,this._parameterCaches[l[f].sourceParameterIndex],d[l[f].sourceParameterIndex],g[l[f].sourceParameterIndex],h[l[f].sourceParameterIndex],u.normalizationPosition,u.normalizationAngle,l[f].reflect,i);s=M.degreesToRadian(-r.angle),a.x=a.x*M.cos(s)-a.y*M.sin(s),a.y=a.x*M.sin(s)+a.y*M.cos(s),Sa(p,u.particleCount,a,r.angle,this._options.wind,xi*u.normalizationPosition.maximum,m,la);for(let f=0;f<u.outputCount;++f){let I=c[f].vertexIndex;if(c[f].destinationParameterIndex==-1&&(c[f].destinationParameterIndex=t.getParameterIndex(c[f].destination.id)),I<1||I>=u.particleCount)continue;let x=new _;x.x=p[I].position.x-p[I-1].position.x,x.y=p[I].position.y-p[I-1].position.y,o=c[f].getValue(x,p,I,c[f].reflect,this._options.gravity),this._currentRigOutputs.at(v).outputs[f]=o;let F=c[f].destinationParameterIndex,R=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(F))):this._parameterCaches.slice(F);wr(R,d[F],g[F],o,c[f]);for(let H=F,mt=0;H<this._parameterCaches.length;H++,mt++)this._parameterCaches[H]=R[mt]}}this._currentRemainTime-=m}let P=this._currentRemainTime/m;this.interpolate(t,P)}interpolate(t,e){let r,i,s,o,a;s=t.getModel().parameters.values,o=t.getModel().parameters.maximumValues,a=t.getModel().parameters.minimumValues;for(let u=0;u<this._physicsRig.subRigCount;++u){i=this._physicsRig.settings.at(u),r=this._physicsRig.outputs.get(i.baseOutputIndex);for(let l=0;l<i.outputCount;++l){if(r[l].destinationParameterIndex==-1)continue;let c=r[l].destinationParameterIndex,p=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(s.subarray(c))):s.slice(c);wr(p,a[c],o[c],this._previousRigOutputs.at(u).outputs[l]*(1-e)+this._currentRigOutputs.at(u).outputs[l]*e,r[l]);for(let b=c,g=0;b<s.length;b++,g++)s[b]=p[g]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new ke,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new C,this._previousRigOutputs=new C,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,e,r;for(let i=0;i<this._physicsRig.subRigCount;++i){e=this._physicsRig.settings.at(i),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new _(0,0),t[0].lastPosition=new _(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new _(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new _(0,0),t[0].force=new _(0,0);for(let s=1;s<e.particleCount;++s)r=new _(0,0),r.y=t[s].radius,t[s].initialPosition=new _(t[s-1].initialPosition.x+r.x,t[s-1].initialPosition.y+r.y),t[s].position=new _(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastPosition=new _(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastGravity=new _(0,-1),t[s].lastGravity.y*=-1,t[s].velocity=new _(0,0),t[s].force=new _(0,0)}}},ke=class{constructor(){this.gravity=new _(0,0),this.wind=new _(0,0)}},pr=class{constructor(){this.outputs=new C(0)}};function ma(n){let t=0;return n>0?t=1:n<0&&(t=-1),t}function pa(n,t,e,r,i,s,o,a,u,l){n.x+=Ar(e,r,i,s,o.minimum,o.maximum,o.defalut,u)*l}function ha(n,t,e,r,i,s,o,a,u,l){n.y+=Ar(e,r,i,s,o.minimum,o.maximum,o.defalut,u)*l}function ga(n,t,e,r,i,s,o,a,u,l){t.angle+=Ar(e,r,i,s,a.minimum,a.maximum,a.defalut,u)*l}function da(n,t,e,r,i){let s=n.x;return r&&(s*=-1),s}function ba(n,t,e,r,i){let s=n.y;return r&&(s*=-1),s}function fa(n,t,e,r,i){let s;return e>=2?i=t[e-1].position.substract(t[e-2].position):i=i.multiplyByScaler(-1),s=M.directionToRadian(i,n),r&&(s*=-1),s}function _a(n,t){let e=M.max(n,t),r=M.min(n,t);return M.abs(e-r)}function ya(n,t){return M.min(n,t)+_a(n,t)/2}function Ca(n,t){return JSON.parse(JSON.stringify(n.x))}function xa(n,t){return JSON.parse(JSON.stringify(n.y))}function va(n,t){return JSON.parse(JSON.stringify(t))}function Sa(n,t,e,r,i,s,o,a){let u,l,c,p,b=new _(0,0),g=new _(0,0),d=new _(0,0),h=new _(0,0);n[0].position=new _(e.x,e.y),u=M.degreesToRadian(r),p=M.radianToDirection(u),p.normalize();for(let m=1;m<t;++m)n[m].force=p.multiplyByScaler(n[m].acceleration).add(i),n[m].lastPosition=new _(n[m].position.x,n[m].position.y),l=n[m].delay*o*30,b=n[m].position.substract(n[m-1].position),c=M.directionToRadian(n[m].lastGravity,p)/a,b.x=M.cos(c)*b.x-b.y*M.sin(c),b.y=M.sin(c)*b.x+b.y*M.cos(c),n[m].position=n[m-1].position.add(b),g=n[m].velocity.multiplyByScaler(l),d=n[m].force.multiplyByScaler(l).multiplyByScaler(l),n[m].position=n[m].position.add(g).add(d),h=n[m].position.substract(n[m-1].position),h.normalize(),n[m].position=n[m-1].position.add(h.multiplyByScaler(n[m].radius)),M.abs(n[m].position.x)<s&&(n[m].position.x=0),l!=0&&(n[m].velocity=n[m].position.substract(n[m].lastPosition),n[m].velocity=n[m].velocity.divisionByScalar(l),n[m].velocity=n[m].velocity.multiplyByScaler(n[m].mobility)),n[m].force=new _(0,0),n[m].lastGravity=new _(p.x,p.y)}function Ma(n,t,e,r,i,s){let o,a,u=new _(0,0);n[0].position=new _(e.x,e.y),o=M.degreesToRadian(r),a=M.radianToDirection(o),a.normalize();for(let l=1;l<t;++l)n[l].force=a.multiplyByScaler(n[l].acceleration).add(i),n[l].lastPosition=new _(n[l].position.x,n[l].position.y),n[l].velocity=new _(0,0),u=n[l].force,u.normalize(),u=u.multiplyByScaler(n[l].radius),n[l].position=n[l-1].position.add(u),M.abs(n[l].position.x)<s&&(n[l].position.x=0),n[l].force=new _(0,0),n[l].lastGravity=new _(a.x,a.y)}function wr(n,t,e,r,i){let s,o,a;s=i.getScale(i.translationScale,i.angleScale),o=r*s,o<t?(o<i.valueBelowMinimum&&(i.valueBelowMinimum=o),o=t):o>e&&(o>i.valueExceededMaximum&&(i.valueExceededMaximum=o),o=e),a=i.weight/Er,a>=1||(o=n[0]*(1-a)+o*a),n[0]=o}function Ar(n,t,e,r,i,s,o,a){let u=0,l=M.max(e,t);l<n&&(n=l);let c=M.min(e,t);c>n&&(n=c);let p=M.min(i,s),b=M.max(i,s),g=o,d=ya(c,l),h=n-d;switch(ma(h)){case 1:{let m=b-g,P=l-d;P!=0&&(u=h*(m/P),u+=g);break}case-1:{let m=p-g,P=c-d;P!=0&&(u=h*(m/P),u+=g);break}case 0:{u=g;break}default:break}return a?u:u*-1}var Pa;(e=>(e.CubismPhysics=yt,e.Options=ke))(Pa||={});var Et=class{constructor(t,e,r,i){this.x=t,this.y=e,this.width=r,this.height=i}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}},Ba;(t=>t.csmRect=Et)(Ba||={});var Rr=4,Ta=10,$t,Ue,Fr,Ht=class{getChannelFlagAsColor(t){return this._channelColors.at(t)}getMaskRenderTexture(){let t=0;if(this._maskTexture&&this._maskTexture.texture!=0&&(this._maskTexture.frameNo=this._currentFrameNo,t=this._maskTexture.texture),t==0){let e=this._clippingMaskBufferSize;this._colorBuffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this._colorBuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._colorBuffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Fr),this._maskTexture=new ze(this._currentFrameNo,t)}return t}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let r=Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE,o=Number.MIN_VALUE,a=e._clippedDrawableIndexList.length;for(let u=0;u<a;u++){let l=e._clippedDrawableIndexList[u],c=t.getDrawableVertexCount(l),p=t.getDrawableVertices(l),b=Number.MAX_VALUE,g=Number.MAX_VALUE,d=Number.MIN_VALUE,h=Number.MIN_VALUE,m=c*K.vertexStep;for(let P=K.vertexOffset;P<m;P+=K.vertexStep){let S=p[P],v=p[P+1];S<b&&(b=S),S>d&&(d=S),v<g&&(g=v),v>h&&(h=v)}if(b!=Number.MAX_VALUE)if(b<r&&(r=b),g<i&&(i=g),d>s&&(s=d),h>o&&(o=h),r==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;let P=s-r,S=o-i;e._allClippedDrawRect.x=r,e._allClippedDrawRect.y=i,e._allClippedDrawRect.width=P,e._allClippedDrawRect.height=S}}}constructor(){this._maskRenderTexture=null,this._colorBuffer=null,this._currentFrameNo=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new C,this._clippingContextListForDraw=new C,this._channelColors=new C,this._tmpBoundsOnModel=new Et,this._tmpMatrix=new L,this._tmpMatrixForMask=new L,this._tmpMatrixForDraw=new L,this._maskTexture=null;let t=new $;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new $,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new $,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.pushBack(t),t=new $,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.pushBack(t)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null,this._maskTexture&&(this.gl.deleteFramebuffer(this._maskTexture.texture),this._maskTexture=null);for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this.gl.deleteTexture(this._colorBuffer),this._colorBuffer=null}initialize(t,e,r,i){for(let s=0;s<e;s++){if(i[s]<=0){this._clippingContextListForDraw.pushBack(null);continue}let o=this.findSameClip(r[s],i[s]);o==null&&(o=new $e(this,r[s],i[s]),this._clippingContextListForMask.pushBack(o)),o.addClippedDrawable(s),this._clippingContextListForDraw.pushBack(o)}}setupClippingContext(t,e){this._currentFrameNo++;let r=0;for(let i=0;i<this._clippingContextListForMask.getSize();i++){let s=this._clippingContextListForMask.at(i);this.calcClippedDrawTotalBounds(t,s),s._isUsing&&r++}if(r>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._maskRenderTexture=this.getMaskRenderTexture();let i=e.getMvpMatrix();e.preDraw(),this.setupLayoutBounds(r),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTexture),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(let s=0;s<this._clippingContextListForMask.getSize();s++){let o=this._clippingContextListForMask.at(s),a=o._allClippedDrawRect,u=o._layoutBounds,l=.05;this._tmpBoundsOnModel.setRect(a),this._tmpBoundsOnModel.expand(a.width*l,a.height*l);let c=u.width/this._tmpBoundsOnModel.width,p=u.height/this._tmpBoundsOnModel.height;this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(u.x,u.y),this._tmpMatrix.scaleRelative(c,p),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(u.x,u.y),this._tmpMatrix.scaleRelative(c,p),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),o._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),o._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());let b=o._clippingIdCount;for(let g=0;g<b;g++){let d=o._clippingIdList[g];!t.getDrawableDynamicFlagVertexPositionsDidChange(d)||(e.setIsCulling(t.getDrawableCulling(d)!=!1),e.setClippingContextBufferForMask(o),e.drawMesh(t.getDrawableTextureIndex(d),t.getDrawableVertexIndexCount(d),t.getDrawableVertexCount(d),t.getDrawableVertexIndices(d),t.getDrawableVertices(d),t.getDrawableVertexUvs(d),t.getMultiplyColor(d),t.getScreenColor(d),t.getDrawableOpacity(d),0,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Fr),e.setClippingContextBufferForMask(null),this.gl.viewport(Ue[0],Ue[1],Ue[2],Ue[3])}}findSameClip(t,e){for(let r=0;r<this._clippingContextListForMask.getSize();r++){let i=this._clippingContextListForMask.at(r),s=i._clippingIdCount;if(s!=e)continue;let o=0;for(let a=0;a<s;a++){let u=i._clippingIdList[a];for(let l=0;l<s;l++)if(t[l]==u){o++;break}}if(o==s)return i}return null}setupLayoutBounds(t){let e=t/Rr,r=t%Rr;e=~~e,r=~~r;let i=0;for(let s=0;s<Rr;s++){let o=e+(s<r?1:0);if(o!=0)if(o==1){let a=this._clippingContextListForMask.at(i++);a._layoutChannelNo=s,a._layoutBounds.x=0,a._layoutBounds.y=0,a._layoutBounds.width=1,a._layoutBounds.height=1}else if(o==2)for(let a=0;a<o;a++){let u=a%2;u=~~u;let l=this._clippingContextListForMask.at(i++);l._layoutChannelNo=s,l._layoutBounds.x=u*.5,l._layoutBounds.y=0,l._layoutBounds.width=.5,l._layoutBounds.height=1}else if(o<=4)for(let a=0;a<o;a++){let u=a%2,l=a/2;u=~~u,l=~~l;let c=this._clippingContextListForMask.at(i++);c._layoutChannelNo=s,c._layoutBounds.x=u*.5,c._layoutBounds.y=l*.5,c._layoutBounds.width=.5,c._layoutBounds.height=.5}else if(o<=9)for(let a=0;a<o;a++){let u=a%3,l=a/3;u=~~u,l=~~l;let c=this._clippingContextListForMask.at(i++);c._layoutChannelNo=s,c._layoutBounds.x=u/3,c._layoutBounds.y=l/3,c._layoutBounds.width=1/3,c._layoutBounds.height=1/3}else{k("not supported mask count : {0}",o);for(let a=0;a<o;a++){let u=this._clippingContextListForMask.at(i++);u._layoutChannelNo=0,u._layoutBounds.x=0,u._layoutBounds.y=0,u._layoutBounds.width=1,u._layoutBounds.height=1}}}}getColorBuffer(){return this._colorBuffer}getClippingContextListForDraw(){return this._clippingContextListForDraw}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}},ze=class{constructor(t,e){this.frameNo=t,this.texture=e}},$e=class{constructor(t,e,r){this._owner=t,this._clippingIdList=e,this._clippingIdCount=r,this._allClippedDrawRect=new Et,this._layoutBounds=new Et,this._clippedDrawableIndexList=[],this._matrixForMask=new L,this._matrixForDraw=new L}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}},Ct=class{static getInstance(){return $t==null&&($t=new Ct),$t}static deleteInstance(){$t&&($t.release(),$t=null)}constructor(){this._shaderSets=new C}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,r,i,s,o,a,u,l,c,p,b,g,d,h){g||k("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let m,P,S,v;if(t.getClippingContextBufferForMask()!=null){let f=this._shaderSets.at(Gt.ShaderNames_SetupMask);this.gl.useProgram(f.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(f.samplerTexture0Location,0),a.vertex==null&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(f.attributePositionLocation),this.gl.vertexAttribPointer(f.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),a.uv==null&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(f.attributeTexCoordLocation),this.gl.vertexAttribPointer(f.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);let I=t.getClippingContextBufferForMask()._layoutChannelNo,x=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(I);this.gl.uniform4f(f.uniformChannelFlagLocation,x.R,x.G,x.B,x.A),this.gl.uniformMatrix4fv(f.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());let F=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(f.uniformBaseColorLocation,F.x*2-1,F.y*2-1,F.getRight()*2-1,F.getBottom()*2-1),this.gl.uniform4f(f.uniformMultiplyColorLocation,p.R,p.G,p.B,p.A),this.gl.uniform4f(f.uniformScreenColorLocation,b.R,b.G,b.B,b.A),m=this.gl.ZERO,P=this.gl.ONE_MINUS_SRC_COLOR,S=this.gl.ZERO,v=this.gl.ONE_MINUS_SRC_ALPHA}else{let f=t.getClippingContextBufferForDraw()!=null,I=f?h?2:1:0,x=new Se;switch(l){case 0:default:x=this._shaderSets.at(Gt.ShaderNames_NormalPremultipliedAlpha+I),m=this.gl.ONE,P=this.gl.ONE_MINUS_SRC_ALPHA,S=this.gl.ONE,v=this.gl.ONE_MINUS_SRC_ALPHA;break;case 1:x=this._shaderSets.at(Gt.ShaderNames_AddPremultipliedAlpha+I),m=this.gl.ONE,P=this.gl.ONE,S=this.gl.ZERO,v=this.gl.ONE;break;case 2:x=this._shaderSets.at(Gt.ShaderNames_MultPremultipliedAlpha+I),m=this.gl.DST_COLOR,P=this.gl.ONE_MINUS_SRC_ALPHA,S=this.gl.ZERO,v=this.gl.ONE;break}if(this.gl.useProgram(x.shaderProgram),a.vertex==null&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(x.attributePositionLocation),this.gl.vertexAttribPointer(x.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),a.uv==null&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(x.attributeTexCoordLocation),this.gl.vertexAttribPointer(x.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),f){this.gl.activeTexture(this.gl.TEXTURE1);let F=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer();this.gl.bindTexture(this.gl.TEXTURE_2D,F),this.gl.uniform1i(x.samplerTexture1Location,1),this.gl.uniformMatrix4fv(x.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());let R=t.getClippingContextBufferForDraw()._layoutChannelNo,H=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(R);this.gl.uniform4f(x.uniformChannelFlagLocation,H.R,H.G,H.B,H.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(x.samplerTexture0Location,0),this.gl.uniformMatrix4fv(x.uniformMatrixLocation,!1,d.getArray()),this.gl.uniform4f(x.uniformBaseColorLocation,c.R,c.G,c.B,c.A),this.gl.uniform4f(x.uniformMultiplyColorLocation,p.R,p.G,p.B,p.A),this.gl.uniform4f(x.uniformScreenColorLocation,b.R,b.G,b.B,b.A)}a.index==null&&(a.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(m,P,S,v)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<Ta;t++)this._shaderSets.pushBack(new Se);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(wa,Ea),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(Aa,Ra),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(vi,Fa),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(vi,La),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,e){let r=this.gl.createProgram(),i=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!i)return k("Vertex shader compile error!"),0;let s=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return s?(this.gl.attachShader(r,i),this.gl.attachShader(r,s),this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS)?(this.gl.deleteShader(i),this.gl.deleteShader(s),r):(k("Failed to link program: {0}",r),this.gl.deleteShader(i),i=0,this.gl.deleteShader(s),s=0,r&&(this.gl.deleteProgram(r),r=0),0)):(k("Vertex shader compile error!"),0)}compileShaderSource(t,e){let r=e,i=this.gl.createShader(t);if(this.gl.shaderSource(i,r),this.gl.compileShader(i),!i){let o=this.gl.getShaderInfoLog(i);k("Shader compile log: {0} ",o)}return this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(this.gl.deleteShader(i),null)}setGl(t){this.gl=t}},Se=class{},Gt=(c=>(c[c.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",c[c.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",c[c.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",c[c.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",c[c.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",c[c.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",c[c.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",c[c.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",c[c.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",c[c.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",c))(Gt||{}),wa="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Ea="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",Aa="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",vi="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Ra="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",Fa="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",La="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}",Wt=class extends dt{constructor(){super();this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._clippingManager=new Ht,this.firstDraw=!0,this._textures=new N,this._sortedDrawableIndexList=new C,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}initialize(e){e.isUsingMasking()&&(this._clippingManager=new Ht,this._clippingManager.initialize(e,e.getDrawableCount(),e.getDrawableMasks(),e.getDrawableMaskCounts())),this._sortedDrawableIndexList.resize(e.getDrawableCount(),0),super.initialize(e)}bindTexture(e,r){this._textures.setValue(e,r)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(e){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new Ht,this._clippingManager.setClippingMaskBufferSize(e),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts())}getClippingMaskBufferSize(){return this._clippingManager.getClippingMaskBufferSize()}release(){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null}doDrawModel(){this._clippingManager!=null&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();let e=this.getModel().getDrawableCount(),r=this.getModel().getDrawableRenderOrders();for(let i=0;i<e;++i){let s=r[i];this._sortedDrawableIndexList.set(s,i)}for(let i=0;i<e;++i){let s=this._sortedDrawableIndexList.at(i);!this.getModel().getDrawableDynamicFlagIsVisible(s)||(this.setClippingContextBufferForDraw(this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(s):null),this.setIsCulling(this.getModel().getDrawableCulling(s)),this.drawMesh(this.getModel().getDrawableTextureIndex(s),this.getModel().getDrawableVertexIndexCount(s),this.getModel().getDrawableVertexCount(s),this.getModel().getDrawableVertexIndices(s),this.getModel().getDrawableVertices(s),this.getModel().getDrawableVertexUvs(s),this.getModel().getMultiplyColor(s),this.getModel().getScreenColor(s),this.getModel().getDrawableOpacity(s),this.getModel().getDrawableBlendMode(s),this.getModel().getDrawableInvertedMaskBit(s)))}}drawMesh(e,r,i,s,o,a,u,l,c,p,b){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);let g=this.getModelColor();this.getClippingContextBufferForMask()==null&&(g.A*=c,this.isPremultipliedAlpha()&&(g.R*=g.A,g.G*=g.A,g.B*=g.A));let d;this._textures.getValue(e)!=null?d=this._textures.getValue(e):d=null,Ct.getInstance().setupShaderProgram(this,d,i,o,s,a,this._bufferData,c,p,g,u,l,this.isPremultipliedAlpha(),this.getMvpMatrix(),b),this.gl.drawElements(this.gl.TRIANGLES,r,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}static doStaticRelease(){Ct.deleteInstance()}setRenderState(e,r){Fr=e,Ue=r}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let e=0;e<this._textures.getSize();++e)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(e)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(e){this._clippingContextBufferForMask=e}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(e){this._clippingContextBufferForDraw=e}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(e){this.gl=e,this._clippingManager.setGL(e),Ct.getInstance().setGl(e),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}};dt.staticRelease=()=>{Wt.doStaticRelease()};var Da;(a=>(a.CubismClippingContext=$e,a.CubismClippingManager_WebGL=Ht,a.CubismRenderTextureResource=ze,a.CubismRenderer_WebGL=Wt,a.CubismShaderSet=Se,a.CubismShader_WebGL=Ct,a.ShaderNames=Gt))(Da||={});var hr=class{constructor(){this.isOverwritten=!1;this.Color=new $}},Me=class{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){let t=this._model.parameters.count,e=this._savedParameters.getSize();for(let r=0;r<t;++r)r<e?this._savedParameters.set(r,this._parameterValues[r]):this._savedParameters.pushBack(this._parameterValues[r])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors.at(t).Color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors.at(t).Color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setMultiplyColorByRGBA(t,e,r,i,s=1){this._userMultiplyColors.at(t).Color.R=e,this._userMultiplyColors.at(t).Color.G=r,this._userMultiplyColors.at(t).Color.B=i,this._userMultiplyColors.at(t).Color.A=s}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setScreenColorByRGBA(t,e,r,i,s=1){this._userScreenColors.at(t).Color.R=e,this._userScreenColors.at(t).Color.G=r,this._userScreenColors.at(t).Color.B=i,this._userScreenColors.at(t).Color.A=s}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userMultiplyColors.at(t).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors.at(t).isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors.at(t).isOverwritten=e}getModel(){return this._model}getPartIndex(t){let e,r=this._model.parts.count;for(e=0;e<r;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=r+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(this._notExistPartOpacities.isExist(t)){this._notExistPartOpacities.setValue(t,e);return}U(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){let r=this.getPartIndex(t);r<0||this.setPartOpacityByIndex(r,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(U(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){let e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e,r=this._model.parameters.count;for(e=0;e<r;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(U(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){let e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,r=1){if(this._notExistParameterValues.isExist(t)){this._notExistParameterValues.setValue(t,r==1?e:this._notExistParameterValues.getValue(t)*(1-r)+e*r);return}U(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=r==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-r)+e*r}setParameterValueById(t,e,r=1){let i=this.getParameterIndex(t);this.setParameterValueByIndex(i,e,r)}addParameterValueByIndex(t,e,r=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*r)}addParameterValueById(t,e,r=1){let i=this.getParameterIndex(t);this.addParameterValueByIndex(i,e,r)}multiplyParameterValueById(t,e,r=1){let i=this.getParameterIndex(t);this.multiplyParameterValueByIndex(i,e,r)}multiplyParameterValueByIndex(t,e,r=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*r))}getDrawableIndex(t){let e=this._model.drawables.count;for(let r=0;r<e;++r)if(this._drawableIds.at(r)==t)return r;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){let e=this._model.drawables.ids;return B.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){let e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){let e=this._model.drawables.multiplyColors,r=t*4,i=new $;return i.R=e[r],i.G=e[r+1],i.B=e[r+2],i.A=e[r+3],i}getDrawableScreenColor(t){let e=this._model.drawables.screenColors,r=t*4,i=new $;return i.R=e[r],i.G=e[r+1],i.B=e[r+2],i.A=e[r+3],i}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableCulling(t){let e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}getDrawableBlendMode(t){let e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?1:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?2:0}getDrawableInvertedMaskBit(t){let e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){let e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){let e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){let e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){let e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){let e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count,e=this._savedParameters.getSize();t>e&&(t=e);for(let r=0;r<t;++r)this._parameterValues[r]=this._savedParameters.at(r)}initialize(){U(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{let t=this._model.parameters.ids,e=this._model.parameters.count;this._parameterIds.prepareCapacity(e);for(let r=0;r<e;++r)this._parameterIds.pushBack(B.getIdManager().getId(t[r]))}{let t=this._model.parts.ids,e=this._model.parts.count;this._partIds.prepareCapacity(e);for(let r=0;r<e;++r)this._partIds.pushBack(B.getIdManager().getId(t[r]))}{let t=this._model.drawables.ids,e=this._model.drawables.count;this._userMultiplyColors=new C,this._userMultiplyColors.updateSize(e,hr,!0),this._userScreenColors=new C,this._userScreenColors.updateSize(e,hr,!0),this._drawableIds.prepareCapacity(e);for(let r=0;r<e;++r)this._drawableIds.pushBack(B.getIdManager().getId(t[r])),this.setMultiplyColorByRGBA(r,1,1,1,1),this.setScreenColorByRGBA(r,0,0,0,1)}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new C,this._parameterIds=new C,this._drawableIds=new C,this._partIds=new C,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._userMultiplyColors=null,this._userScreenColors=null,this._notExistPartId=new N,this._notExistParameterId=new N,this._notExistParameterValues=new N,this._notExistPartOpacities=new N}release(){this._model.release(),this._model=null}},Oa;(t=>t.CubismModel=Me)(Oa||={});var At=class{static create(t){let e=null,r=Live2DCubismCore.Moc.fromArrayBuffer(t);return r&&(e=new At(r),e._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(r,t)),e}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null,e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new Me(e),t.initialize(),++this._modelCount),t}deleteModel(t){t!=null&&(t.release(),t=null,--this._modelCount)}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){U(this._modelCount==0),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}},Ua;(t=>t.CubismMoc=At)(Ua||={});var Si="Meta",$a="UserDataCount",Ga="TotalUserDataSize",Lr="UserData",Ha="Target",Wa="Id",qa="Value",Pe=class{constructor(t,e){this._json=E.create(t,e)}release(){E.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(Si).getValueByString($a).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(Si).getValueByString(Ga).toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(Lr).getValueByIndex(t).getValueByString(Ha).getRawString()}getUserDataId(t){return B.getIdManager().getId(this._json.getRoot().getValueByString(Lr).getValueByIndex(t).getValueByString(Wa).getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(Lr).getValueByIndex(t).getValueByString(qa).getRawString()}},ja;(t=>t.CubismModelUserDataJson=Pe)(ja||={});var Ya="ArtMesh",Ge=class{},xt=class{static create(t,e){let r=new xt;return r.parseUserData(t,e),r}static delete(t){t!=null&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let r=new Pe(t,e),i=B.getIdManager().getId(Ya),s=r.getUserDataCount();for(let o=0;o<s;o++){let a=new Ge;a.targetId=r.getUserDataId(o),a.targetType=B.getIdManager().getId(r.getUserDataTargetType(o)),a.value=new D(r.getUserDataValue(o)),this._userDataNodes.pushBack(a),a.targetType==i&&this._artMeshUserDataNode.pushBack(a)}r.release(),r=void 0}constructor(){this._userDataNodes=new C,this._artMeshUserDataNode=new C}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}},Ja;(e=>(e.CubismModelUserData=xt,e.CubismModelUserDataNode=Ge))(Ja||={});var Rt=class{constructor(){this.loadMotion=(t,e,r,i)=>lt.create(t,e,i);this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._debugMode=!1,this._renderer=null,this._motionManager=new kt,this._motionManager.setEventCallback(Rt.cubismDefaultMotionEventCallback,this),this._expressionManager=new kt,this._dragManager=new ne}isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,r){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=r}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t){if(this._moc=At.create(t),this._moc==null){k("Failed to CubismMoc.create().");return}if(this._model=this._moc.createModel(),this._model==null){k("Failed to CreateModel().");return}this._model.saveParameters(),this._modelMatrix=new se(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadExpression(t,e,r){return Tt.create(t,e)}loadPose(t,e){this._pose=ft.create(t,e)}loadUserData(t,e){this._modelUserData=xt.create(t,e)}loadPhysics(t,e){this._physics=yt.create(t,e)}isHit(t,e,r){let i=this._model.getDrawableIndex(t);if(i<0)return!1;let s=this._model.getDrawableVertexCount(i),o=this._model.getDrawableVertices(i),a=o[0],u=o[0],l=o[1],c=o[1];for(let g=1;g<s;++g){let d=o[K.vertexOffset+g*K.vertexStep],h=o[K.vertexOffset+g*K.vertexStep+1];d<a&&(a=d),d>u&&(u=d),h<l&&(l=h),h>c&&(c=h)}let p=this._modelMatrix.invertTransformX(e),b=this._modelMatrix.invertTransformY(r);return a<=p&&p<=u&&l<=b&&b<=c}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(){this._renderer&&this.deleteRenderer(),this._renderer=new Wt,this._renderer.initialize(this._model)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){W("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,r){let i=r;i?.motionEventFired(e)}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,ft.delete(this._pose),bt.delete(this._eyeBlink),at.delete(this._breath),this._dragManager=null,yt.delete(this._physics),xt.delete(this._modelUserData),this.deleteRenderer()}},Qa;(t=>t.CubismUserModel=Rt)(Qa||={});var j=Uint8Array,qt=Uint16Array,Mi=Uint32Array,Pi=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vi=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),to=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bi=function(n,t){for(var e=new qt(31),r=0;r<31;++r)e[r]=t+=1<<n[r-1];for(var i=new Mi(e[30]),r=1;r<30;++r)for(var s=e[r];s<e[r+1];++s)i[s]=s-e[r]<<5|r;return[e,i]},Ii=Bi(Pi,2),Ti=Ii[0],eo=Ii[1];Ti[28]=258,eo[258]=28;var wi=Bi(Vi,0),ro=wi[0],wl=wi[1],kr=new qt(32768);for(T=0;T<32768;++T)vt=(T&43690)>>>1|(T&21845)<<1,vt=(vt&52428)>>>2|(vt&13107)<<2,vt=(vt&61680)>>>4|(vt&3855)<<4,kr[T]=((vt&65280)>>>8|(vt&255)<<8)>>>1;var vt,T,He=function(n,t,e){for(var r=n.length,i=0,s=new qt(t);i<r;++i)n[i]&&++s[n[i]-1];var o=new qt(t);for(i=0;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(e){a=new qt(1<<t);var u=15-t;for(i=0;i<r;++i)if(n[i])for(var l=i<<4|n[i],c=t-n[i],p=o[n[i]-1]++<<c,b=p|(1<<c)-1;p<=b;++p)a[kr[p]>>>u]=l}else for(a=new qt(r),i=0;i<r;++i)n[i]&&(a[i]=kr[o[n[i]-1]++]>>>15-n[i]);return a},We=new j(288);for(T=0;T<144;++T)We[T]=8;var T;for(T=144;T<256;++T)We[T]=9;var T;for(T=256;T<280;++T)We[T]=7;var T;for(T=280;T<288;++T)We[T]=8;var T,Ei=new j(32);for(T=0;T<32;++T)Ei[T]=5;var T;var io=He(We,9,1);var so=He(Ei,5,1),Dr=function(n){for(var t=n[0],e=1;e<n.length;++e)n[e]>t&&(t=n[e]);return t},Q=function(n,t,e){var r=t/8|0;return(n[r]|n[r+1]<<8)>>(t&7)&e},Nr=function(n,t){var e=t/8|0;return(n[e]|n[e+1]<<8|n[e+2]<<16)>>(t&7)},no=function(n){return(n+7)/8|0},zr=function(n,t,e){(t==null||t<0)&&(t=0),(e==null||e>n.length)&&(e=n.length);var r=new(n.BYTES_PER_ELEMENT==2?qt:n.BYTES_PER_ELEMENT==4?Mi:j)(e-t);return r.set(n.subarray(t,e)),r};var ao=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Z=function(n,t,e){var r=new Error(t||ao[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,Z),!e)throw r;return r},oo=function(n,t,e){var r=n.length;if(!r||e&&e.f&&!e.l)return t||new j(0);var i=!t||e,s=!e||e.i;e||(e={}),t||(t=new j(r*3));var o=function(_r){var yr=t.length;if(_r>yr){var Cr=new j(Math.max(yr*2,_r));Cr.set(t),t=Cr}},a=e.f||0,u=e.p||0,l=e.b||0,c=e.l,p=e.d,b=e.m,g=e.n,d=r*8;do{if(!c){a=Q(n,u,1);var h=Q(n,u+1,3);if(u+=3,h)if(h==1)c=io,p=so,b=9,g=5;else if(h==2){var v=Q(n,u,31)+257,f=Q(n,u+10,15)+4,I=v+Q(n,u+5,31)+1;u+=14;for(var x=new j(I),F=new j(19),R=0;R<f;++R)F[to[R]]=Q(n,u+R*3,7);u+=f*3;for(var H=Dr(F),mt=(1<<H)-1,Be=He(F,H,1),R=0;R<I;){var Xt=Be[Q(n,u,mt)];u+=Xt&15;var m=Xt>>>4;if(m<16)x[R++]=m;else{var pt=0,Ie=0;for(m==16?(Ie=3+Q(n,u,3),u+=2,pt=x[R-1]):m==17?(Ie=3+Q(n,u,7),u+=3):m==18&&(Ie=11+Q(n,u,127),u+=7);Ie--;)x[R++]=pt}}var dr=x.subarray(0,v),ht=x.subarray(v);b=Dr(dr),g=Dr(ht),c=He(dr,b,1),p=He(ht,g,1)}else Z(1);else{var m=no(u)+4,P=n[m-4]|n[m-3]<<8,S=m+P;if(S>r){s&&Z(0);break}i&&o(l+P),t.set(n.subarray(m,S),l),e.b=l+=P,e.p=u=S*8,e.f=a;continue}if(u>d){s&&Z(0);break}}i&&o(l+131072);for(var $r=(1<<b)-1,Gr=(1<<g)-1,qe=u;;qe=u){var pt=c[Nr(n,u)&$r],Lt=pt>>>4;if(u+=pt&15,u>d){s&&Z(0);break}if(pt||Z(2),Lt<256)t[l++]=Lt;else if(Lt==256){qe=u,c=null;break}else{var br=Lt-254;if(Lt>264){var R=Lt-257,Yt=Pi[R];br=Q(n,u,(1<<Yt)-1)+Ti[R],u+=Yt}var je=p[Nr(n,u)&Gr],Xe=je>>>4;je||Z(3),u+=je&15;var ht=ro[Xe];if(Xe>3){var Yt=Vi[Xe];ht+=Nr(n,u)&(1<<Yt)-1,u+=Yt}if(u>d){s&&Z(0);break}i&&o(l+131072);for(var fr=l+br;l<fr;l+=4)t[l]=t[l-ht],t[l+1]=t[l+1-ht],t[l+2]=t[l+2-ht],t[l+3]=t[l+3-ht];l=fr}}e.l=c,e.p=qe,e.b=l,e.f=a,c&&(a=1,e.m=b,e.d=p,e.n=g)}while(!a);return l==t.length?t:zr(t,0,l)};var uo=new j(0);var ct=function(n,t){return n[t]|n[t+1]<<8},tt=function(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24)>>>0},Or=function(n,t){return tt(n,t)+tt(n,t+4)*4294967296};function lo(n,t){return oo(n,t)}var Ur=typeof TextDecoder<"u"&&new TextDecoder,co=0;try{Ur.decode(uo,{stream:!0}),co=1}catch{}var mo=function(n){for(var t="",e=0;;){var r=n[e++],i=(r>127)+(r>223)+(r>239);if(e+i>n.length)return[t,zr(n,e-1)];i?i==3?(r=((r&15)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?t+=String.fromCharCode((r&31)<<6|n[e++]&63):t+=String.fromCharCode((r&15)<<12|(n[e++]&63)<<6|n[e++]&63):t+=String.fromCharCode(r)}};function po(n,t){if(t){for(var e="",r=0;r<n.length;r+=16384)e+=String.fromCharCode.apply(null,n.subarray(r,r+16384));return e}else{if(Ur)return Ur.decode(n);var i=mo(n),s=i[0],o=i[1];return o.length&&Z(8),s}}var ho=function(n,t){return t+30+ct(n,t+26)+ct(n,t+28)},go=function(n,t,e){var r=ct(n,t+28),i=po(n.subarray(t+46,t+46+r),!(ct(n,t+8)&2048)),s=t+46+r,o=tt(n,t+20),a=e&&o==4294967295?bo(n,s):[o,tt(n,t+24),tt(n,t+42)],u=a[0],l=a[1],c=a[2];return[ct(n,t+10),u,l,i,s+ct(n,t+30)+ct(n,t+32),c]},bo=function(n,t){for(;ct(n,t)!=1;t+=4+ct(n,t+2));return[Or(n,t+12),Or(n,t+4),Or(n,t+20)]};function Ai(n,t){for(var e={},r=n.length-22;tt(n,r)!=101010256;--r)(!r||n.length-r>65558)&&Z(13);var i=ct(n,r+8);if(!i)return{};var s=tt(n,r+16),o=s==4294967295||i==65535;if(o){var a=tt(n,r-12);o=tt(n,a)==101075792,o&&(i=tt(n,a+32),s=tt(n,a+48))}for(var u=t&&t.filter,l=0;l<i;++l){var c=go(n,s,o),p=c[0],b=c[1],g=c[2],d=c[3],h=c[4],m=c[5],P=ho(n,m);s=h,(!u||u({name:d,size:b,originalSize:g,compression:p}))&&(p?p==8?e[d]=lo(n.subarray(P,P+b),new j(g)):Z(14,"unknown compression type "+p):e[d]=zr(n,P,P+b))}return e}var jt={currentFrame:Date.now(),lastFrame:0,deltaTime:0};function Ri(n){return n.replace(/[?#][^/]*$/,"")}function fo(n){let t=Array.from(n.keys()).map(i=>i.split("/")),e=0,r="";for(;;){let i=t[0][e];if(!t.every(s=>s[e]===i))return r;e+=1,r=i}}async function Fi(n){let t=Ai(n,{filter:e=>!e.name.endsWith("/")});return new Map(Object.entries(t))}var Ve=class extends Rt{settings;glContext;expresssionsMap=new N;eyeblinkIds=new C;lipsyncIds=new C;motionsMap=new N;contentBufferMap=new Map;parentDir="";motionHandle=null;cacheBucketName="";hitTest;isRunning=!1;constructor(){super()}static async init({path:t,hitTest:e},r,i){B.startUp({logFunction:a=>{},loggingLevel:5}),B.initialize();let s=new Ve;s.cacheBucketName=`${Je}-v${r}`,await s.deleteOldCaches(),s.glContext=i,s.setupWebglFeatures(),s.hitTest=e;let o;if(Ri(t).endsWith(".json"))s.parentDir=Ri(t).replace(/\\/[^/]*$/,""),o=await s.getBuffer(t,!0);else{await s.fetchZip(t),s.parentDir=fo(s.contentBufferMap);let a=Array.from(s.contentBufferMap.keys()).filter(u=>u.endsWith(".model3.json"))[0];o=await s.getBuffer(a,!0)}return s.settings=new re(o,o.byteLength),s}flushWebglContext(){this.glContext.flush()}setupWebglFeatures(){this.glContext.clearColor(0,0,0,1),this.glContext.enable(this.glContext.DEPTH_TEST),this.glContext.depthFunc(this.glContext.LEQUAL),this.glContext.clear(this.glContext.COLOR_BUFFER_BIT|this.glContext.DEPTH_BUFFER_BIT),this.glContext.clearDepth(1),this.glContext.enable(this.glContext.BLEND),this.glContext.blendFunc(this.glContext.SRC_ALPHA,this.glContext.ONE_MINUS_SRC_ALPHA)}async load(){await this.loadModelImpl(),await this.loadExpressionImpl(),await this.loadPhysicsImpl(),await this.loadPoseImpl(),this.setupEyeblinking(),this.setupBreathing(),this.setupEyeblinkIds(),this.setupLayout(),super.createRenderer(),await this.setupTextures(),this.getRenderer().setIsPremultipliedAlpha(!0),this.getRenderer().startUp(this.glContext)}async deleteOldCaches(){(await caches.keys()).filter(e=>e.startsWith(Je)).filter(e=>e<this.cacheBucketName).forEach(async e=>await caches.delete(e))}async getBuffer(t,e=!1){let r=e?t:`${this.parentDir}/${t}`,i=this.contentBufferMap.get(r);if(i!=null)return i;let s=await caches.open(this.cacheBucketName),o=await s.match(r);return o==null?(await s.add(r),this.contentBufferMap.set(r,await(await s.match(r)).arrayBuffer())):this.contentBufferMap.get(r)==null&&this.contentBufferMap.set(r,await o.arrayBuffer()),this.contentBufferMap.get(r)}async fetchZip(t){let e=await caches.open(Je),r=await e.match(t);if(r==null){await e.add(t);let i=await e.match(t);this.contentBufferMap=await Fi(new Uint8Array(await i.arrayBuffer()))}else Object.keys(this.contentBufferMap).length===0&&(this.contentBufferMap=await Fi(new Uint8Array(await r.arrayBuffer())))}async loadModelImpl(){let t=this.settings.getModelFileName();if(t==="")return;let e=await this.getBuffer(t);super.loadModel(e)}async loadExpressionImpl(){let t=this.settings.getExpressionCount();if(!(t<1))for(let e=0;e<t;e++){let r=this.settings.getExpressionName(e),i=this.settings.getExpressionFileName(e),s=await this.getBuffer(i),o=this.loadExpression(s,s.byteLength,r);this.expresssionsMap.setValue(r,o)}}async loadPhysicsImpl(){let t=this.settings.getPhysicsFileName();if(t==="")return;let e=await this.getBuffer(t);super.loadPhysics(e,e.byteLength)}async loadPoseImpl(){let t=this.settings.getPoseFileName();if(t==="")return;let e=await this.getBuffer(t);super.loadPose(e,e.byteLength)}setupEyeblinking(){this.settings.getEyeBlinkParameterCount()<1||(this._eyeBlink=bt.create(this.settings))}setupBreathing(){let t=r=>B.getIdManager().getId(r),e=new C;[{id:y.ParamAngleX,offset:0,peak:15,cycle:6.5345,weight:.5},{id:y.ParamAngleY,offset:0,peak:8,cycle:3.5345,weight:.5},{id:y.ParamAngleZ,offset:0,peak:10,cycle:5.5345,weight:.5},{id:y.ParamBodyAngleX,offset:0,peak:4,cycle:15.5345,weight:.5},{id:y.ParamBreath,offset:.5,peak:.5,cycle:3.2345,weight:1}].forEach(({id:r,offset:i,peak:s,cycle:o,weight:a})=>e.pushBack(new ie(t(r),i,s,o,a))),this._breath=at.create(),this._breath.setParameters(e)}setupEyeblinkIds(){let t=this.settings.getEyeBlinkParameterCount();for(let e=0;e<t;e++)Object.defineProperty(this.eyeblinkIds,e,this.settings.getEyeBlinkParameterId(e))}setupLayout(){let t=new N;this._modelMatrix!=null&&(this.settings.getLayoutMap(t),this._modelMatrix.setupFromLayout(t))}async startMotion(t,e,r,i){if(r===Te.Force)this._motionManager.setReservePriority(r);else if(!this._motionManager.reserveMotion(r))return he;let s=`${t}_${e}`,o=this.motionsMap.getValue(s);if(o!=null&&i!=null)return o.setFinishedMotionHandler(i),this._motionManager.startMotionPriority(o,!1,r);let a=this.settings.getMotionFileName(t,e),u=await this.getBuffer(a);o=lt.create(u,u.byteLength,i);let l=this.settings.getMotionFadeInTimeValue(t,e);l>=0&&o.setFadeInTime(l);let c=this.settings.getMotionFadeOutTimeValue(t,e);return c>=0&&o.setFadeOutTime(c),o.setEffectIds(this.eyeblinkIds,this.lipsyncIds),this._motionManager.startMotionPriority(o,!1,r)}async startRandomMotion(t,e,r){if(this.settings.getMotionCount(t)===0)return he;let i=Math.floor(Math.random()*this.settings.getMotionCount(t));return await this.startMotion(t,i,e,r)}async setupTextures(){let t=this.settings.getTextureCount();for(let e=0;e<t;e++){let r=this.settings.getTextureFileName(e);r!==""&&await this.createTextureFromPngFile(r,e)}}async createTextureFromPngFile(t,e){let r=o=>{let a=this.glContext.createTexture();return this.glContext.bindTexture(this.glContext.TEXTURE_2D,a),this.glContext.texParameteri(this.glContext.TEXTURE_2D,this.glContext.TEXTURE_MIN_FILTER,this.glContext.LINEAR_MIPMAP_LINEAR),this.glContext.texParameteri(this.glContext.TEXTURE_2D,this.glContext.TEXTURE_MAG_FILTER,this.glContext.LINEAR),this.glContext.pixelStorei(this.glContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this.glContext.texImage2D(this.glContext.TEXTURE_2D,0,this.glContext.RGBA,this.glContext.RGBA,this.glContext.UNSIGNED_BYTE,o),this.glContext.generateMipmap(this.glContext.TEXTURE_2D),this.glContext.bindTexture(this.glContext.TEXTURE_2D,null),a},i=await this.getBuffer(t),s=new Blob([new Uint8Array(i)],{type:"image/png"});this.getRenderer().bindTexture(e,r(await createImageBitmap(s)))}setExpression(t){let e=this.expresssionsMap.getValue(t);return e==null?-1:this._expressionManager.startMotionPriority(e,!1,Te.Force)}setRandomExpression(){if(this.expresssionsMap.getSize()===0)return-1;let t=Math.floor(Math.random()*this.expresssionsMap.getSize()),e=this.expresssionsMap._keyValues[t].first;return this.setExpression(e)}getDefaultExpressionName(){if(this.expresssionsMap.getSize()!==0)return this.expresssionsMap._keyValues[0].first}async touchAt(t,e){if(this.motionHandle!=null||this.hitTest==null)return;let{head:r,body:i}=this.hitTest;if(this.didHitIn(r.name,t,e))return this.motionHandle=this.setRandomExpression(),setTimeout(()=>{let s=this.getDefaultExpressionName();s!=null&&this.setExpression(s),this.motionHandle=null},2e3),r.name;if(this.didHitIn(i.name,t,e))return this.motionHandle=await this.startRandomMotion(i.group,Te.Normal,()=>this.motionHandle=null),i.name}didHitIn(t,e,r){if(this._opacity<1)return!1;for(let i=0;i<this.settings.getHitAreasCount();i++)if(this.settings.getHitAreaName(i)===t)return super.isHit(this.settings.getHitAreaId(i),e,r);return!1}async startLoop(){this.isRunning=!0,await this.loop(0)}stopLoop(){this.isRunning=!1}async loop(t){if(!this.isRunning)return;requestAnimationFrame(async s=>await this.loop(s)),jt.currentFrame=t,jt.deltaTime=(jt.currentFrame-jt.lastFrame)/1e3,jt.lastFrame=jt.currentFrame,this.flushWebglContext();let e=new L,{width:r,height:i}=this.glContext.canvas;(this.getModel().getCanvasWidth()??1)>1&&r<i?(this.getModelMatrix().setWidth(2),e.scale(1,r/i)):e.scale(i/r,1),this.draw(e,{width:r,height:i}),await this.update(jt.deltaTime)}draw(t,{width:e,height:r}){let i=super.getRenderer();t.multiplyByMatrix(this._modelMatrix),i.setMvpMatrix(t);let s=this.glContext.getParameter(this.glContext.FRAMEBUFFER_BINDING),o=[0,0,e,r];i.setRenderState(s,o),i.drawModel()}async update(t){await this._updateParameters(t),this._model.update()}addParameterValueById(t,e){return this._model.addParameterValueById(B.getIdManager().getId(t),e)}async _updateParameters(t){this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY(),this._model.loadParameters(),this._motionManager.isFinished()?await this.startRandomMotion(Xr.Idle,Te.Idle):!this._motionManager.updateMotion(this._model,t)&&this._eyeBlink!=null&&this._eyeBlink.updateParameters(this._model,t),this._model.saveParameters(),this._expressionManager?.updateMotion(this._model,t),this.addParameterValueById(y.ParamAngleX,this._dragX*30),this.addParameterValueById(y.ParamAngleY,this._dragY*30),this.addParameterValueById(y.ParamAngleZ,this._dragX*this._dragY*30),this.addParameterValueById(y.ParamBodyAngleX,this._dragX*10),this.addParameterValueById(y.ParamEyeBallX,this._dragX),this.addParameterValueById(y.ParamEyeBallY,this._dragY),this._breath?.updateParameters(this._model,t),this._physics?.evaluate(this._model,t),this._pose?.updateParameters(this._model,t)}};self.importScripts(jr);var gr,Ft;self.onmessage=async({data:n})=>{for(let{task:t,args:e}of n){if(t==="offscreenCanvas"){gr=e.canvas;continue}if(t==="resizeCanvas"){_o(e.width,e.height);continue}if(t==="load"){let r=gr.getContext("webgl");Ft=await Ve.init(e.model,e.version,r),await Ft.load(),self.postMessage({task:t});continue}if(t==="lookAt"){Ft?.setDragging(e.viewX,e.viewY);continue}if(t==="touch"){let r=await Ft?.touchAt(e.viewX,e.viewY);r!=null&&self.postMessage({task:t,args:{part:r}});continue}if(t==="release"){Ft?.stopLoop(),Ft?.release(),Ft=void 0;continue}t==="start"&&await Ft?.startLoop()}};function _o(n,t){gr.width=n,gr.height=t}})();\n')}var L=class{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){let r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),n=4;for(let a=0;a<n;++a)for(let o=0;o<n;++o)for(let l=0;l<n;++l)r[o+a*4]+=t[l+a*4]*e[o+l*4];for(let a=0;a<16;++a)i[a]=r[a]}loadIdentity(){let t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){let i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);L.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){let i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);L.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){L.multiply(t.getArray(),this._tr,this._tr)}clone(){let t=new L;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}_tr},sr;(t=>t.CubismMatrix44=L)(sr||={});var Rt=class extends L{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);let i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);L.multiply(i,this._tr,this._tr)}adjustScale(t,e,i){let r=this.getMaxScale(),n=this.getMinScale(),a=i*this._tr[0];a<n?this._tr[0]>0&&(i=n/this._tr[0]):a>r&&this._tr[0]>0&&(i=r/this._tr[0]);let o=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),l=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),u=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);L.multiply(u,this._tr,this._tr),L.multiply(l,this._tr,this._tr),L.multiply(o,this._tr,this._tr)}setScreenRect(t,e,i,r){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=r}setMaxScreenRect(t,e,i,r){this._maxLeft=t,this._maxRight=e,this._maxTop=r,this._maxBottom=i}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}_screenLeft;_screenRight;_screenTop;_screenBottom;_maxLeft;_maxRight;_maxTop;_maxBottom;_maxScale;_minScale},nr;(t=>t.CubismViewMatrix=Rt)(nr||={});function Zi(s){let t={[bt]:"Switch Model",[St]:"Hide Widget",[ht]:{turnOff:"Hide Words",turnOn:"Show Words"},[at]:"Select Language",[wt]:"About",[xt]:"Show Widget"},e={[bt]:"",[St]:"",[ht]:{turnOff:"",turnOn:""},[at]:"",[wt]:"",[xt]:""};switch(s.toLowerCase()){case"en":case"en-us":case"en_us":return t;case"ja":case"ja-jp":case"ja_jp":return e;default:return t}}var Se=Symbol.for("yaml.alias"),be=Symbol.for("yaml.document"),j=Symbol.for("yaml.map"),li=Symbol.for("yaml.pair"),F=Symbol.for("yaml.scalar"),ot=Symbol.for("yaml.seq"),R=Symbol.for("yaml.node.type"),z=s=>!!s&&typeof s=="object"&&s[R]===Se,Ct=s=>!!s&&typeof s=="object"&&s[R]===be,N=s=>!!s&&typeof s=="object"&&s[R]===j,v=s=>!!s&&typeof s=="object"&&s[R]===li,C=s=>!!s&&typeof s=="object"&&s[R]===F,W=s=>!!s&&typeof s=="object"&&s[R]===ot;function M(s){if(s&&typeof s=="object")switch(s[R]){case j:case ot:return!0}return!1}function P(s){if(s&&typeof s=="object")switch(s[R]){case Se:case j:case F:case ot:return!0}return!1}var ts=s=>(C(s)||M(s))&&!!s.anchor,dt=class{constructor(t){Object.defineProperty(this,R,{value:t})}clone(){let t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(t.range=this.range.slice()),t}};var D=Symbol("break visit"),es=Symbol("skip children"),tt=Symbol("remove node");function q(s,t){let e=is(t);Ct(s)?Dt(null,s.contents,e,Object.freeze([s]))===tt&&(s.contents=null):Dt(null,s,e,Object.freeze([]))}q.BREAK=D;q.SKIP=es;q.REMOVE=tt;function Dt(s,t,e,i){let r=ss(s,t,e,i);if(P(r)||v(r))return rs(s,i,r),Dt(s,r,e,i);if(typeof r!="symbol"){if(M(t)){i=Object.freeze(i.concat(t));for(let n=0;n<t.items.length;++n){let a=Dt(n,t.items[n],e,i);if(typeof a=="number")n=a-1;else{if(a===D)return D;a===tt&&(t.items.splice(n,1),n-=1)}}}else if(v(t)){i=Object.freeze(i.concat(t));let n=Dt("key",t.key,e,i);if(n===D)return D;n===tt&&(t.key=null);let a=Dt("value",t.value,e,i);if(a===D)return D;a===tt&&(t.value=null)}}return r}async function we(s,t){let e=is(t);Ct(s)?await Ot(null,s.contents,e,Object.freeze([s]))===tt&&(s.contents=null):await Ot(null,s,e,Object.freeze([]))}we.BREAK=D;we.SKIP=es;we.REMOVE=tt;async function Ot(s,t,e,i){let r=await ss(s,t,e,i);if(P(r)||v(r))return rs(s,i,r),Ot(s,r,e,i);if(typeof r!="symbol"){if(M(t)){i=Object.freeze(i.concat(t));for(let n=0;n<t.items.length;++n){let a=await Ot(n,t.items[n],e,i);if(typeof a=="number")n=a-1;else{if(a===D)return D;a===tt&&(t.items.splice(n,1),n-=1)}}}else if(v(t)){i=Object.freeze(i.concat(t));let n=await Ot("key",t.key,e,i);if(n===D)return D;n===tt&&(t.key=null);let a=await Ot("value",t.value,e,i);if(a===D)return D;a===tt&&(t.value=null)}}return r}function is(s){return typeof s=="object"&&(s.Collection||s.Node||s.Value)?Object.assign({Alias:s.Node,Map:s.Node,Scalar:s.Node,Seq:s.Node},s.Value&&{Map:s.Value,Scalar:s.Value,Seq:s.Value},s.Collection&&{Map:s.Collection,Seq:s.Collection},s):s}function ss(s,t,e,i){if(typeof e=="function")return e(s,t,i);if(N(t))return e.Map?.(s,t,i);if(W(t))return e.Seq?.(s,t,i);if(v(t))return e.Pair?.(s,t,i);if(C(t))return e.Scalar?.(s,t,i);if(z(t))return e.Alias?.(s,t,i)}function rs(s,t,e){let i=t[t.length-1];if(M(i))i.items[s]=e;else if(v(i))s==="key"?i.key=e:i.value=e;else if(Ct(i))i.contents=e;else{let r=z(i)?"alias":"scalar";throw new Error(`Cannot replace node with ${r} parent`)}}var or={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},lr=s=>s.replace(/[!,[\]{}]/g,t=>or[t]),T=class{constructor(t,e){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},T.defaultYaml,t),this.tags=Object.assign({},T.defaultTags,e)}clone(){let t=new T(this.yaml,this.tags);return t.docStart=this.docStart,t}atDocument(){let t=new T(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:T.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},T.defaultTags);break}return t}add(t,e){this.atNextDocument&&(this.yaml={explicit:T.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},T.defaultTags),this.atNextDocument=!1);let i=t.trim().split(/[ \t]+/),r=i.shift();switch(r){case"%TAG":{if(i.length!==2&&(e(0,"%TAG directive should contain exactly two parts"),i.length<2))return!1;let[n,a]=i;return this.tags[n]=a,!0}case"%YAML":{if(this.yaml.explicit=!0,i.length!==1)return e(0,"%YAML directive should contain exactly one part"),!1;let[n]=i;if(n==="1.1"||n==="1.2")return this.yaml.version=n,!0;{let a=/^\d+\.\d+$/.test(n);return e(6,`Unsupported YAML version ${n}`,a),!1}}default:return e(0,`Unknown directive ${r}`,!0),!1}}tagName(t,e){if(t==="!")return"!";if(t[0]!=="!")return e(`Not a valid tag: ${t}`),null;if(t[1]==="<"){let a=t.slice(2,-1);return a==="!"||a==="!!"?(e(`Verbatim tags aren't resolved, so ${t} is invalid.`),null):(t[t.length-1]!==">"&&e("Verbatim tags must end with a >"),a)}let[,i,r]=t.match(/^(.*!)([^!]*)$/);r||e(`The ${t} tag has no suffix`);let n=this.tags[i];return n?n+decodeURIComponent(r):i==="!"?t:(e(`Could not resolve tag: ${t}`),null)}tagString(t){for(let[e,i]of Object.entries(this.tags))if(t.startsWith(i))return e+lr(t.substring(i.length));return t[0]==="!"?t:`!<${t}>`}toString(t){let e=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],i=Object.entries(this.tags),r;if(t&&i.length>0&&P(t.contents)){let n={};q(t.contents,(a,o)=>{P(o)&&o.tag&&(n[o.tag]=!0)}),r=Object.keys(n)}else r=[];for(let[n,a]of i)n==="!!"&&a==="tag:yaml.org,2002:"||(!t||r.some(o=>o.startsWith(a)))&&e.push(`%TAG ${n} ${a}`);return e.join(`
`)}};T.defaultYaml={explicit:!1,version:"1.2"};T.defaultTags={"!!":"tag:yaml.org,2002:"};function xe(s){if(/[\x00-\x19\s,[\]{}]/.test(s)){let e=`Anchor must not contain whitespace or control characters: ${JSON.stringify(s)}`;throw new Error(e)}return!0}function ui(s){let t=new Set;return q(s,{Value(e,i){i.anchor&&t.add(i.anchor)}}),t}function ci(s,t){for(let e=1;;++e){let i=`${s}${e}`;if(!t.has(i))return i}}function ns(s,t){let e=[],i=new Map,r=null;return{onAnchor:n=>{e.push(n),r||(r=ui(s));let a=ci(t,r);return r.add(a),a},setAnchors:()=>{for(let n of e){let a=i.get(n);if(typeof a=="object"&&a.anchor&&(C(a.node)||M(a.node)))a.node.anchor=a.anchor;else{let o=new Error("Failed to resolve repeated object (this should not happen)");throw o.source=n,o}}},sourceObjects:i}}var lt=class extends dt{constructor(t){super(Se),this.source=t,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(t){let e;return q(t,{Node:(i,r)=>{if(r===this)return q.BREAK;r.anchor===this.source&&(e=r)}}),e}toJSON(t,e){if(!e)return{source:this.source};let{anchors:i,doc:r,maxAliasCount:n}=e,a=this.resolve(r);if(!a){let l=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(l)}let o=i.get(a);if(!o||o.res===void 0){let l="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(l)}if(n>=0&&(o.count+=1,o.aliasCount===0&&(o.aliasCount=Ce(r,a,i)),o.count*o.aliasCount>n)){let l="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(l)}return o.res}toString(t,e,i){let r=`*${this.source}`;if(t){if(xe(this.source),t.options.verifyAliasOrder&&!t.anchors.has(this.source)){let n=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(n)}if(t.implicitKey)return`${r} `}return r}};function Ce(s,t,e){if(z(t)){let i=t.resolve(s),r=e&&i&&e.get(i);return r?r.count*r.aliasCount:0}else if(M(t)){let i=0;for(let r of t.items){let n=Ce(s,r,e);n>i&&(i=n)}return i}else if(v(t)){let i=Ce(s,t.key,e),r=Ce(s,t.value,e);return Math.max(i,r)}return 1}function V(s,t,e){if(Array.isArray(s))return s.map((i,r)=>V(i,String(r),e));if(s&&typeof s.toJSON=="function"){if(!e||!ts(s))return s.toJSON(t,e);let i={aliasCount:0,count:1,res:void 0};e.anchors.set(s,i),e.onCreate=n=>{i.res=n,delete e.onCreate};let r=s.toJSON(t,e);return e.onCreate&&e.onCreate(r),r}return typeof s=="bigint"&&!e?.keep?Number(s):s}var ve=s=>!s||typeof s!="function"&&typeof s!="object",b=class extends dt{constructor(t){super(F),this.value=t}toJSON(t,e){return e?.keep?this.value:V(this.value,t,e)}toString(){return String(this.value)}};b.BLOCK_FOLDED="BLOCK_FOLDED";b.BLOCK_LITERAL="BLOCK_LITERAL";b.PLAIN="PLAIN";b.QUOTE_DOUBLE="QUOTE_DOUBLE";b.QUOTE_SINGLE="QUOTE_SINGLE";var ur="tag:yaml.org,2002:";function cr(s,t,e){if(t){let i=e.filter(n=>n.tag===t),r=i.find(n=>!n.format)??i[0];if(!r)throw new Error(`Tag ${t} not found`);return r}return e.find(i=>i.identify?.(s)&&!i.format)}function ut(s,t,e){if(Ct(s)&&(s=s.contents),P(s))return s;if(v(s)){let h=e.schema[j].createNode?.(e.schema,null,e);return h.items.push(s),h}(s instanceof String||s instanceof Number||s instanceof Boolean||typeof BigInt<"u"&&s instanceof BigInt)&&(s=s.valueOf());let{aliasDuplicateObjects:i,onAnchor:r,onTagObj:n,schema:a,sourceObjects:o}=e,l;if(i&&s&&typeof s=="object"){if(l=o.get(s),l)return l.anchor||(l.anchor=r(s)),new lt(l.anchor);l={anchor:null,node:null},o.set(s,l)}t?.startsWith("!!")&&(t=ur+t.slice(2));let u=cr(s,t,a.tags);if(!u){if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),!s||typeof s!="object"){let h=new b(s);return l&&(l.node=h),h}u=s instanceof Map?a[j]:Symbol.iterator in Object(s)?a[ot]:a[j]}n&&(n(u),delete e.onTagObj);let c=u?.createNode?u.createNode(e.schema,s,e):new b(s);return t&&(c.tag=t),l&&(l.node=c),c}function Gt(s,t,e){let i=e;for(let r=t.length-1;r>=0;--r){let n=t[r];if(typeof n=="number"&&Number.isInteger(n)&&n>=0){let a=[];a[n]=i,i=a}else i=new Map([[n,i]])}return ut(i,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:s,sourceObjects:new Map})}var Nt=s=>s==null||typeof s=="object"&&!!s[Symbol.iterator]().next().done,ct=class extends dt{constructor(t,e){super(t),Object.defineProperty(this,"schema",{value:e,configurable:!0,enumerable:!1,writable:!0})}clone(t){let e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return t&&(e.schema=t),e.items=e.items.map(i=>P(i)||v(i)?i.clone(t):i),this.range&&(e.range=this.range.slice()),e}addIn(t,e){if(Nt(t))this.add(e);else{let[i,...r]=t,n=this.get(i,!0);if(M(n))n.addIn(r,e);else if(n===void 0&&this.schema)this.set(i,Gt(this.schema,r,e));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${r}`)}}deleteIn(t){let[e,...i]=t;if(i.length===0)return this.delete(e);let r=this.get(e,!0);if(M(r))return r.deleteIn(i);throw new Error(`Expected YAML collection at ${e}. Remaining path: ${i}`)}getIn(t,e){let[i,...r]=t,n=this.get(i,!0);return r.length===0?!e&&C(n)?n.value:n:M(n)?n.getIn(r,e):void 0}hasAllNullValues(t){return this.items.every(e=>{if(!v(e))return!1;let i=e.value;return i==null||t&&C(i)&&i.value==null&&!i.commentBefore&&!i.comment&&!i.tag})}hasIn(t){let[e,...i]=t;if(i.length===0)return this.has(e);let r=this.get(e,!0);return M(r)?r.hasIn(i):!1}setIn(t,e){let[i,...r]=t;if(r.length===0)this.set(i,e);else{let n=this.get(i,!0);if(M(n))n.setIn(r,e);else if(n===void 0&&this.schema)this.set(i,Gt(this.schema,r,e));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${r}`)}}};ct.maxFlowStringSingleLineLength=60;var as=s=>s.replace(/^(?!$)(?: $)?/gm,"#");function $(s,t){return/^\n+$/.test(s)?s.substring(1):t?s.replace(/^(?! *$)/gm,t):s}var Y=(s,t,e)=>s.endsWith(`
`)?$(e,t):e.includes(`
`)?`
`+$(e,t):(s.endsWith(" ")?"":" ")+e;var hi="flow",Pe="block",Kt="quoted";function Jt(s,t,e="flow",{indentAtStart:i,lineWidth:r=80,minContentWidth:n=20,onFold:a,onOverflow:o}={}){if(!r||r<0)return s;let l=Math.max(1+n,1+r-t.length);if(s.length<=l)return s;let u=[],c={},h=r-t.length;typeof i=="number"&&(i>r-Math.max(2,n)?u.push(0):h=r-i);let d,m,y=!1,g=-1,p=-1,f=-1;e===Pe&&(g=os(s,g),g!==-1&&(h=g+l));for(let x;x=s[g+=1];){if(e===Kt&&x==="\\"){switch(p=g,s[g+1]){case"x":g+=3;break;case"u":g+=5;break;case"U":g+=9;break;default:g+=1}f=g}if(x===`
`)e===Pe&&(g=os(s,g)),h=g+l,d=void 0;else{if(x===" "&&m&&m!==" "&&m!==`
`&&m!=="	"){let _=s[g+1];_&&_!==" "&&_!==`
`&&_!=="	"&&(d=g)}if(g>=h)if(d)u.push(d),h=d+l,d=void 0;else if(e===Kt){for(;m===" "||m==="	";)m=x,x=s[g+=1],y=!0;let _=g>f+1?g-2:p-1;if(c[_])return s;u.push(_),c[_]=!0,h=_+l,d=void 0}else y=!0}m=x}if(y&&o&&o(),u.length===0)return s;a&&a();let w=s.slice(0,u[0]);for(let x=0;x<u.length;++x){let _=u[x],B=u[x+1]||s.length;_===0?w=`
${t}${s.slice(0,B)}`:(e===Kt&&c[_]&&(w+=`${s[_]}\\`),w+=`
${t}${s.slice(_+1,B)}`)}return w}function os(s,t){let e=s[t+1];for(;e===" "||e==="	";){do e=s[t+=1];while(e&&e!==`
`);e=s[t+1]}return t}var Me=s=>({indentAtStart:s.indentAtStart,lineWidth:s.options.lineWidth,minContentWidth:s.options.minContentWidth}),Ie=s=>/^(%|---|\.\.\.)/m.test(s);function hr(s,t,e){if(!t||t<0)return!1;let i=t-e,r=s.length;if(r<=i)return!1;for(let n=0,a=0;n<r;++n)if(s[n]===`
`){if(n-a>i)return!0;if(a=n+1,r-a<=i)return!1}return!0}function Qt(s,t){let e=JSON.stringify(s);if(t.options.doubleQuotedAsJSON)return e;let{implicitKey:i}=t,r=t.options.doubleQuotedMinMultiLineLength,n=t.indent||(Ie(s)?"  ":""),a="",o=0;for(let l=0,u=e[l];u;u=e[++l])if(u===" "&&e[l+1]==="\\"&&e[l+2]==="n"&&(a+=e.slice(o,l)+"\\ ",l+=1,o=l,u="\\"),u==="\\")switch(e[l+1]){case"u":{a+=e.slice(o,l);let c=e.substr(l+2,4);switch(c){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:c.substr(0,2)==="00"?a+="\\x"+c.substr(2):a+=e.substr(l,6)}l+=5,o=l+1}break;case"n":if(i||e[l+2]==='"'||e.length<r)l+=1;else{for(a+=e.slice(o,l)+`

`;e[l+2]==="\\"&&e[l+3]==="n"&&e[l+4]!=='"';)a+=`
`,l+=2;a+=n,e[l+2]===" "&&(a+="\\"),l+=1,o=l+1}break;default:l+=1}return a=o?a+e.slice(o):e,i?a:Jt(a,n,Kt,Me(t))}function di(s,t){if(t.options.singleQuote===!1||t.implicitKey&&s.includes(`
`)||/[ \t]\n|\n[ \t]/.test(s))return Qt(s,t);let e=t.indent||(Ie(s)?"  ":""),i="'"+s.replace(/'/g,"''").replace(/\n+/g,`$&
${e}`)+"'";return t.implicitKey?i:Jt(i,e,hi,Me(t))}function Zt(s,t){let{singleQuote:e}=t.options,i;if(e===!1)i=Qt;else{let r=s.includes('"'),n=s.includes("'");r&&!n?i=di:n&&!r?i=Qt:i=e?di:Qt}return i(s,t)}function Be({comment:s,type:t,value:e},i,r,n){let{blockQuote:a,commentString:o,lineWidth:l}=i.options;if(!a||/\n[\t ]+$/.test(e)||/^\s*$/.test(e))return Zt(e,i);let u=i.indent||(i.forceBlockIndent||Ie(e)?"  ":""),c=a==="literal"?!0:a==="folded"||t===b.BLOCK_FOLDED?!1:t===b.BLOCK_LITERAL?!0:!hr(e,l,u.length);if(!e)return c?`|
`:`>
`;let h,d;for(d=e.length;d>0;--d){let S=e[d-1];if(S!==`
`&&S!=="	"&&S!==" ")break}let m=e.substring(d),y=m.indexOf(`
`);y===-1?h="-":e===m||y!==m.length-1?(h="+",n&&n()):h="",m&&(e=e.slice(0,-m.length),m[m.length-1]===`
`&&(m=m.slice(0,-1)),m=m.replace(/\n+(?!\n|$)/g,`$&${u}`));let g=!1,p,f=-1;for(p=0;p<e.length;++p){let S=e[p];if(S===" ")g=!0;else if(S===`
`)f=p;else break}let w=e.substring(0,f<p?f+1:p);w&&(e=e.substring(w.length),w=w.replace(/\n+/g,`$&${u}`));let _=(c?"|":">")+(g?u?"2":"1":"")+h;if(s&&(_+=" "+o(s.replace(/ ?[\r\n]+/g," ")),r&&r()),c)return e=e.replace(/\n+/g,`$&${u}`),`${_}
${u}${w}${e}${m}`;e=e.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${u}`);let B=Jt(`${w}${e}${m}`,u,Pe,Me(i));return`${_}
${u}${B}`}function dr(s,t,e,i){let{type:r,value:n}=s,{actualString:a,implicitKey:o,indent:l,inFlow:u}=t;if(o&&/[\n[\]{},]/.test(n)||u&&/[[\]{},]/.test(n))return Zt(n,t);if(!n||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(n))return o||u||!n.includes(`
`)?Zt(n,t):Be(s,t,e,i);if(!o&&!u&&r!==b.PLAIN&&n.includes(`
`))return Be(s,t,e,i);if(l===""&&Ie(n))return t.forceBlockIndent=!0,Be(s,t,e,i);let c=n.replace(/\n+/g,`$&
${l}`);if(a){let h=y=>y.default&&y.tag!=="tag:yaml.org,2002:str"&&y.test?.test(c),{compat:d,tags:m}=t.doc.schema;if(m.some(h)||d?.some(h))return Zt(n,t)}return o?c:Jt(c,l,hi,Me(t))}function vt(s,t,e,i){let{implicitKey:r,inFlow:n}=t,a=typeof s.value=="string"?s:Object.assign({},s,{value:String(s.value)}),{type:o}=s;o!==b.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(a.value)&&(o=b.QUOTE_DOUBLE);let l=c=>{switch(c){case b.BLOCK_FOLDED:case b.BLOCK_LITERAL:return r||n?Zt(a.value,t):Be(a,t,e,i);case b.QUOTE_DOUBLE:return Qt(a.value,t);case b.QUOTE_SINGLE:return di(a.value,t);case b.PLAIN:return dr(a,t,e,i);default:return null}},u=l(o);if(u===null){let{defaultKeyType:c,defaultStringType:h}=t.options,d=r&&c||h;if(u=l(d),u===null)throw new Error(`Unsupported default string type ${d}`)}return u}function Te(s,t){let e=Object.assign({blockQuote:!0,commentString:as,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},s.schema.toStringOptions,t),i;switch(e.collectionStyle){case"block":i=!1;break;case"flow":i=!0;break;default:i=null}return{anchors:new Set,doc:s,indent:"",indentStep:typeof e.indent=="number"?" ".repeat(e.indent):"  ",inFlow:i,options:e}}function gr(s,t){if(t.tag){let r=s.filter(n=>n.tag===t.tag);if(r.length>0)return r.find(n=>n.format===t.format)??r[0]}let e,i;if(C(t)){i=t.value;let r=s.filter(n=>n.identify?.(i));e=r.find(n=>n.format===t.format)??r.find(n=>!n.format)}else i=t,e=s.find(r=>r.nodeClass&&i instanceof r.nodeClass);if(!e){let r=i?.constructor?.name??typeof i;throw new Error(`Tag not resolved for ${r} value`)}return e}function mr(s,t,{anchors:e,doc:i}){if(!i.directives)return"";let r=[],n=(C(s)||M(s))&&s.anchor;n&&xe(n)&&(e.add(n),r.push(`&${n}`));let a=s.tag?s.tag:t.default?null:t.tag;return a&&r.push(i.directives.tagString(a)),r.join(" ")}function H(s,t,e,i){if(v(s))return s.toString(t,e,i);if(z(s)){if(t.doc.directives)return s.toString(t);if(t.resolvedAliases?.has(s))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(s):t.resolvedAliases=new Set([s]),s=s.resolve(t.doc)}let r,n=P(s)?s:t.doc.createNode(s,{onTagObj:l=>r=l});r||(r=gr(t.doc.schema.tags,n));let a=mr(n,r,t);a.length>0&&(t.indentAtStart=(t.indentAtStart??0)+a.length+1);let o=typeof r.stringify=="function"?r.stringify(n,t,e,i):C(n)?vt(n,t,e,i):n.toString(t,e,i);return a?C(n)||o[0]==="{"||o[0]==="["?`${a} ${o}`:`${a}
${t.indent}${o}`:o}function ls({key:s,value:t},e,i,r){let{allNullValues:n,doc:a,indent:o,indentStep:l,options:{commentString:u,indentSeq:c,simpleKeys:h}}=e,d=P(s)&&s.comment||null;if(h){if(d)throw new Error("With simple keys, key nodes cannot have comments");if(M(s)){let S="With simple keys, collection cannot be used as a key value";throw new Error(S)}}let m=!h&&(!s||d&&t==null&&!e.inFlow||M(s)||(C(s)?s.type===b.BLOCK_FOLDED||s.type===b.BLOCK_LITERAL:typeof s=="object"));e=Object.assign({},e,{allNullValues:!1,implicitKey:!m&&(h||!n),indent:o+l});let y=!1,g=!1,p=H(s,e,()=>y=!0,()=>g=!0);if(!m&&!e.inFlow&&p.length>1024){if(h)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");m=!0}if(e.inFlow){if(n||t==null)return y&&i&&i(),p===""?"?":m?`? ${p}`:p}else if(n&&!h||t==null&&m)return p=`? ${p}`,d&&!y?p+=Y(p,e.indent,u(d)):g&&r&&r(),p;y&&(d=null),m?(d&&(p+=Y(p,e.indent,u(d))),p=`? ${p}
${o}:`):(p=`${p}:`,d&&(p+=Y(p,e.indent,u(d))));let f="",w=null;if(P(t)){if(t.spaceBefore&&(f=`
`),t.commentBefore){let S=u(t.commentBefore);f+=`
${$(S,e.indent)}`}w=t.comment}else t&&typeof t=="object"&&(t=a.createNode(t));e.implicitKey=!1,!m&&!d&&C(t)&&(e.indentAtStart=p.length+1),g=!1,!c&&l.length>=2&&!e.inFlow&&!m&&W(t)&&!t.flow&&!t.tag&&!t.anchor&&(e.indent=e.indent.substr(2));let x=!1,_=H(t,e,()=>x=!0,()=>g=!0),B=" ";return f||d?_===""&&!e.inFlow?B=f===`
`?`

`:f:B=`${f}
${e.indent}`:!m&&M(t)?(!(_[0]==="["||_[0]==="{")||_.includes(`
`))&&(B=`
${e.indent}`):(_===""||_[0]===`
`)&&(B=""),p+=B+_,e.inFlow?x&&i&&i():w&&!x?p+=Y(p,e.indent,u(w)):g&&r&&r(),p}function Ae(s,t){(s==="debug"||s==="warn")&&(typeof process<"u"&&process.emitWarning?process.emitWarning(t):console.warn(t))}var us="<<";function Le(s,t,{key:e,value:i}){if(s?.doc.schema.merge&&pr(e))if(i=z(i)?i.resolve(s.doc):i,W(i))for(let r of i.items)gi(s,t,r);else if(Array.isArray(i))for(let r of i)gi(s,t,r);else gi(s,t,i);else{let r=V(e,"",s);if(t instanceof Map)t.set(r,V(i,r,s));else if(t instanceof Set)t.add(r);else{let n=fr(e,r,s),a=V(i,n,s);n in t?Object.defineProperty(t,n,{value:a,writable:!0,enumerable:!0,configurable:!0}):t[n]=a}}return t}var pr=s=>s===us||C(s)&&s.value===us&&(!s.type||s.type===b.PLAIN);function gi(s,t,e){let i=s&&z(e)?e.resolve(s.doc):e;if(!N(i))throw new Error("Merge sources must be maps or map aliases");let r=i.toJSON(null,s,Map);for(let[n,a]of r)t instanceof Map?t.has(n)||t.set(n,a):t instanceof Set?t.add(n):Object.prototype.hasOwnProperty.call(t,n)||Object.defineProperty(t,n,{value:a,writable:!0,enumerable:!0,configurable:!0});return t}function fr(s,t,e){if(t===null)return"";if(typeof t!="object")return String(t);if(P(s)&&e&&e.doc){let i=Te(e.doc,{});i.anchors=new Set;for(let n of e.anchors.keys())i.anchors.add(n.anchor);i.inFlow=!0,i.inStringifyKey=!0;let r=s.toString(i);if(!e.mapKeyWarned){let n=JSON.stringify(r);n.length>40&&(n=n.substring(0,36)+'..."'),Ae(e.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${n}. Set mapAsMap: true to use object keys.`),e.mapKeyWarned=!0}return r}return JSON.stringify(t)}function Ft(s,t,e){let i=ut(s,void 0,e),r=ut(t,void 0,e);return new I(i,r)}var I=class{constructor(t,e=null){Object.defineProperty(this,R,{value:li}),this.key=t,this.value=e}clone(t){let{key:e,value:i}=this;return P(e)&&(e=e.clone(t)),P(i)&&(i=i.clone(t)),new I(e,i)}toJSON(t,e){let i=e?.mapAsMap?new Map:{};return Le(e,i,this)}toString(t,e,i){return t?.doc?ls(this,t,e,i):JSON.stringify(this)}};function ke(s,t,e){return(t.inFlow??s.flow?_r:yr)(s,t,e)}function yr({comment:s,items:t},e,{blockItemPrefix:i,flowChars:r,itemIndent:n,onChompKeep:a,onComment:o}){let{indent:l,options:{commentString:u}}=e,c=Object.assign({},e,{indent:n,type:null}),h=!1,d=[];for(let y=0;y<t.length;++y){let g=t[y],p=null;if(P(g))!h&&g.spaceBefore&&d.push(""),Ee(e,d,g.commentBefore,h),g.comment&&(p=g.comment);else if(v(g)){let w=P(g.key)?g.key:null;w&&(!h&&w.spaceBefore&&d.push(""),Ee(e,d,w.commentBefore,h))}h=!1;let f=H(g,c,()=>p=null,()=>h=!0);p&&(f+=Y(f,n,u(p))),h&&p&&(h=!1),d.push(i+f)}let m;if(d.length===0)m=r.start+r.end;else{m=d[0];for(let y=1;y<d.length;++y){let g=d[y];m+=g?`
${l}${g}`:`
`}}return s?(m+=`
`+$(u(s),l),o&&o()):h&&a&&a(),m}function _r({comment:s,items:t},e,{flowChars:i,itemIndent:r,onComment:n}){let{indent:a,indentStep:o,options:{commentString:l}}=e;r+=o;let u=Object.assign({},e,{indent:r,inFlow:!0,type:null}),c=!1,h=0,d=[];for(let p=0;p<t.length;++p){let f=t[p],w=null;if(P(f))f.spaceBefore&&d.push(""),Ee(e,d,f.commentBefore,!1),f.comment&&(w=f.comment);else if(v(f)){let _=P(f.key)?f.key:null;_&&(_.spaceBefore&&d.push(""),Ee(e,d,_.commentBefore,!1),_.comment&&(c=!0));let B=P(f.value)?f.value:null;B?(B.comment&&(w=B.comment),B.commentBefore&&(c=!0)):f.value==null&&_&&_.comment&&(w=_.comment)}w&&(c=!0);let x=H(f,u,()=>w=null);p<t.length-1&&(x+=","),w&&(x+=Y(x,r,l(w))),!c&&(d.length>h||x.includes(`
`))&&(c=!0),d.push(x),h=d.length}let m,{start:y,end:g}=i;if(d.length===0)m=y+g;else if(c||(c=d.reduce((f,w)=>f+w.length+2,2)>ct.maxFlowStringSingleLineLength),c){m=y;for(let p of d)m+=p?`
${o}${a}${p}`:`
`;m+=`
${a}${g}`}else m=`${y} ${d.join(" ")} ${g}`;return s&&(m+=Y(m,l(s),a),n&&n()),m}function Ee({indent:s,options:{commentString:t}},e,i,r){if(i&&r&&(i=i.replace(/^\n+/,"")),i){let n=$(t(i),s);e.push(n.trimStart())}}function gt(s,t){let e=C(t)?t.value:t;for(let i of s)if(v(i)&&(i.key===t||i.key===e||C(i.key)&&i.key.value===e))return i}var A=class extends ct{constructor(t){super(j,t),this.items=[]}static get tagName(){return"tag:yaml.org,2002:map"}add(t,e){let i;v(t)?i=t:!t||typeof t!="object"||!("key"in t)?i=new I(t,t?.value):i=new I(t.key,t.value);let r=gt(this.items,i.key),n=this.schema?.sortMapEntries;if(r){if(!e)throw new Error(`Key ${i.key} already set`);C(r.value)&&ve(i.value)?r.value.value=i.value:r.value=i.value}else if(n){let a=this.items.findIndex(o=>n(i,o)<0);a===-1?this.items.push(i):this.items.splice(a,0,i)}else this.items.push(i)}delete(t){let e=gt(this.items,t);return e?this.items.splice(this.items.indexOf(e),1).length>0:!1}get(t,e){let r=gt(this.items,t)?.value;return(!e&&C(r)?r.value:r)??void 0}has(t){return!!gt(this.items,t)}set(t,e){this.add(new I(t,e),!0)}toJSON(t,e,i){let r=i?new i:e?.mapAsMap?new Map:{};e?.onCreate&&e.onCreate(r);for(let n of this.items)Le(e,r,n);return r}toString(t,e,i){if(!t)return JSON.stringify(this);for(let r of this.items)if(!v(r))throw new Error(`Map items must all be pairs; found ${JSON.stringify(r)} instead`);return!t.allNullValues&&this.hasAllNullValues(!1)&&(t=Object.assign({},t,{allNullValues:!0})),ke(this,t,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:t.indent||"",onChompKeep:i,onComment:e})}};function Sr(s,t,e){let{keepUndefined:i,replacer:r}=e,n=new A(s),a=(o,l)=>{if(typeof r=="function")l=r.call(t,o,l);else if(Array.isArray(r)&&!r.includes(o))return;(l!==void 0||i)&&n.items.push(Ft(o,l,e))};if(t instanceof Map)for(let[o,l]of t)a(o,l);else if(t&&typeof t=="object")for(let o of Object.keys(t))a(o,t[o]);return typeof s.sortMapEntries=="function"&&n.items.sort(s.sortMapEntries),n}var X={collection:"map",createNode:Sr,default:!0,nodeClass:A,tag:"tag:yaml.org,2002:map",resolve(s,t){return N(s)||t("Expected a mapping for this tag"),s}};var O=class extends ct{constructor(t){super(ot,t),this.items=[]}static get tagName(){return"tag:yaml.org,2002:seq"}add(t){this.items.push(t)}delete(t){let e=Ve(t);return typeof e!="number"?!1:this.items.splice(e,1).length>0}get(t,e){let i=Ve(t);if(typeof i!="number")return;let r=this.items[i];return!e&&C(r)?r.value:r}has(t){let e=Ve(t);return typeof e=="number"&&e<this.items.length}set(t,e){let i=Ve(t);if(typeof i!="number")throw new Error(`Expected a valid index, not ${t}.`);let r=this.items[i];C(r)&&ve(e)?r.value=e:this.items[i]=e}toJSON(t,e){let i=[];e?.onCreate&&e.onCreate(i);let r=0;for(let n of this.items)i.push(V(n,String(r++),e));return i}toString(t,e,i){return t?ke(this,t,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(t.indent||"")+"  ",onChompKeep:i,onComment:e}):JSON.stringify(this)}};function Ve(s){let t=C(s)?s.value:s;return t&&typeof t=="string"&&(t=Number(t)),typeof t=="number"&&Number.isInteger(t)&&t>=0?t:null}function br(s,t,e){let{replacer:i}=e,r=new O(s);if(t&&Symbol.iterator in Object(t)){let n=0;for(let a of t){if(typeof i=="function"){let o=t instanceof Set?a:String(n++);a=i.call(t,o,a)}r.items.push(ut(a,void 0,e))}}return r}var G={collection:"seq",createNode:br,default:!0,nodeClass:O,tag:"tag:yaml.org,2002:seq",resolve(s,t){return W(s)||t("Expected a sequence for this tag"),s}};var mt={identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify(s,t,e,i){return t=Object.assign({actualString:!0},t),vt(s,t,e,i)}};var Pt={identify:s=>s==null,createNode:()=>new b(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new b(null),stringify:({source:s},t)=>typeof s=="string"&&Pt.test.test(s)?s:t.options.nullStr};var te={identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:s=>new b(s[0]==="t"||s[0]==="T"),stringify({source:s,value:t},e){if(s&&te.test.test(s)){let i=s[0]==="t"||s[0]==="T";if(t===i)return s}return t?e.options.trueStr:e.options.falseStr}};function k({format:s,minFractionDigits:t,tag:e,value:i}){if(typeof i=="bigint")return String(i);let r=typeof i=="number"?i:Number(i);if(!isFinite(r))return isNaN(r)?".nan":r<0?"-.inf":".inf";let n=JSON.stringify(i);if(!s&&t&&(!e||e==="tag:yaml.org,2002:float")&&/^\d/.test(n)){let a=n.indexOf(".");a<0&&(a=n.length,n+=".");let o=t-(n.length-a-1);for(;o-- >0;)n+="0"}return n}var Re={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN))$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:k},De={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s),stringify(s){let t=Number(s.value);return isFinite(t)?t.toExponential():k(s)}},Oe={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(s){let t=new b(parseFloat(s)),e=s.indexOf(".");return e!==-1&&s[s.length-1]==="0"&&(t.minFractionDigits=s.length-e-1),t},stringify:k};var Ne=s=>typeof s=="bigint"||Number.isInteger(s),mi=(s,t,e,{intAsBigInt:i})=>i?BigInt(s):parseInt(s.substring(t),e);function cs(s,t,e){let{value:i}=s;return Ne(i)&&i>=0?e+i.toString(t):k(s)}var Fe={identify:s=>Ne(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(s,t,e)=>mi(s,2,8,e),stringify:s=>cs(s,8,"0o")},$e={identify:Ne,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(s,t,e)=>mi(s,0,10,e),stringify:k},Ue={identify:s=>Ne(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(s,t,e)=>mi(s,2,16,e),stringify:s=>cs(s,16,"0x")};var hs=[X,G,mt,Pt,te,Fe,$e,Ue,Re,De,Oe];function ds(s){return typeof s=="bigint"||Number.isInteger(s)}var je=({value:s})=>JSON.stringify(s),wr=[{identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify:je},{identify:s=>s==null,createNode:()=>new b(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:je},{identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true|false$/,resolve:s=>s==="true",stringify:je},{identify:ds,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(s,t,{intAsBigInt:e})=>e?BigInt(s):parseInt(s,10),stringify:({value:s})=>ds(s)?s.toString():JSON.stringify(s)},{identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:s=>parseFloat(s),stringify:je}],xr={default:!0,tag:"",test:/^/,resolve(s,t){return t(`Unresolved plain scalar ${JSON.stringify(s)}`),s}},gs=[X,G].concat(wr,xr);var ee={identify:s=>s instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(s,t){if(typeof Buffer=="function")return Buffer.from(s,"base64");if(typeof atob=="function"){let e=atob(s.replace(/[\n\r]/g,"")),i=new Uint8Array(e.length);for(let r=0;r<e.length;++r)i[r]=e.charCodeAt(r);return i}else return t("This environment does not support reading binary tags; either Buffer or atob is required"),s},stringify({comment:s,type:t,value:e},i,r,n){let a=e,o;if(typeof Buffer=="function")o=a instanceof Buffer?a.toString("base64"):Buffer.from(a.buffer).toString("base64");else if(typeof btoa=="function"){let l="";for(let u=0;u<a.length;++u)l+=String.fromCharCode(a[u]);o=btoa(l)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(t||(t=b.BLOCK_LITERAL),t!==b.QUOTE_DOUBLE){let l=Math.max(i.options.lineWidth-i.indent.length,i.options.minContentWidth),u=Math.ceil(o.length/l),c=new Array(u);for(let h=0,d=0;h<u;++h,d+=l)c[h]=o.substr(d,l);o=c.join(t===b.BLOCK_LITERAL?`
`:" ")}return vt({comment:s,type:t,value:o},i,r,n)}};function pi(s,t){if(W(s))for(let e=0;e<s.items.length;++e){let i=s.items[e];if(!v(i)){if(N(i)){i.items.length>1&&t("Each pair must have its own sequence indicator");let r=i.items[0]||new I(new b(null));if(i.commentBefore&&(r.key.commentBefore=r.key.commentBefore?`${i.commentBefore}
${r.key.commentBefore}`:i.commentBefore),i.comment){let n=r.value??r.key;n.comment=n.comment?`${i.comment}
${n.comment}`:i.comment}i=r}s.items[e]=v(i)?i:new I(i)}}else t("Expected a sequence for this tag");return s}function fi(s,t,e){let{replacer:i}=e,r=new O(s);r.tag="tag:yaml.org,2002:pairs";let n=0;if(t&&Symbol.iterator in Object(t))for(let a of t){typeof i=="function"&&(a=i.call(t,String(n++),a));let o,l;if(Array.isArray(a))if(a.length===2)o=a[0],l=a[1];else throw new TypeError(`Expected [key, value] tuple: ${a}`);else if(a&&a instanceof Object){let u=Object.keys(a);if(u.length===1)o=u[0],l=a[o];else throw new TypeError(`Expected { key: value } tuple: ${a}`)}else o=a;r.items.push(Ft(o,l,e))}return r}var ie={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:pi,createNode:fi};var pt=class extends O{constructor(){super(),this.add=A.prototype.add.bind(this),this.delete=A.prototype.delete.bind(this),this.get=A.prototype.get.bind(this),this.has=A.prototype.has.bind(this),this.set=A.prototype.set.bind(this),this.tag=pt.tag}toJSON(t,e){if(!e)return super.toJSON(t);let i=new Map;e?.onCreate&&e.onCreate(i);for(let r of this.items){let n,a;if(v(r)?(n=V(r.key,"",e),a=V(r.value,n,e)):n=V(r,"",e),i.has(n))throw new Error("Ordered maps must not include duplicate keys");i.set(n,a)}return i}};pt.tag="tag:yaml.org,2002:omap";var se={collection:"seq",identify:s=>s instanceof Map,nodeClass:pt,default:!1,tag:"tag:yaml.org,2002:omap",resolve(s,t){let e=pi(s,t),i=[];for(let{key:r}of e.items)C(r)&&(i.includes(r.value)?t(`Ordered maps must not include duplicate keys: ${r.value}`):i.push(r.value));return Object.assign(new pt,e)},createNode(s,t,e){let i=fi(s,t,e),r=new pt;return r.items=i.items,r}};function ms({value:s,source:t},e){return t&&(s?yi:_i).test.test(t)?t:s?e.options.trueStr:e.options.falseStr}var yi={identify:s=>s===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new b(!0),stringify:ms},_i={identify:s=>s===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/i,resolve:()=>new b(!1),stringify:ms};var ps={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN)$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:k},fs={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s.replace(/_/g,"")),stringify(s){let t=Number(s.value);return isFinite(t)?t.toExponential():k(s)}},ys={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(s){let t=new b(parseFloat(s.replace(/_/g,""))),e=s.indexOf(".");if(e!==-1){let i=s.substring(e+1).replace(/_/g,"");i[i.length-1]==="0"&&(t.minFractionDigits=i.length)}return t},stringify:k};var re=s=>typeof s=="bigint"||Number.isInteger(s);function ze(s,t,e,{intAsBigInt:i}){let r=s[0];if((r==="-"||r==="+")&&(t+=1),s=s.substring(t).replace(/_/g,""),i){switch(e){case 2:s=`0b${s}`;break;case 8:s=`0o${s}`;break;case 16:s=`0x${s}`;break}let a=BigInt(s);return r==="-"?BigInt(-1)*a:a}let n=parseInt(s,e);return r==="-"?-1*n:n}function Si(s,t,e){let{value:i}=s;if(re(i)){let r=i.toString(t);return i<0?"-"+e+r.substr(1):e+r}return k(s)}var _s={identify:re,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(s,t,e)=>ze(s,2,2,e),stringify:s=>Si(s,2,"0b")},Ss={identify:re,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(s,t,e)=>ze(s,1,8,e),stringify:s=>Si(s,8,"0")},bs={identify:re,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(s,t,e)=>ze(s,0,10,e),stringify:k},ws={identify:re,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(s,t,e)=>ze(s,2,16,e),stringify:s=>Si(s,16,"0x")};var ft=class extends A{constructor(t){super(t),this.tag=ft.tag}add(t){let e;v(t)?e=t:t&&typeof t=="object"&&"key"in t&&"value"in t&&t.value===null?e=new I(t.key,null):e=new I(t,null),gt(this.items,e.key)||this.items.push(e)}get(t,e){let i=gt(this.items,t);return!e&&v(i)?C(i.key)?i.key.value:i.key:i}set(t,e){if(typeof e!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof e}`);let i=gt(this.items,t);i&&!e?this.items.splice(this.items.indexOf(i),1):!i&&e&&this.items.push(new I(t))}toJSON(t,e){return super.toJSON(t,e,Set)}toString(t,e,i){if(!t)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},t,{allNullValues:!0}),e,i);throw new Error("Set items must all have null values")}};ft.tag="tag:yaml.org,2002:set";var ne={collection:"map",identify:s=>s instanceof Set,nodeClass:ft,default:!1,tag:"tag:yaml.org,2002:set",resolve(s,t){if(N(s)){if(s.hasAllNullValues(!0))return Object.assign(new ft,s);t("Set items must all have null values")}else t("Expected a mapping for this tag");return s},createNode(s,t,e){let{replacer:i}=e,r=new ft(s);if(t&&Symbol.iterator in Object(t))for(let n of t)typeof i=="function"&&(n=i.call(t,n,n)),r.items.push(Ft(n,null,e));return r}};function bi(s,t){let e=s[0],i=e==="-"||e==="+"?s.substring(1):s,r=a=>t?BigInt(a):Number(a),n=i.replace(/_/g,"").split(":").reduce((a,o)=>a*r(60)+r(o),r(0));return e==="-"?r(-1)*n:n}function xs(s){let{value:t}=s,e=a=>a;if(typeof t=="bigint")e=a=>BigInt(a);else if(isNaN(t)||!isFinite(t))return k(s);let i="";t<0&&(i="-",t*=e(-1));let r=e(60),n=[t%r];return t<60?n.unshift(0):(t=(t-n[0])/r,n.unshift(t%r),t>=60&&(t=(t-n[0])/r,n.unshift(t))),i+n.map(a=>a<10?"0"+String(a):String(a)).join(":").replace(/000000\d*$/,"")}var We={identify:s=>typeof s=="bigint"||Number.isInteger(s),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(s,t,{intAsBigInt:e})=>bi(s,e),stringify:xs},qe={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:s=>bi(s,!1),stringify:xs},$t={identify:s=>s instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(s){let t=s.match($t.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");let[,e,i,r,n,a,o]=t.map(Number),l=t[7]?Number((t[7]+"00").substr(1,3)):0,u=Date.UTC(e,i-1,r,n||0,a||0,o||0,l),c=t[8];if(c&&c!=="Z"){let h=bi(c,!1);Math.abs(h)<30&&(h*=60),u-=6e4*h}return new Date(u)},stringify:({value:s})=>s.toISOString().replace(/((T00:00)?:00)?\.000Z$/,"")};var wi=[X,G,mt,Pt,yi,_i,_s,Ss,bs,ws,ps,fs,ys,ee,se,ie,ne,We,qe,$t];var Cs=new Map([["core",hs],["failsafe",[X,G,mt]],["json",gs],["yaml11",wi],["yaml-1.1",wi]]),vs={binary:ee,bool:te,float:Oe,floatExp:De,floatNaN:Re,floatTime:qe,int:$e,intHex:Ue,intOct:Fe,intTime:We,map:X,null:Pt,omap:se,pairs:ie,seq:G,set:ne,timestamp:$t},Ps={"tag:yaml.org,2002:binary":ee,"tag:yaml.org,2002:omap":se,"tag:yaml.org,2002:pairs":ie,"tag:yaml.org,2002:set":ne,"tag:yaml.org,2002:timestamp":$t};function Ye(s,t){let e=Cs.get(t);if(!e)if(Array.isArray(s))e=[];else{let i=Array.from(Cs.keys()).filter(r=>r!=="yaml11").map(r=>JSON.stringify(r)).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${i} or define customTags array`)}if(Array.isArray(s))for(let i of s)e=e.concat(i);else typeof s=="function"&&(e=s(e.slice()));return e.map(i=>{if(typeof i!="string")return i;let r=vs[i];if(r)return r;let n=Object.keys(vs).map(a=>JSON.stringify(a)).join(", ");throw new Error(`Unknown custom tag "${i}"; use one of ${n}`)})}var Cr=(s,t)=>s.key<t.key?-1:s.key>t.key?1:0,Bt=class{constructor({compat:t,customTags:e,merge:i,resolveKnownTags:r,schema:n,sortMapEntries:a,toStringDefaults:o}){this.compat=Array.isArray(t)?Ye(t,"compat"):t?Ye(null,t):null,this.merge=!!i,this.name=typeof n=="string"&&n||"core",this.knownTags=r?Ps:{},this.tags=Ye(e,this.name),this.toStringOptions=o??null,Object.defineProperty(this,j,{value:X}),Object.defineProperty(this,F,{value:mt}),Object.defineProperty(this,ot,{value:G}),this.sortMapEntries=typeof a=="function"?a:a===!0?Cr:null}clone(){let t=Object.create(Bt.prototype,Object.getOwnPropertyDescriptors(this));return t.tags=this.tags.slice(),t}};function Bs(s,t){let e=[],i=t.directives===!0;if(t.directives!==!1&&s.directives){let l=s.directives.toString(s);l?(e.push(l),i=!0):s.directives.docStart&&(i=!0)}i&&e.push("---");let r=Te(s,t),{commentString:n}=r.options;if(s.commentBefore){e.length!==1&&e.unshift("");let l=n(s.commentBefore);e.unshift($(l,""))}let a=!1,o=null;if(s.contents){if(P(s.contents)){if(s.contents.spaceBefore&&i&&e.push(""),s.contents.commentBefore){let c=n(s.contents.commentBefore);e.push($(c,""))}r.forceBlockIndent=!!s.comment,o=s.contents.comment}let l=o?void 0:()=>a=!0,u=H(s.contents,r,()=>o=null,l);o&&(u+=Y(u,"",n(o))),(u[0]==="|"||u[0]===">")&&e[e.length-1]==="---"?e[e.length-1]=`--- ${u}`:e.push(u)}else e.push(H(s.contents,r));if(s.directives?.docEnd)if(s.comment){let l=n(s.comment);l.includes(`
`)?(e.push("..."),e.push($(l,""))):e.push(`... ${l}`)}else e.push("...");else{let l=s.comment;l&&a&&(l=l.replace(/^\n+/,"")),l&&((!a||o)&&e[e.length-1]!==""&&e.push(""),e.push($(n(l),"")))}return e.join(`
`)+`
`}function Ut(s,t,e,i){if(i&&typeof i=="object")if(Array.isArray(i))for(let r=0,n=i.length;r<n;++r){let a=i[r],o=Ut(s,i,String(r),a);o===void 0?delete i[r]:o!==a&&(i[r]=o)}else if(i instanceof Map)for(let r of Array.from(i.keys())){let n=i.get(r),a=Ut(s,i,r,n);a===void 0?i.delete(r):a!==n&&i.set(r,a)}else if(i instanceof Set)for(let r of Array.from(i)){let n=Ut(s,i,r,r);n===void 0?i.delete(r):n!==r&&(i.delete(r),i.add(n))}else for(let[r,n]of Object.entries(i)){let a=Ut(s,i,r,n);a===void 0?delete i[r]:a!==n&&(i[r]=a)}return s.call(t,e,i)}var et=class{constructor(t,e,i){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,R,{value:be});let r=null;typeof e=="function"||Array.isArray(e)?r=e:i===void 0&&e&&(i=e,e=void 0);let n=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,uniqueKeys:!0,version:"1.2"},i);this.options=n;let{version:a}=n;i?._directives?(this.directives=i._directives.atDocument(),this.directives.yaml.explicit&&(a=this.directives.yaml.version)):this.directives=new T({version:a}),this.setSchema(a,i),t===void 0?this.contents=null:this.contents=this.createNode(t,r,i)}clone(){let t=Object.create(et.prototype,{[R]:{value:be}});return t.commentBefore=this.commentBefore,t.comment=this.comment,t.errors=this.errors.slice(),t.warnings=this.warnings.slice(),t.options=Object.assign({},this.options),this.directives&&(t.directives=this.directives.clone()),t.schema=this.schema.clone(),t.contents=P(this.contents)?this.contents.clone(t.schema):this.contents,this.range&&(t.range=this.range.slice()),t}add(t){jt(this.contents)&&this.contents.add(t)}addIn(t,e){jt(this.contents)&&this.contents.addIn(t,e)}createAlias(t,e){if(!t.anchor){let i=ui(this);t.anchor=!e||i.has(e)?ci(e||"a",i):e}return new lt(t.anchor)}createNode(t,e,i){let r;if(typeof e=="function")t=e.call({"":t},"",t),r=e;else if(Array.isArray(e)){let p=w=>typeof w=="number"||w instanceof String||w instanceof Number,f=e.filter(p).map(String);f.length>0&&(e=e.concat(f)),r=e}else i===void 0&&e&&(i=e,e=void 0);let{aliasDuplicateObjects:n,anchorPrefix:a,flow:o,keepUndefined:l,onTagObj:u,tag:c}=i??{},{onAnchor:h,setAnchors:d,sourceObjects:m}=ns(this,a||"a"),y={aliasDuplicateObjects:n??!0,keepUndefined:l??!1,onAnchor:h,onTagObj:u,replacer:r,schema:this.schema,sourceObjects:m},g=ut(t,c,y);return o&&M(g)&&(g.flow=!0),d(),g}createPair(t,e,i={}){let r=this.createNode(t,null,i),n=this.createNode(e,null,i);return new I(r,n)}delete(t){return jt(this.contents)?this.contents.delete(t):!1}deleteIn(t){return Nt(t)?this.contents==null?!1:(this.contents=null,!0):jt(this.contents)?this.contents.deleteIn(t):!1}get(t,e){return M(this.contents)?this.contents.get(t,e):void 0}getIn(t,e){return Nt(t)?!e&&C(this.contents)?this.contents.value:this.contents:M(this.contents)?this.contents.getIn(t,e):void 0}has(t){return M(this.contents)?this.contents.has(t):!1}hasIn(t){return Nt(t)?this.contents!==void 0:M(this.contents)?this.contents.hasIn(t):!1}set(t,e){this.contents==null?this.contents=Gt(this.schema,[t],e):jt(this.contents)&&this.contents.set(t,e)}setIn(t,e){Nt(t)?this.contents=e:this.contents==null?this.contents=Gt(this.schema,Array.from(t),e):jt(this.contents)&&this.contents.setIn(t,e)}setSchema(t,e={}){typeof t=="number"&&(t=String(t));let i;switch(t){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new T({version:"1.1"}),i={merge:!0,resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=t:this.directives=new T({version:t}),i={merge:!1,resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,i=null;break;default:{let r=JSON.stringify(t);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${r}`)}}if(e.schema instanceof Object)this.schema=e.schema;else if(i)this.schema=new Bt(Object.assign(i,e));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:t,jsonArg:e,mapAsMap:i,maxAliasCount:r,onAnchor:n,reviver:a}={}){let o={anchors:new Map,doc:this,keep:!t,mapAsMap:i===!0,mapKeyWarned:!1,maxAliasCount:typeof r=="number"?r:100,stringify:H},l=V(this.contents,e??"",o);if(typeof n=="function")for(let{count:u,res:c}of o.anchors.values())n(c,u);return typeof a=="function"?Ut(a,{"":l},"",l):l}toJSON(t,e){return this.toJS({json:!0,jsonArg:t,mapAsMap:!1,onAnchor:e})}toString(t={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in t&&(!Number.isInteger(t.indent)||Number(t.indent)<=0)){let e=JSON.stringify(t.indent);throw new Error(`"indent" option must be a positive integer, not ${e}`)}return Bs(this,t)}};function jt(s){if(M(s))return!0;throw new Error("Expected a YAML collection as document contents")}var ae=class extends Error{constructor(t,e,i,r){super(),this.name=t,this.code=i,this.message=r,this.pos=e}},K=class extends ae{constructor(t,e,i){super("YAMLParseError",t,e,i)}},oe=class extends ae{constructor(t,e,i){super("YAMLWarning",t,e,i)}},xi=(s,t)=>e=>{if(e.pos[0]===-1)return;e.linePos=e.pos.map(o=>t.linePos(o));let{line:i,col:r}=e.linePos[0];e.message+=` at line ${i}, column ${r}`;let n=r-1,a=s.substring(t.lineStarts[i-1],t.lineStarts[i]).replace(/[\n\r]+$/,"");if(n>=60&&a.length>80){let o=Math.min(n-39,a.length-79);a=""+a.substring(o),n-=o-1}if(a.length>80&&(a=a.substring(0,79)+""),i>1&&/^ *$/.test(a.substring(0,n))){let o=s.substring(t.lineStarts[i-2],t.lineStarts[i-1]);o.length>80&&(o=o.substring(0,79)+`
`),a=o+a}if(/[^ ]/.test(a)){let o=1,l=e.linePos[1];l&&l.line===i&&l.col>r&&(o=Math.min(l.col-r,80-n));let u=" ".repeat(n)+"^".repeat(o);e.message+=`:

${a}
${u}
`}};function it(s,{flow:t,indicator:e,next:i,offset:r,onError:n,startOnNewline:a}){let o=!1,l=a,u=a,c="",h="",d=!1,m=!1,y=!1,g=null,p=null,f=null,w=null,x=null;for(let S of s)switch(y&&(S.type!=="space"&&S.type!=="newline"&&S.type!=="comma"&&n(S.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),y=!1),S.type){case"space":!t&&l&&e!=="doc-start"&&S.source[0]==="	"&&n(S,"TAB_AS_INDENT","Tabs are not allowed as indentation"),u=!0;break;case"comment":{u||n(S,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let E=S.source.substring(1)||" ";c?c+=h+E:c=E,h="",l=!1;break}case"newline":l?c?c+=S.source:o=!0:h+=S.source,l=!0,d=!0,(g||p)&&(m=!0),u=!0;break;case"anchor":g&&n(S,"MULTIPLE_ANCHORS","A node can have at most one anchor"),S.source.endsWith(":")&&n(S.offset+S.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),g=S,x===null&&(x=S.offset),l=!1,u=!1,y=!0;break;case"tag":{p&&n(S,"MULTIPLE_TAGS","A node can have at most one tag"),p=S,x===null&&(x=S.offset),l=!1,u=!1,y=!0;break}case e:(g||p)&&n(S,"BAD_PROP_ORDER",`Anchors and tags must be after the ${S.source} indicator`),w&&n(S,"UNEXPECTED_TOKEN",`Unexpected ${S.source} in ${t??"collection"}`),w=S,l=!1,u=!1;break;case"comma":if(t){f&&n(S,"UNEXPECTED_TOKEN",`Unexpected , in ${t}`),f=S,l=!1,u=!1;break}default:n(S,"UNEXPECTED_TOKEN",`Unexpected ${S.type} token`),l=!1,u=!1}let _=s[s.length-1],B=_?_.offset+_.source.length:r;return y&&i&&i.type!=="space"&&i.type!=="newline"&&i.type!=="comma"&&(i.type!=="scalar"||i.source!=="")&&n(i.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),{comma:f,found:w,spaceBefore:o,comment:c,hasNewline:d,hasNewlineAfterProp:m,anchor:g,tag:p,end:B,start:x??B}}function yt(s){if(!s)return null;switch(s.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(s.source.includes(`
`))return!0;if(s.end){for(let t of s.end)if(t.type==="newline")return!0}return!1;case"flow-collection":for(let t of s.items){for(let e of t.start)if(e.type==="newline")return!0;if(t.sep){for(let e of t.sep)if(e.type==="newline")return!0}if(yt(t.key)||yt(t.value))return!0}return!1;default:return!0}}function le(s,t,e){if(t?.type==="flow-collection"){let i=t.end[0];i.indent===s&&(i.source==="]"||i.source==="}")&&yt(t)&&e(i,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function He(s,t,e){let{uniqueKeys:i}=s.options;if(i===!1)return!1;let r=typeof i=="function"?i:(n,a)=>n===a||C(n)&&C(a)&&n.value===a.value&&!(n.value==="<<"&&s.schema.merge);return t.some(n=>r(n.key,e))}var Ms="All mapping items must start at the same column";function Is({composeNode:s,composeEmptyNode:t},e,i,r){let n=new A(e.schema);e.atRoot&&(e.atRoot=!1);let a=i.offset,o=null;for(let l of i.items){let{start:u,key:c,sep:h,value:d}=l,m=it(u,{indicator:"explicit-key-ind",next:c??h?.[0],offset:a,onError:r,startOnNewline:!0}),y=!m.found;if(y){if(c&&(c.type==="block-seq"?r(a,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in c&&c.indent!==i.indent&&r(a,"BAD_INDENT",Ms)),!m.anchor&&!m.tag&&!h){o=m.end,m.comment&&(n.comment?n.comment+=`
`+m.comment:n.comment=m.comment);continue}(m.hasNewlineAfterProp||yt(c))&&r(c??u[u.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else m.found?.indent!==i.indent&&r(a,"BAD_INDENT",Ms);let g=m.end,p=c?s(e,c,m,r):t(e,g,u,null,m,r);e.schema.compat&&le(i.indent,c,r),He(e,n.items,p)&&r(g,"DUPLICATE_KEY","Map keys must be unique");let f=it(h??[],{indicator:"map-value-ind",next:d,offset:p.range[2],onError:r,startOnNewline:!c||c.type==="block-scalar"});if(a=f.end,f.found){y&&(d?.type==="block-map"&&!f.hasNewline&&r(a,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),e.options.strict&&m.start<f.found.offset-1024&&r(p.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));let w=d?s(e,d,f,r):t(e,a,h,null,f,r);e.schema.compat&&le(i.indent,d,r),a=w.range[2];let x=new I(p,w);e.options.keepSourceTokens&&(x.srcToken=l),n.items.push(x)}else{y&&r(p.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),f.comment&&(p.comment?p.comment+=`
`+f.comment:p.comment=f.comment);let w=new I(p);e.options.keepSourceTokens&&(w.srcToken=l),n.items.push(w)}}return o&&o<a&&r(o,"IMPOSSIBLE","Map comment with trailing content"),n.range=[i.offset,a,o??a],n}function Ts({composeNode:s,composeEmptyNode:t},e,i,r){let n=new O(e.schema);e.atRoot&&(e.atRoot=!1);let a=i.offset,o=null;for(let{start:l,value:u}of i.items){let c=it(l,{indicator:"seq-item-ind",next:u,offset:a,onError:r,startOnNewline:!0});if(!c.found)if(c.anchor||c.tag||u)u&&u.type==="block-seq"?r(c.end,"BAD_INDENT","All sequence items must start at the same column"):r(a,"MISSING_CHAR","Sequence item without - indicator");else{o=c.end,c.comment&&(n.comment=c.comment);continue}let h=u?s(e,u,c,r):t(e,c.end,l,null,c,r);e.schema.compat&&le(i.indent,u,r),a=h.range[2],n.items.push(h)}return n.range=[i.offset,a,o??a],n}function st(s,t,e,i){let r="";if(s){let n=!1,a="";for(let o of s){let{source:l,type:u}=o;switch(u){case"space":n=!0;break;case"comment":{e&&!n&&i(o,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let c=l.substring(1)||" ";r?r+=a+c:r=c,a="";break}case"newline":r&&(a+=l),n=!0;break;default:i(o,"UNEXPECTED_TOKEN",`Unexpected ${u} at node end`)}t+=l.length}}return{comment:r,offset:t}}var Ci="Block collections are not allowed within flow collections",vi=s=>s&&(s.type==="block-map"||s.type==="block-seq");function As({composeNode:s,composeEmptyNode:t},e,i,r){let n=i.start.source==="{",a=n?"flow map":"flow sequence",o=n?new A(e.schema):new O(e.schema);o.flow=!0;let l=e.atRoot;l&&(e.atRoot=!1);let u=i.offset+i.start.source.length;for(let y=0;y<i.items.length;++y){let g=i.items[y],{start:p,key:f,sep:w,value:x}=g,_=it(p,{flow:a,indicator:"explicit-key-ind",next:f??w?.[0],offset:u,onError:r,startOnNewline:!1});if(!_.found){if(!_.anchor&&!_.tag&&!w&&!x){y===0&&_.comma?r(_.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`):y<i.items.length-1&&r(_.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${a}`),_.comment&&(o.comment?o.comment+=`
`+_.comment:o.comment=_.comment),u=_.end;continue}!n&&e.options.strict&&yt(f)&&r(f,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(y===0)_.comma&&r(_.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`);else if(_.comma||r(_.start,"MISSING_CHAR",`Missing , between ${a} items`),_.comment){let B="";t:for(let S of p)switch(S.type){case"comma":case"space":break;case"comment":B=S.source.substring(1);break t;default:break t}if(B){let S=o.items[o.items.length-1];v(S)&&(S=S.value??S.key),S.comment?S.comment+=`
`+B:S.comment=B,_.comment=_.comment.substring(B.length+1)}}if(!n&&!w&&!_.found){let B=x?s(e,x,_,r):t(e,_.end,w,null,_,r);o.items.push(B),u=B.range[2],vi(x)&&r(B.range,"BLOCK_IN_FLOW",Ci)}else{let B=_.end,S=f?s(e,f,_,r):t(e,B,p,null,_,r);vi(f)&&r(S.range,"BLOCK_IN_FLOW",Ci);let E=it(w??[],{flow:a,indicator:"map-value-ind",next:x,offset:S.range[2],onError:r,startOnNewline:!1});if(E.found){if(!n&&!_.found&&e.options.strict){if(w)for(let Q of w){if(Q===E.found)break;if(Q.type==="newline"){r(Q,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}_.start<E.found.offset-1024&&r(E.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else x&&("source"in x&&x.source&&x.source[0]===":"?r(x,"MISSING_CHAR",`Missing space after : in ${a}`):r(E.start,"MISSING_CHAR",`Missing , or : between ${a} items`));let Wt=x?s(e,x,E,r):E.found?t(e,E.end,w,null,E,r):null;Wt?vi(x)&&r(Wt.range,"BLOCK_IN_FLOW",Ci):E.comment&&(S.comment?S.comment+=`
`+E.comment:S.comment=E.comment);let ti=new I(S,Wt);if(e.options.keepSourceTokens&&(ti.srcToken=g),n){let Q=o;He(e,Q.items,S)&&r(B,"DUPLICATE_KEY","Map keys must be unique"),Q.items.push(ti)}else{let Q=new A(e.schema);Q.flow=!0,Q.items.push(ti),o.items.push(Q)}u=Wt?Wt.range[2]:E.end}}let c=n?"}":"]",[h,...d]=i.end,m=u;if(h&&h.source===c)m=h.offset+h.source.length;else{let y=a[0].toUpperCase()+a.substring(1),g=l?`${y} must end with a ${c}`:`${y} in block collection must be sufficiently indented and end with a ${c}`;r(u,l?"MISSING_CHAR":"BAD_INDENT",g),h&&h.source.length!==1&&d.unshift(h)}if(d.length>0){let y=st(d,m,e.options.strict,r);y.comment&&(o.comment?o.comment+=`
`+y.comment:o.comment=y.comment),o.range=[i.offset,m,y.offset]}else o.range=[i.offset,m,m];return o}function Ls(s,t,e,i,r){let n;switch(e.type){case"block-map":{n=Is(s,t,e,r);break}case"block-seq":{n=Ts(s,t,e,r);break}case"flow-collection":{n=As(s,t,e,r);break}}if(!i)return n;let a=t.directives.tagName(i.source,d=>r(i,"TAG_RESOLVE_FAILED",d));if(!a)return n;let o=n.constructor;if(a==="!"||a===o.tagName)return n.tag=o.tagName,n;let l=N(n)?"map":"seq",u=t.schema.tags.find(d=>d.collection===l&&d.tag===a);if(!u){let d=t.schema.knownTags[a];if(d&&d.collection===l)t.schema.tags.push(Object.assign({},d,{default:!1})),u=d;else return r(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${a}`,!0),n.tag=a,n}let c=u.resolve(n,d=>r(i,"TAG_RESOLVE_FAILED",d),t.options),h=P(c)?c:new b(c);return h.range=n.range,h.tag=a,u?.format&&(h.format=u.format),h}function Pi(s,t,e){let i=s.offset,r=vr(s,t,e);if(!r)return{value:"",type:null,comment:"",range:[i,i,i]};let n=r.mode===">"?b.BLOCK_FOLDED:b.BLOCK_LITERAL,a=s.source?Pr(s.source):[],o=a.length;for(let g=a.length-1;g>=0;--g){let p=a[g][1];if(p===""||p==="\r")o=g;else break}if(o===0){let g=r.chomp==="+"&&a.length>0?`
`.repeat(Math.max(1,a.length-1)):"",p=i+r.length;return s.source&&(p+=s.source.length),{value:g,type:n,comment:r.comment,range:[i,p,p]}}let l=s.indent+r.indent,u=s.offset+r.length,c=0;for(let g=0;g<o;++g){let[p,f]=a[g];if(f===""||f==="\r")r.indent===0&&p.length>l&&(l=p.length);else{if(p.length<l){let w="Block scalars with more-indented leading empty lines must use an explicit indentation indicator";e(u+p.length,"MISSING_CHAR",w)}r.indent===0&&(l=p.length),c=g;break}u+=p.length+f.length+1}for(let g=a.length-1;g>=o;--g)a[g][0].length>l&&(o=g+1);let h="",d="",m=!1;for(let g=0;g<c;++g)h+=a[g][0].slice(l)+`
`;for(let g=c;g<o;++g){let[p,f]=a[g];u+=p.length+f.length+1;let w=f[f.length-1]==="\r";if(w&&(f=f.slice(0,-1)),f&&p.length<l){let _=`Block scalar lines must not be less indented than their ${r.indent?"explicit indentation indicator":"first line"}`;e(u-f.length-(w?2:1),"BAD_INDENT",_),p=""}n===b.BLOCK_LITERAL?(h+=d+p.slice(l)+f,d=`
`):p.length>l||f[0]==="	"?(d===" "?d=`
`:!m&&d===`
`&&(d=`

`),h+=d+p.slice(l)+f,d=`
`,m=!0):f===""?d===`
`?h+=`
`:d=`
`:(h+=d+f,d=" ",m=!1)}switch(r.chomp){case"-":break;case"+":for(let g=o;g<a.length;++g)h+=`
`+a[g][0].slice(l);h[h.length-1]!==`
`&&(h+=`
`);break;default:h+=`
`}let y=i+r.length+s.source.length;return{value:h,type:n,comment:r.comment,range:[i,y,y]}}function vr({offset:s,props:t},e,i){if(t[0].type!=="block-scalar-header")return i(t[0],"IMPOSSIBLE","Block scalar header not found"),null;let{source:r}=t[0],n=r[0],a=0,o="",l=-1;for(let d=1;d<r.length;++d){let m=r[d];if(!o&&(m==="-"||m==="+"))o=m;else{let y=Number(m);!a&&y?a=y:l===-1&&(l=s+d)}}l!==-1&&i(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${r}`);let u=!1,c="",h=r.length;for(let d=1;d<t.length;++d){let m=t[d];switch(m.type){case"space":u=!0;case"newline":h+=m.source.length;break;case"comment":e&&!u&&i(m,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),h+=m.source.length,c=m.source.substring(1);break;case"error":i(m,"UNEXPECTED_TOKEN",m.message),h+=m.source.length;break;default:{let y=`Unexpected token in block scalar header: ${m.type}`;i(m,"UNEXPECTED_TOKEN",y);let g=m.source;g&&typeof g=="string"&&(h+=g.length)}}}return{mode:n,indent:a,chomp:o,comment:c,length:h}}function Pr(s){let t=s.split(/\n( *)/),e=t[0],i=e.match(/^( *)/),n=[i?.[1]?[i[1],e.slice(i[1].length)]:["",e]];for(let a=1;a<t.length;a+=2)n.push([t[a],t[a+1]]);return n}function Bi(s,t,e){let{offset:i,type:r,source:n,end:a}=s,o,l,u=(d,m,y)=>e(i+d,m,y);switch(r){case"scalar":o=b.PLAIN,l=Br(n,u);break;case"single-quoted-scalar":o=b.QUOTE_SINGLE,l=Mr(n,u);break;case"double-quoted-scalar":o=b.QUOTE_DOUBLE,l=Ir(n,u);break;default:return e(s,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${r}`),{value:"",type:null,comment:"",range:[i,i+n.length,i+n.length]}}let c=i+n.length,h=st(a,c,t,e);return{value:l,type:o,comment:h.comment,range:[i,c,h.offset]}}function Br(s,t){let e="";switch(s[0]){case"	":e="a tab character";break;case",":e="flow indicator character ,";break;case"%":e="directive indicator character %";break;case"|":case">":{e=`block scalar indicator ${s[0]}`;break}case"@":case"`":{e=`reserved character ${s[0]}`;break}}return e&&t(0,"BAD_SCALAR_START",`Plain value cannot start with ${e}`),Es(s)}function Mr(s,t){return(s[s.length-1]!=="'"||s.length===1)&&t(s.length,"MISSING_CHAR","Missing closing 'quote"),Es(s.slice(1,-1)).replace(/''/g,"'")}function Es(s){let t,e;try{t=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),e=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{t=/(.*?)[ \t]*\r?\n/sy,e=/[ \t]*(.*?)[ \t]*\r?\n/sy}let i=t.exec(s);if(!i)return s;let r=i[1],n=" ",a=t.lastIndex;for(e.lastIndex=a;i=e.exec(s);)i[1]===""?n===`
`?r+=n:n=`
`:(r+=n+i[1],n=" "),a=e.lastIndex;let o=/[ \t]*(.*)/sy;return o.lastIndex=a,i=o.exec(s),r+n+(i?.[1]??"")}function Ir(s,t){let e="";for(let i=1;i<s.length-1;++i){let r=s[i];if(!(r==="\r"&&s[i+1]===`
`))if(r===`
`){let{fold:n,offset:a}=Tr(s,i);e+=n,i=a}else if(r==="\\"){let n=s[++i],a=Ar[n];if(a)e+=a;else if(n===`
`)for(n=s[i+1];n===" "||n==="	";)n=s[++i+1];else if(n==="\r"&&s[i+1]===`
`)for(n=s[++i+1];n===" "||n==="	";)n=s[++i+1];else if(n==="x"||n==="u"||n==="U"){let o={x:2,u:4,U:8}[n];e+=Lr(s,i+1,o,t),i+=o}else{let o=s.substr(i-1,2);t(i-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),e+=o}}else if(r===" "||r==="	"){let n=i,a=s[i+1];for(;a===" "||a==="	";)a=s[++i+1];a!==`
`&&!(a==="\r"&&s[i+2]===`
`)&&(e+=i>n?s.slice(n,i+1):r)}else e+=r}return(s[s.length-1]!=='"'||s.length===1)&&t(s.length,"MISSING_CHAR",'Missing closing "quote'),e}function Tr(s,t){let e="",i=s[t+1];for(;(i===" "||i==="	"||i===`
`||i==="\r")&&!(i==="\r"&&s[t+2]!==`
`);)i===`
`&&(e+=`
`),t+=1,i=s[t+1];return e||(e=" "),{fold:e,offset:t}}var Ar={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:"",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function Lr(s,t,e,i){let r=s.substr(t,e),a=r.length===e&&/^[0-9a-fA-F]+$/.test(r)?parseInt(r,16):NaN;if(isNaN(a)){let o=s.substr(t-2,e+2);return i(t-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),o}return String.fromCodePoint(a)}function Mi(s,t,e,i){let{value:r,type:n,comment:a,range:o}=t.type==="block-scalar"?Pi(t,s.options.strict,i):Bi(t,s.options.strict,i),l=e?s.directives.tagName(e.source,h=>i(e,"TAG_RESOLVE_FAILED",h)):null,u=e&&l?Er(s.schema,r,l,e,i):t.type==="scalar"?kr(s,r,t,i):s.schema[F],c;try{let h=u.resolve(r,d=>i(e??t,"TAG_RESOLVE_FAILED",d),s.options);c=C(h)?h:new b(h)}catch(h){let d=h instanceof Error?h.message:String(h);i(e??t,"TAG_RESOLVE_FAILED",d),c=new b(r)}return c.range=o,c.source=r,n&&(c.type=n),l&&(c.tag=l),u.format&&(c.format=u.format),a&&(c.comment=a),c}function Er(s,t,e,i,r){if(e==="!")return s[F];let n=[];for(let o of s.tags)if(!o.collection&&o.tag===e)if(o.default&&o.test)n.push(o);else return o;for(let o of n)if(o.test?.test(t))return o;let a=s.knownTags[e];return a&&!a.collection?(s.tags.push(Object.assign({},a,{default:!1,test:void 0})),a):(r(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${e}`,e!=="tag:yaml.org,2002:str"),s[F])}function kr({directives:s,schema:t},e,i,r){let n=t.tags.find(a=>a.default&&a.test?.test(e))||t[F];if(t.compat){let a=t.compat.find(o=>o.default&&o.test?.test(e))??t[F];if(n.tag!==a.tag){let o=s.tagString(n.tag),l=s.tagString(a.tag),u=`Value may be parsed as either ${o} or ${l}`;r(i,"TAG_RESOLVE_FAILED",u,!0)}}return n}function ks(s,t,e){if(t){e===null&&(e=t.length);for(let i=e-1;i>=0;--i){let r=t[i];switch(r.type){case"space":case"comment":case"newline":s-=r.source.length;continue}for(r=t[++i];r?.type==="space";)s+=r.source.length,r=t[++i];break}}return s}var Vr={composeNode:Ii,composeEmptyNode:Xe};function Ii(s,t,e,i){let{spaceBefore:r,comment:n,anchor:a,tag:o}=e,l,u=!0;switch(t.type){case"alias":l=Rr(s,t,i),(a||o)&&i(t,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":l=Mi(s,t,o,i),a&&(l.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":l=Ls(Vr,s,t,o,i),a&&(l.anchor=a.source.substring(1));break;default:{let c=t.type==="error"?t.message:`Unsupported token (type: ${t.type})`;i(t,"UNEXPECTED_TOKEN",c),l=Xe(s,t.offset,void 0,null,e,i),u=!1}}return a&&l.anchor===""&&i(a,"BAD_ALIAS","Anchor cannot be an empty string"),r&&(l.spaceBefore=!0),n&&(t.type==="scalar"&&t.source===""?l.comment=n:l.commentBefore=n),s.options.keepSourceTokens&&u&&(l.srcToken=t),l}function Xe(s,t,e,i,{spaceBefore:r,comment:n,anchor:a,tag:o,end:l},u){let c={type:"scalar",offset:ks(t,e,i),indent:-1,source:""},h=Mi(s,c,o,u);return a&&(h.anchor=a.source.substring(1),h.anchor===""&&u(a,"BAD_ALIAS","Anchor cannot be an empty string")),r&&(h.spaceBefore=!0),n&&(h.comment=n,h.range[2]=l),h}function Rr({options:s},{offset:t,source:e,end:i},r){let n=new lt(e.substring(1));n.source===""&&r(t,"BAD_ALIAS","Alias cannot be an empty string"),n.source.endsWith(":")&&r(t+e.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);let a=t+e.length,o=st(i,a,s.strict,r);return n.range=[t,a,o.offset],o.comment&&(n.comment=o.comment),n}function Vs(s,t,{offset:e,start:i,value:r,end:n},a){let o=Object.assign({_directives:t},s),l=new et(void 0,o),u={atRoot:!0,directives:l.directives,options:l.options,schema:l.schema},c=it(i,{indicator:"doc-start",next:r??n?.[0],offset:e,onError:a,startOnNewline:!0});c.found&&(l.directives.docStart=!0,r&&(r.type==="block-map"||r.type==="block-seq")&&!c.hasNewline&&a(c.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),l.contents=r?Ii(u,r,c,a):Xe(u,c.end,i,null,c,a);let h=l.contents.range[2],d=st(n,h,!1,a);return d.comment&&(l.comment=d.comment),l.range=[e,h,d.offset],l}function ue(s){if(typeof s=="number")return[s,s+1];if(Array.isArray(s))return s.length===2?s:[s[0],s[1]];let{offset:t,source:e}=s;return[t,t+(typeof e=="string"?e.length:1)]}function Rs(s){let t="",e=!1,i=!1;for(let r=0;r<s.length;++r){let n=s[r];switch(n[0]){case"#":t+=(t===""?"":i?`

`:`
`)+(n.substring(1)||" "),e=!0,i=!1;break;case"%":s[r+1]?.[0]!=="#"&&(r+=1),e=!1;break;default:e||(i=!0),e=!1}}return{comment:t,afterEmptyLine:i}}var ce=class{constructor(t={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,i,r,n)=>{let a=ue(e);n?this.warnings.push(new oe(a,i,r)):this.errors.push(new K(a,i,r))},this.directives=new T({version:t.version||"1.2"}),this.options=t}decorate(t,e){let{comment:i,afterEmptyLine:r}=Rs(this.prelude);if(i){let n=t.contents;if(e)t.comment=t.comment?`${t.comment}
${i}`:i;else if(r||t.directives.docStart||!n)t.commentBefore=i;else if(M(n)&&!n.flow&&n.items.length>0){let a=n.items[0];v(a)&&(a=a.key);let o=a.commentBefore;a.commentBefore=o?`${i}
${o}`:i}else{let a=n.commentBefore;n.commentBefore=a?`${i}
${a}`:i}}e?(Array.prototype.push.apply(t.errors,this.errors),Array.prototype.push.apply(t.warnings,this.warnings)):(t.errors=this.errors,t.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Rs(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(t,e=!1,i=-1){for(let r of t)yield*this.next(r);yield*this.end(e,i)}*next(t){switch(t.type){case"directive":this.directives.add(t.source,(e,i,r)=>{let n=ue(t);n[0]+=e,this.onError(n,"BAD_DIRECTIVE",i,r)}),this.prelude.push(t.source),this.atDirectives=!0;break;case"document":{let e=Vs(this.options,this.directives,t,this.onError);this.atDirectives&&!e.directives.docStart&&this.onError(t,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(e,!1),this.doc&&(yield this.doc),this.doc=e,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(t.source);break;case"error":{let e=t.source?`${t.message}: ${JSON.stringify(t.source)}`:t.message,i=new K(ue(t),"UNEXPECTED_TOKEN",e);this.atDirectives||!this.doc?this.errors.push(i):this.doc.errors.push(i);break}case"doc-end":{if(!this.doc){let i="Unexpected doc-end without preceding document";this.errors.push(new K(ue(t),"UNEXPECTED_TOKEN",i));break}this.doc.directives.docEnd=!0;let e=st(t.end,t.offset+t.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),e.comment){let i=this.doc.comment;this.doc.comment=i?`${i}
${e.comment}`:e.comment}this.doc.range[2]=e.offset;break}default:this.errors.push(new K(ue(t),"UNEXPECTED_TOKEN",`Unsupported token ${t.type}`))}}*end(t=!1,e=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(t){let i=Object.assign({_directives:this.directives},this.options),r=new et(void 0,i);this.atDirectives&&this.onError(e,"MISSING_CHAR","Missing directives-end indicator line"),r.range=[0,e,e],this.decorate(r,!1),yield r}}};var Ti=Symbol("break visit"),Dr=Symbol("skip children"),Ds=Symbol("remove item");function Mt(s,t){"type"in s&&s.type==="document"&&(s={start:s.start,value:s.value}),Os(Object.freeze([]),s,t)}Mt.BREAK=Ti;Mt.SKIP=Dr;Mt.REMOVE=Ds;Mt.itemAtPath=(s,t)=>{let e=s;for(let[i,r]of t){let n=e?.[i];if(n&&"items"in n)e=n.items[r];else return}return e};Mt.parentCollection=(s,t)=>{let e=Mt.itemAtPath(s,t.slice(0,-1)),i=t[t.length-1][0],r=e?.[i];if(r&&"items"in r)return r;throw new Error("Parent collection not found")};function Os(s,t,e){let i=e(t,s);if(typeof i=="symbol")return i;for(let r of["key","value"]){let n=t[r];if(n&&"items"in n){for(let a=0;a<n.items.length;++a){let o=Os(Object.freeze(s.concat([[r,a]])),n.items[a],e);if(typeof o=="number")a=o-1;else{if(o===Ti)return Ti;o===Ds&&(n.items.splice(a,1),a-=1)}}typeof i=="function"&&r==="key"&&(i=i(t,s))}}return typeof i=="function"?i(t,s):i}var Ai="\uFEFF",Li="",Ei="",Ge="";function Ns(s){switch(s){case Ai:return"byte-order-mark";case Li:return"doc-mode";case Ei:return"flow-error-end";case Ge:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(s[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}function U(s){switch(s){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}var Fs="0123456789ABCDEFabcdef".split(""),Nr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()".split(""),ki=",[]{}".split(""),Fr=` ,[]{}
\r	`.split(""),Vi=s=>!s||Fr.includes(s),he=class{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(t,e=!1){t&&(this.buffer=this.buffer?this.buffer+t:t,this.lineEndPos=null),this.atEnd=!e;let i=this.next??"stream";for(;i&&(e||this.hasChars(1));)i=yield*this.parseNext(i)}atLineEnd(){let t=this.pos,e=this.buffer[t];for(;e===" "||e==="	";)e=this.buffer[++t];return!e||e==="#"||e===`
`?!0:e==="\r"?this.buffer[t+1]===`
`:!1}charAt(t){return this.buffer[this.pos+t]}continueScalar(t){let e=this.buffer[t];if(this.indentNext>0){let i=0;for(;e===" ";)e=this.buffer[++i+t];if(e==="\r"){let r=this.buffer[i+t+1];if(r===`
`||!r&&!this.atEnd)return t+i+1}return e===`
`||i>=this.indentNext||!e&&!this.atEnd?t+i:-1}if(e==="-"||e==="."){let i=this.buffer.substr(t,3);if((i==="---"||i==="...")&&U(this.buffer[t+3]))return-1}return t}getLine(){let t=this.lineEndPos;return(typeof t!="number"||t!==-1&&t<this.pos)&&(t=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=t),t===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[t-1]==="\r"&&(t-=1),this.buffer.substring(this.pos,t))}hasChars(t){return this.pos+t<=this.buffer.length}setNext(t){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=t,null}peek(t){return this.buffer.substr(this.pos,t)}*parseNext(t){switch(t){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let t=this.getLine();if(t===null)return this.setNext("stream");if(t[0]===Ai&&(yield*this.pushCount(1),t=t.substring(1)),t[0]==="%"){let e=t.length,i=t.indexOf("#");if(i!==-1){let n=t[i-1];(n===" "||n==="	")&&(e=i-1)}for(;;){let n=t[e-1];if(n===" "||n==="	")e-=1;else break}let r=(yield*this.pushCount(e))+(yield*this.pushSpaces(!0));return yield*this.pushCount(t.length-r),this.pushNewline(),"stream"}if(this.atLineEnd()){let e=yield*this.pushSpaces(!0);return yield*this.pushCount(t.length-e),yield*this.pushNewline(),"stream"}return yield Li,yield*this.parseLineStart()}*parseLineStart(){let t=this.charAt(0);if(!t&&!this.atEnd)return this.setNext("line-start");if(t==="-"||t==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");let e=this.peek(3);if(e==="---"&&U(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"doc";if(e==="..."&&U(this.charAt(3)))return yield*this.pushCount(3),"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!U(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){let[t,e]=this.peek(2);if(!e&&!this.atEnd)return this.setNext("block-start");if((t==="-"||t==="?"||t===":")&&U(e)){let i=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=i,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);let t=this.getLine();if(t===null)return this.setNext("doc");let e=yield*this.pushIndicators();switch(t[e]){case"#":yield*this.pushCount(t.length-e);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(Vi),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return e+=yield*this.parseBlockScalarHeader(),e+=yield*this.pushSpaces(!0),yield*this.pushCount(t.length-e),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let t,e,i=-1;do t=yield*this.pushNewline(),t>0?(e=yield*this.pushSpaces(!1),this.indentValue=i=e):e=0,e+=yield*this.pushSpaces(!0);while(t+e>0);let r=this.getLine();if(r===null)return this.setNext("flow");if((i!==-1&&i<this.indentNext&&r[0]!=="#"||i===0&&(r.startsWith("---")||r.startsWith("..."))&&U(r[3]))&&!(i===this.indentNext-1&&this.flowLevel===1&&(r[0]==="]"||r[0]==="}")))return this.flowLevel=0,yield Ei,yield*this.parseLineStart();let n=0;for(;r[n]===",";)n+=yield*this.pushCount(1),n+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(n+=yield*this.pushIndicators(),r[n]){case void 0:return"flow";case"#":return yield*this.pushCount(r.length-n),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(Vi),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{let a=this.charAt(1);if(this.flowKey||U(a)||a===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){let t=this.charAt(0),e=this.buffer.indexOf(t,this.pos+1);if(t==="'")for(;e!==-1&&this.buffer[e+1]==="'";)e=this.buffer.indexOf("'",e+2);else for(;e!==-1;){let n=0;for(;this.buffer[e-1-n]==="\\";)n+=1;if(n%2===0)break;e=this.buffer.indexOf('"',e+1)}let i=this.buffer.substring(0,e),r=i.indexOf(`
`,this.pos);if(r!==-1){for(;r!==-1;){let n=this.continueScalar(r+1);if(n===-1)break;r=i.indexOf(`
`,n)}r!==-1&&(e=r-(i[r-1]==="\r"?2:1))}if(e===-1){if(!this.atEnd)return this.setNext("quoted-scalar");e=this.buffer.length}return yield*this.pushToIndex(e+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let t=this.pos;for(;;){let e=this.buffer[++t];if(e==="+")this.blockScalarKeep=!0;else if(e>"0"&&e<="9")this.blockScalarIndent=Number(e)-1;else if(e!=="-")break}return yield*this.pushUntil(e=>U(e)||e==="#")}*parseBlockScalar(){let t=this.pos-1,e=0,i;t:for(let r=this.pos;i=this.buffer[r];++r)switch(i){case" ":e+=1;break;case`
`:t=r,e=0;break;case"\r":{let n=this.buffer[r+1];if(!n&&!this.atEnd)return this.setNext("block-scalar");if(n===`
`)break}default:break t}if(!i&&!this.atEnd)return this.setNext("block-scalar");if(e>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=e:this.indentNext+=this.blockScalarIndent;do{let r=this.continueScalar(t+1);if(r===-1)break;t=this.buffer.indexOf(`
`,r)}while(t!==-1);if(t===-1){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}if(!this.blockScalarKeep)do{let r=t-1,n=this.buffer[r];n==="\r"&&(n=this.buffer[--r]);let a=r;for(;n===" "||n==="	";)n=this.buffer[--r];if(n===`
`&&r>=this.pos&&r+1+e>a)t=r;else break}while(!0);return yield Ge,yield*this.pushToIndex(t+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){let t=this.flowLevel>0,e=this.pos-1,i=this.pos-1,r;for(;r=this.buffer[++i];)if(r===":"){let n=this.buffer[i+1];if(U(n)||t&&n===",")break;e=i}else if(U(r)){let n=this.buffer[i+1];if(r==="\r"&&(n===`
`?(i+=1,r=`
`,n=this.buffer[i+1]):e=i),n==="#"||t&&ki.includes(n))break;if(r===`
`){let a=this.continueScalar(i+1);if(a===-1)break;i=Math.max(i,a-2)}}else{if(t&&ki.includes(r))break;e=i}return!r&&!this.atEnd?this.setNext("plain-scalar"):(yield Ge,yield*this.pushToIndex(e+1,!0),t?"flow":"doc")}*pushCount(t){return t>0?(yield this.buffer.substr(this.pos,t),this.pos+=t,t):0}*pushToIndex(t,e){let i=this.buffer.slice(this.pos,t);return i?(yield i,this.pos+=i.length,i.length):(e&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(Vi))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{let t=this.flowLevel>0,e=this.charAt(1);if(U(e)||t&&ki.includes(e))return t?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let t=this.pos+2,e=this.buffer[t];for(;!U(e)&&e!==">";)e=this.buffer[++t];return yield*this.pushToIndex(e===">"?t+1:t,!1)}else{let t=this.pos+1,e=this.buffer[t];for(;e;)if(Nr.includes(e))e=this.buffer[++t];else if(e==="%"&&Fs.includes(this.buffer[t+1])&&Fs.includes(this.buffer[t+2]))e=this.buffer[t+=3];else break;return yield*this.pushToIndex(t,!1)}}*pushNewline(){let t=this.buffer[this.pos];return t===`
`?yield*this.pushCount(1):t==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(t){let e=this.pos-1,i;do i=this.buffer[++e];while(i===" "||t&&i==="	");let r=e-this.pos;return r>0&&(yield this.buffer.substr(this.pos,r),this.pos=e),r}*pushUntil(t){let e=this.pos,i=this.buffer[e];for(;!t(i);)i=this.buffer[++e];return yield*this.pushToIndex(e,!1)}};var de=class{constructor(){this.lineStarts=[],this.addNewLine=t=>this.lineStarts.push(t),this.linePos=t=>{let e=0,i=this.lineStarts.length;for(;e<i;){let n=e+i>>1;this.lineStarts[n]<t?e=n+1:i=n}if(this.lineStarts[e]===t)return{line:e+1,col:1};if(e===0)return{line:0,col:t};let r=this.lineStarts[e-1];return{line:e,col:t-r+1}}}};function J(s,t){for(let e=0;e<s.length;++e)if(s[e].type===t)return!0;return!1}function $s(s){for(let t=0;t<s.length;++t)switch(s[t].type){case"space":case"comment":case"newline":break;default:return t}return-1}function js(s){switch(s?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Ke(s){switch(s.type){case"document":return s.start;case"block-map":{let t=s.items[s.items.length-1];return t.sep??t.start}case"block-seq":return s.items[s.items.length-1].start;default:return[]}}function zt(s){if(s.length===0)return[];let t=s.length;t:for(;--t>=0;)switch(s[t].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break t}for(;s[++t]?.type==="space";);return s.splice(t,s.length)}function Us(s){if(s.start.type==="flow-seq-start")for(let t of s.items)t.sep&&!t.value&&!J(t.start,"explicit-key-ind")&&!J(t.sep,"map-value-ind")&&(t.key&&(t.value=t.key),delete t.key,js(t.value)?t.value.end?Array.prototype.push.apply(t.value.end,t.sep):t.value.end=t.sep:Array.prototype.push.apply(t.start,t.sep),delete t.sep)}var ge=class{constructor(t){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new he,this.onNewLine=t}*parse(t,e=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(let i of this.lexer.lex(t,e))yield*this.next(i);e||(yield*this.end())}*next(t){if(this.source=t,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=t.length;return}let e=Ns(t);if(e)if(e==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=e,yield*this.step(),e){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+t.length);break;case"space":this.atNewLine&&t[0]===" "&&(this.indent+=t.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=t.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=t.length}else{let i=`Not a YAML token: ${t}`;yield*this.pop({type:"error",offset:this.offset,message:i,source:t}),this.offset+=t.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){let t=this.peek(1);if(this.type==="doc-end"&&(!t||t.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!t)return yield*this.stream();switch(t.type){case"document":return yield*this.document(t);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(t);case"block-scalar":return yield*this.blockScalar(t);case"block-map":return yield*this.blockMap(t);case"block-seq":return yield*this.blockSequence(t);case"flow-collection":return yield*this.flowCollection(t);case"doc-end":return yield*this.documentEnd(t)}yield*this.pop()}peek(t){return this.stack[this.stack.length-t]}*pop(t){let e=t??this.stack.pop();if(e)if(this.stack.length===0)yield e;else{let i=this.peek(1);switch(e.type==="block-scalar"?e.indent="indent"in i?i.indent:0:e.type==="flow-collection"&&i.type==="document"&&(e.indent=0),e.type==="flow-collection"&&Us(e),i.type){case"document":i.value=e;break;case"block-scalar":i.props.push(e);break;case"block-map":{let r=i.items[i.items.length-1];if(r.value){i.items.push({start:[],key:e,sep:[]}),this.onKeyLine=!0;return}else if(r.sep)r.value=e;else{Object.assign(r,{key:e,sep:[]}),this.onKeyLine=!J(r.start,"explicit-key-ind");return}break}case"block-seq":{let r=i.items[i.items.length-1];r.value?i.items.push({start:[],value:e}):r.value=e;break}case"flow-collection":{let r=i.items[i.items.length-1];!r||r.value?i.items.push({start:[],key:e,sep:[]}):r.sep?r.value=e:Object.assign(r,{key:e,sep:[]});return}default:yield*this.pop(),yield*this.pop(e)}if((i.type==="document"||i.type==="block-map"||i.type==="block-seq")&&(e.type==="block-map"||e.type==="block-seq")){let r=e.items[e.items.length-1];r&&!r.sep&&!r.value&&r.start.length>0&&$s(r.start)===-1&&(e.indent===0||r.start.every(n=>n.type!=="comment"||n.indent<e.indent))&&(i.type==="document"?i.end=r.start:i.items.push({start:r.start}),e.items.splice(-1,1))}}else{let i="Tried to pop an empty stack";yield{type:"error",offset:this.offset,source:"",message:i}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{let t={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&t.start.push(this.sourceToken),this.stack.push(t);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(t){if(t.value)return yield*this.lineEnd(t);switch(this.type){case"doc-start":{$s(t.start)!==-1?(yield*this.pop(),yield*this.step()):t.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":t.start.push(this.sourceToken);return}let e=this.startBlockValue(t);e?this.stack.push(e):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(t){if(this.type==="map-value-ind"){let e=Ke(this.peek(2)),i=zt(e),r;t.end?(r=t.end,r.push(this.sourceToken),delete t.end):r=[this.sourceToken];let n={type:"block-map",offset:t.offset,indent:t.indent,items:[{start:i,key:t,sep:r}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=n}else yield*this.lineEnd(t)}*blockScalar(t){switch(this.type){case"space":case"comment":case"newline":t.props.push(this.sourceToken);return;case"scalar":if(t.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf(`
`)+1;for(;e!==0;)this.onNewLine(this.offset+e),e=this.source.indexOf(`
`,e)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(t){let e=t.items[t.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,e.value){let i="end"in e.value?e.value.end:void 0;(Array.isArray(i)?i[i.length-1]:void 0)?.type==="comment"?i?.push(this.sourceToken):t.items.push({start:[this.sourceToken]})}else e.sep?e.sep.push(this.sourceToken):e.start.push(this.sourceToken);return;case"space":case"comment":if(e.value)t.items.push({start:[this.sourceToken]});else if(e.sep)e.sep.push(this.sourceToken);else{if(this.atIndentedComment(e.start,t.indent)){let r=t.items[t.items.length-2]?.value?.end;if(Array.isArray(r)){Array.prototype.push.apply(r,e.start),r.push(this.sourceToken),t.items.pop();return}}e.start.push(this.sourceToken)}return}if(this.indent>=t.indent){let i=!this.onKeyLine&&this.indent===t.indent&&e.sep,r=[];if(i&&e.sep&&!e.value){let n=[];for(let a=0;a<e.sep.length;++a){let o=e.sep[a];switch(o.type){case"newline":n.push(a);break;case"space":break;case"comment":o.indent>t.indent&&(n.length=0);break;default:n.length=0}}n.length>=2&&(r=e.sep.splice(n[1]))}switch(this.type){case"anchor":case"tag":i||e.value?(r.push(this.sourceToken),t.items.push({start:r}),this.onKeyLine=!0):e.sep?e.sep.push(this.sourceToken):e.start.push(this.sourceToken);return;case"explicit-key-ind":!e.sep&&!J(e.start,"explicit-key-ind")?e.start.push(this.sourceToken):i||e.value?(r.push(this.sourceToken),t.items.push({start:r})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]}),this.onKeyLine=!0;return;case"map-value-ind":if(J(e.start,"explicit-key-ind"))if(e.sep)if(e.value)t.items.push({start:[],key:null,sep:[this.sourceToken]});else if(J(e.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:r,key:null,sep:[this.sourceToken]}]});else if(js(e.key)&&!J(e.sep,"newline")){let n=zt(e.start),a=e.key,o=e.sep;o.push(this.sourceToken),delete e.key,delete e.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,key:a,sep:o}]})}else r.length>0?e.sep=e.sep.concat(r,this.sourceToken):e.sep.push(this.sourceToken);else if(J(e.start,"newline"))Object.assign(e,{key:null,sep:[this.sourceToken]});else{let n=zt(e.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,key:null,sep:[this.sourceToken]}]})}else e.sep?e.value||i?t.items.push({start:r,key:null,sep:[this.sourceToken]}):J(e.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):e.sep.push(this.sourceToken):Object.assign(e,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let n=this.flowScalar(this.type);i||e.value?(t.items.push({start:r,key:n,sep:[]}),this.onKeyLine=!0):e.sep?this.stack.push(n):(Object.assign(e,{key:n,sep:[]}),this.onKeyLine=!0);return}default:{let n=this.startBlockValue(t);if(n){i&&n.type!=="block-seq"&&J(e.start,"explicit-key-ind")&&t.items.push({start:r}),this.stack.push(n);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(t){let e=t.items[t.items.length-1];switch(this.type){case"newline":if(e.value){let i="end"in e.value?e.value.end:void 0;(Array.isArray(i)?i[i.length-1]:void 0)?.type==="comment"?i?.push(this.sourceToken):t.items.push({start:[this.sourceToken]})}else e.start.push(this.sourceToken);return;case"space":case"comment":if(e.value)t.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(e.start,t.indent)){let r=t.items[t.items.length-2]?.value?.end;if(Array.isArray(r)){Array.prototype.push.apply(r,e.start),r.push(this.sourceToken),t.items.pop();return}}e.start.push(this.sourceToken)}return;case"anchor":case"tag":if(e.value||this.indent<=t.indent)break;e.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==t.indent)break;e.value||J(e.start,"seq-item-ind")?t.items.push({start:[this.sourceToken]}):e.start.push(this.sourceToken);return}if(this.indent>t.indent){let i=this.startBlockValue(t);if(i){this.stack.push(i);return}}yield*this.pop(),yield*this.step()}*flowCollection(t){let e=t.items[t.items.length-1];if(this.type==="flow-error-end"){let i;do yield*this.pop(),i=this.peek(1);while(i&&i.type==="flow-collection")}else if(t.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!e||e.sep?t.items.push({start:[this.sourceToken]}):e.start.push(this.sourceToken);return;case"map-value-ind":!e||e.value?t.items.push({start:[],key:null,sep:[this.sourceToken]}):e.sep?e.sep.push(this.sourceToken):Object.assign(e,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!e||e.value?t.items.push({start:[this.sourceToken]}):e.sep?e.sep.push(this.sourceToken):e.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let r=this.flowScalar(this.type);!e||e.value?t.items.push({start:[],key:r,sep:[]}):e.sep?this.stack.push(r):Object.assign(e,{key:r,sep:[]});return}case"flow-map-end":case"flow-seq-end":t.end.push(this.sourceToken);return}let i=this.startBlockValue(t);i?this.stack.push(i):(yield*this.pop(),yield*this.step())}else{let i=this.peek(2);if(i.type==="block-map"&&(this.type==="map-value-ind"&&i.indent===t.indent||this.type==="newline"&&!i.items[i.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&i.type!=="flow-collection"){let r=Ke(i),n=zt(r);Us(t);let a=t.end.splice(1,t.end.length);a.push(this.sourceToken);let o={type:"block-map",offset:t.offset,indent:t.indent,items:[{start:n,key:t,sep:a}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=o}else yield*this.lineEnd(t)}}flowScalar(t){if(this.onNewLine){let e=this.source.indexOf(`
`)+1;for(;e!==0;)this.onNewLine(this.offset+e),e=this.source.indexOf(`
`,e)+1}return{type:t,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(t){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let e=Ke(t),i=zt(e);return i.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i}]}}case"map-value-ind":{this.onKeyLine=!0;let e=Ke(t),i=zt(e);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(t,e){return this.type!=="comment"||this.indent<=e?!1:t.every(i=>i.type==="newline"||i.type==="space")}*documentEnd(t){this.type!=="doc-mode"&&(t.end?t.end.push(this.sourceToken):t.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(t){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:t.end?t.end.push(this.sourceToken):t.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}};function $r(s){let t=s.prettyErrors!==!1;return{lineCounter:s.lineCounter||t&&new de||null,prettyErrors:t}}function zs(s,t={}){let{lineCounter:e,prettyErrors:i}=$r(t),r=new ge(e?.addNewLine),n=new ce(t),a=null;for(let o of n.compose(r.parse(s),!0,s.length))if(!a)a=o;else if(a.options.logLevel!=="silent"){a.errors.push(new K(o.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return i&&e&&(a.errors.forEach(xi(s,e)),a.warnings.forEach(xi(s,e))),a}function Ri(s,t,e){let i;typeof t=="function"?i=t:e===void 0&&t&&typeof t=="object"&&(e=t);let r=zs(s,e);if(!r)return null;if(r.warnings.forEach(n=>Ae(r.options.logLevel,n)),r.errors.length>0){if(r.options.logLevel!=="silent")throw r.errors[0];r.errors=[]}return r.toJS(Object.assign({reviver:i},e))}var rt={month:"m",day:"d",hour:"h",minute:"n",dayWeek:"w"};function Ws(s=new Date){let t=s.getMonth()+1,e=s.getDate(),i=s.getHours(),r=s.getMinutes(),n=s.getDay();return`${rt.month}=${t} ${rt.day}=${e} ${rt.hour}=${i} ${rt.minute}=${r} ${rt.dayWeek}=${n}`}function jr(s){let t=s.match(/(?<start>\d+)-(?<end>\d+)(?:\/(?<step>\d+))?/);if(t==null)return s;let e=[],i=t.groups,r=parseInt(i.start),n=parseInt(i.end),a=parseInt(i.step??1);for(let o=r;o<=n;o+=a)e.push(o);return e.join("|")}function me(s,t){let e={month:"1-12",day:"1-31",hour:"0-23",minute:"0-59",dayWeek:"0-6"};return`(?:${s.replace("*",e[t]).split(",").map(jr).join("|")})`}function zr(s){let t=new Map([["sunday","0"],["monday","1"],["tuesday","2"],["wednesday","3"],["thursday","4"],["friday","5"],["saturday","6"],["sun","0"],["mon","1"],["tue","2"],["wed","3"],["thu","4"],["fri","5"],["sat","6"]]),e=[];for(let[i,r]of s.entries()){if(typeof r=="string"&&(r=[r]),i.match(/ /g)?.length!==4)throw new Error(`Invalid datetime field format: ${i}`);let[n,a,o,l,u]=i.split(" ");if(n=me(n,"minute"),a=me(a,"hour"),o=me(o,"day"),l=me(l,"month"),/[a-zA-Z]/.test(u)){let h=t.get(u.toLowerCase());if(h==null)throw new Error(`Invalid Day of Week format: ${u}`);u=h}u=u.replace("7","0"),u=me(u,"dayWeek");let c=`${rt.month}=${l} ${rt.day}=${o} ${rt.hour}=${a} ${rt.minute}=${n} ${rt.dayWeek}=${u}`;e.push({words:r.map(h=>h.trim()),pattern:new RegExp(c)})}return e}function Oi(){if(!Object.prototype.hasOwnProperty.call(window,"localStorage"))return!1;let s=window.localStorage;try{let t="__storage_test__";return s.setItem(t,t),s.removeItem(t),!0}catch(t){return t instanceof DOMException&&(t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")&&s!=null&&s.length!==0}}function Ni(){let s=navigator.languages??[navigator.language];if(!Oi())return[...s];let t=localStorage.getItem(Vt);return t!=null?[t]:[...s]}function Wr(s){let t=Array.from(s.keys());for(let e of Ni()){if(t.includes(e))return e;let i=e.match(/(?<lang>[a-zA-Z]+)[-_]\w+/);if(i==null){let r=t.find(n=>new RegExp(`^${e}[-_].+`).test(n));if(r!=null)return r}else{let r=i.groups.lang;if(t.includes(r))return r}}return t.includes(Z)?Z:""}function Di(s,t,e){e=e??new Map;let i=[Lt,Et,kt],r=t===""?s:s.get(t)??new Map,n=Array.from(r.keys()).filter(o=>!e.has(o)),a=i.filter(o=>n.includes(o));for(let o of a)e.set(o,r.get(o));return t===""?e:t===Z?Di(s,"",e):Di(s,Z,e)}async function qs(s){let t={general:[],datetime:[],touch:new Map};if(s==="")return{keys:[],words:t};let e=await(await fetch(s)).text(),i=Ri(e,{mapAsMap:!0,merge:!0}),r=Wr(i),n=Di(i,r),a=n.get(Lt)??[],o=typeof a=="string"?[a.trim()]:a.map(m=>m.trim()),l=n.get(kt)??new Map,u=Array.from(l.entries()).reduce((m,[y,g])=>(typeof g=="string"&&(g=[g]),m.set(y,g.map(p=>p.trim()))),new Map),c=n.get(Et)??new Map,h=zr(c),d={general:o,datetime:h,touch:u};return{keys:Array.from(i.keys()),words:Object.assign(t,d)}}function Hs(){document.querySelector(`.${nt}`)==null&&document.body.insertAdjacentHTML("beforeend",Ui)}function Ys(s){if(s==null||s.length===0)return"";let t=document.querySelector("base")?.href??window.location.href.replace(/[^/]*$/,"");return new URL(s,t).href}function qr(s){let t={head:{name:ni.Head},body:{name:ni.Body,group:Gi.TapBody}},e={path:"",words:[],hitTest:t};return typeof s=="string"?Object.assign(e,{path:Ys(s)}):Object.assign(e,{...s,path:Ys(s.path),hitTest:Object.assign(t,s.hitTest)})}function Je(s,t,e){return Math.min(Math.max(t,s),e)}var Qe=class{currentModelIndex;models;modelVisible;modelPosition;modelCoordInitial;slideInFrom;modelDistance;wordsCommon;words;_wordsOrUrl;wordsVisible;useCache;draggable;version;pointerCoord={x:0,y:0};baseWeightArray=[];deviceToScreenMatrix=new L;viewMatrix=new Rt;wordsTimer=0;elemAppRoot=document.querySelector(`.${nt}`);elemContent=this.elemAppRoot.querySelector(`.${It}`);elemWords=this.elemAppRoot.querySelector(`.${Yt}`);elemMenuToggle=this.elemAppRoot.querySelector(`.${ei}`);elemSwitcher=this.elemAppRoot.querySelector(`.${bt}`);elemHider=this.elemAppRoot.querySelector(`.${St}`);elemWordsToggle=this.elemAppRoot.querySelector(`.${ht}`);elemAbout=this.elemAppRoot.querySelector(`.${wt}`);elemLanguage=this.elemAppRoot.querySelector(`.${at}`);elemLanguageOptions=this.elemAppRoot.querySelector(`.${at} select`);elemToast=this.elemAppRoot.querySelector(`.${pe}`);elemRevealer=this.elemAppRoot.querySelector(`.${xt}`);CANVAS=this.elemAppRoot.querySelector("canvas");wordsAnimation;eventRegistered=!1;constructor(t){let e=Object.assign(Qi,t);this.resizeApp(e),e.models.length===0&&console.error(zi),this.models=e.models.map(qr),this.models.length<=1&&this.elemSwitcher.classList.add($i),this.currentModelIndex=0,this.modelPosition=e.modelPosition,this.version=String(e.version),this.modelVisible=e.modelVisible,this.modelVisible?Object.assign(this.elemContent.style,{display:null}):(this.elemRevealer.classList.add(this.modelPosition),this.elemRevealer.style.display="grid"),this._wordsOrUrl=e.words,this.elemWords.classList.add(`${Yt}--${e.wordsPosition.toLowerCase()}`),this.wordsVisible=e.wordsVisible,this.useCache=e.useCache,this.draggable=e.draggable,this.fillUiWithUserLanguage(),this.slideInFrom=e.slideInFrom,this.modelDistance={x:Math.max(0,e.modelDistance.x),y:Math.max(0,e.modelDistance.y)},this.modelCoordInitial=this.calcInitialAppCoord(),Object.assign(this.elemAppRoot.style,this.calcInitialPosition())}init(){}async main(){this.wordsCommon=await this.loadMesseges(this._wordsOrUrl),this.words=await this.updateWordsList(),this.baseWeightArray=Array(this.words.general.length).fill(1),this.modelVisible&&(this.wordsVisible&&this._wordsOrUrl.length>0&&setTimeout(()=>this.startSpeaking(),Yi*1e3),this.appear()),this.registerEvents()}registerEvents(){this.eventRegistered||(window.addEventListener("resize",t=>this.onWindowResize()),document.addEventListener("pointerleave",()=>this.onPointerLeave()),document.addEventListener("pointerup",t=>this.onPointerUp(t)),document.addEventListener("pointercancel",t=>this.onPointerUp(t)),this.elemAppRoot.addEventListener("pointerup",t=>this.onPointerUp(t)),this.elemMenuToggle.addEventListener("pointerup",t=>this.toggleMenu(t)),this.elemHider.addEventListener("pointerup",t=>this.disappear(t)),this.elemRevealer.addEventListener("pointerup",t=>this.appear(t)),this.elemWordsToggle.addEventListener("pointerup",t=>this.toggleWords(t)),this.models.length>=2&&this.elemSwitcher.addEventListener("pointerup",t=>this.switchModel(t)),this.draggable!==!1&&this.elemAppRoot.addEventListener("pointerdown",t=>this.onPointerDown(t)),this.eventRegistered=!0)}resizeApp({width:t,height:e}){(t<si||e<si)&&this.elemAppRoot.classList.add(Fi),t=Je(t,0,window.innerWidth),e=Je(e,0,window.innerHeight),this.elemAppRoot.style.width=`${t}px`,this.elemAppRoot.style.height=`${e}px`}async switchModel(t){t.button===0&&(this.models.length<=1||(this.closeMenu(),this.currentModelIndex=(this.currentModelIndex+1)%this.models.length,this.words=await this.updateWordsList()))}appear(t){if(t!=null&&t.button!==0)return;Object.assign(this.elemContent.style,{display:null}),Object.assign(this.elemRevealer.style,{display:null});let e=this.calcAppearingKeyframes(),i={duration:Xi*1e3,easing:"cubic-bezier(.13,1.22,.87,-0.56)"},r=this.elemAppRoot.animate(e,i),[n,a]=Object.entries(e)[0];r.addEventListener("finish",()=>{Object.assign(this.elemAppRoot.style,{[n]:a[a.length-1]}),this.elemMenuToggle.style.display="grid"})}disappear(t){if(t.button!==0)return;this.toggleMenu(t),this.stopSpeaking();let e=this.calcDisappearingKeyframes(),i={...e,opacity:["1","0"],transform:["scale(1)","scale(0.2)"]},r={duration:Hi*1e3,easing:"ease-out"},n=this.elemAppRoot.animate(i,r),a=Object.entries(e).reduce((o,[l,[u,c]])=>Object.assign(o,{[l]:c}),Object.create(null));n.addEventListener("finish",()=>{Object.assign(this.elemAppRoot.style,a),this.elemContent.style.display="none",this.elemRevealer.classList.add(this.modelPosition),this.elemRevealer.style.display="grid"})}onWindowResize(){this.refreshViewpointMatrix(this.elemAppRoot.getBoundingClientRect()),this.bringBackAppIntoWindow()}bringBackAppIntoWindow(){let{top:t,left:e,width:i,height:r}=this.elemAppRoot.getBoundingClientRect(),{innerWidth:n,innerHeight:a}=window;(t<0||e<0||a<t+r||n<e+i)&&(t<0&&(this.elemAppRoot.style.top="0"),e<0&&(this.elemAppRoot.style.left="0"),a<t+r&&(this.elemAppRoot.style.top=`${a-r}px`),n<e+i&&(this.elemAppRoot.style.left=`${n-i}px`))}onPointerDown(t){if(t.button!=0)return;t.target.tagName==="CANVAS"&&this.elemAppRoot.classList.add(`${qt}`);let{top:e,left:i}=this.elemAppRoot.getBoundingClientRect();this.pointerCoord.x=t.clientX-i,this.pointerCoord.y=t.clientY-e,this.elemAppRoot.style.top=`${e}px`,this.elemAppRoot.style.left=`${i}px`}onPointerMove(t){!this.elemAppRoot.classList.contains(qt)||(t.preventDefault(),this.draggable==="x"?this.elemAppRoot.style.left=`${t.clientX-this.pointerCoord.x}px`:this.draggable==="y"?this.elemAppRoot.style.top=`${t.clientY-this.pointerCoord.y}px`:this.draggable&&(this.elemAppRoot.style.left=`${t.clientX-this.pointerCoord.x}px`,this.elemAppRoot.style.top=`${t.clientY-this.pointerCoord.y}px`),this.bringBackAppIntoWindow())}onPointerLeave(){}onPointerUp(t){this.elemAppRoot.classList.contains(qt)&&(this.elemAppRoot.classList.remove(qt),this.refreshViewpointMatrix(this.elemAppRoot.getBoundingClientRect()))}transformViewX(t){let e=this.deviceToScreenMatrix.transformX(t);return this.viewMatrix.invertTransformX(e)}transformViewY(t){let e=this.deviceToScreenMatrix.transformY(t);return this.viewMatrix.invertTransformY(e)}refreshViewpointMatrix({x:t,y:e}){let{width:i,height:r}=this.elemAppRoot.getBoundingClientRect(),n=new L;n.scale(2/i,-2/r),n.translateRelative(-i/2,-r/2),n.translateRelative(-t,-e),this.deviceToScreenMatrix=n}async loadMesseges(t){if(t==null)return{general:[],datetime:[],touch:new Map};if(t instanceof Array)return{general:t.map(r=>r.trim()),datetime:[],touch:new Map};let{keys:e,words:i}=await qs(t);return this.insertLanguageOptions(e),this.addEventListenerToLanguageOptions(),i}async updateWordsList(){let t=await this.loadMesseges(this.models[this.currentModelIndex].words);return{general:[...this.wordsCommon?.general??[],...t?.general??[]],datetime:[...this.wordsCommon?.datetime??[],...t.datetime??[]],touch:new Map([...this.wordsCommon?.touch??[],...t.touch??[]])}}startSpeaking(){this.wordsAnimation==null?this.wordsAnimation=this.swingWordsWindow():this.wordsAnimation.playState!=="running"&&this.wordsAnimation.play(),this.sayRandomWord(),this.wordsTimer=setInterval(()=>this.sayRandomWord(),Wi*1e3)}stopSpeaking(){this.elemWords.innerText="",this.elemWords.classList.remove(`${Tt}`),this.wordsAnimation?.cancel(),clearInterval(this.wordsTimer)}toggleWords(t){t.button===0&&(this.wordsVisible=!this.wordsVisible,this.fillUiWithUserLanguage(),this.wordsVisible?this.startSpeaking():this.stopSpeaking())}sayWhenTouched(t){if(this.words==null||!this.wordsVisible)return;let e=this.words.touch.get(t)??[],i=Math.floor(Math.random()*e.length);e[i]!=null&&(this.elemWords.innerText=e[i],this.elemWords.classList.add(Tt))}sayRandomWord(){if(this.words==null)return;if(this.elemWords.classList.contains(Tt)){this.elemWords.classList.remove(Tt);return}let t=this.words.datetime.filter(a=>a.pattern.test(Ws())).map(a=>a.words).flat(),e=this.words.general.concat(t),i=this.baseWeightArray.concat(Array(t.length).fill(Ki)),r=i.reduce((a,o)=>a+o,0),n=this.searchWeightedList(i)(Math.random()*r);e[n]!=null&&(this.elemWords.innerText=e[n],this.elemWords.classList.add(Tt))}searchWeightedList(t){let e=t.reduce((i,r)=>[...i,r+i[i.length-1]],[0]);return i=>{let r=0,n=e.length,a=Math.round((r+n)/2);for(;n!==a&&r!==n;)e[a]<i?r=a:n=a,a=Math.round((r+n)/2);return a-1}}isMenuOpen(){return this.elemMenuToggle.classList.contains(Ht)}closeMenu(){this.elemMenuToggle.classList.remove(Ht)}toggleMenu(t){t.button===0&&(this.isMenuOpen()?this.elemMenuToggle.classList.remove(Ht):this.elemMenuToggle.classList.add(Ht))}calcInitialAppCoord(){let{width:t,height:e}=this.elemAppRoot.getBoundingClientRect(),{innerWidth:i,innerHeight:r}=window,{x:n,y:a}=this.modelDistance;n=n>1?n:n*i,a=a>1?a:a*r;let o=this.modelPosition.includes("left")?n:i-t-n,l=this.modelPosition.includes("top")?a:r-e-a;return{x:Je(o,0,window.innerWidth),y:Je(l,0,window.innerHeight)}}calcInitialPosition(){let{width:t,height:e}=this.elemAppRoot.getBoundingClientRect(),{innerWidth:i,innerHeight:r}=window,{x:n,y:a}=this.calcInitialAppCoord();switch(this.slideInFrom){case fe:return{top:`${-e}px`,left:`${n}px`};case Xt:return{top:`${r}px`,left:`${n}px`};case ye:return{top:`${a}px`,left:`${-t}px`};case _e:return{top:`${a}px`,left:`${i}px`}}}calcAppearingKeyframes(){let{width:t,height:e}=this.elemAppRoot.getBoundingClientRect(),{innerWidth:i,innerHeight:r}=window,{x:n,y:a}=this.calcInitialAppCoord();switch(this.slideInFrom){case fe:return{top:[`${-e}px`,`${e*.3}px`,`${a}px`]};case Xt:return{top:[`${r}px`,`${r-e*.3}px`,`${a}px`]};case ye:return{left:[`${-t}px`,`${t*.3}px`,`${n}px`]};case _e:return{left:[`${i}px`,`${i-t*.3}px`,`${n}px`]}}}calcDisappearingKeyframes(){let{top:t,left:e,width:i,height:r}=this.elemAppRoot.getBoundingClientRect(),{innerWidth:n,innerHeight:a}=window,{x:o,y:l}=this.calcInitialAppCoord();switch(this.slideInFrom){case fe:return{top:[`${t}px`,`${-r}px`],left:[`${e}px`,`${o}px`]};case Xt:return{top:[`${t}px`,`${a}px`],left:[`${e}px`,`${o}px`]};case ye:return{top:[`${t}px`,`${l}px`],left:[`${e}px`,`${-i}px`]};case _e:return{top:[`${t}px`,`${l}px`],left:[`${e}px`,`${n}px`]}}}swingWordsWindow(){let t={transform:[[0,0,0],[1,-3,-1],[1,3,3],[3,3,3],[4,3,1],[1,4,1],[3,3,1],[1,1,1],[-3,-1,3],[1,1,3],[4,4,3],[1,-3,3],[-3,3,-1],[3,1,3],[-1,-1,-1],[3,-1,-1],[4,-3,3],[4,4,-1],[1,-3,1],[4,-1,-1],[-1,4,1],[-3,4,1],[-3,3,1],[3,-1,-1],[4,-1,1],[-3,3,1],[-1,3,1],[-3,3,1],[1,4,3],[4,4,1],[4,-3,3],[-3,1,3],[-3,3,3],[1,4,3],[4,-3,3],[4,4,1],[-1,-3,3],[-3,4,3],[-3,4,3],[-3,4,1],[-3,1,-1],[-3,1,-1],[-1,1,3],[4,3,1],[-3,1,3],[-3,-1,-1],[-3,-3,3],[1,1,-1],[4,-1,-1],[-3,-3,-1]].map(([i,r,n])=>`translate(${i}px, ${r}px) rotate(${n}deg)`)},e={duration:qi*1e3,easing:"ease-in-out",iterations:1/0};return this.elemWords.animate(t,e)}fillUiWithUserLanguage(){let t=Zi(Ni()[0]);this.elemSwitcher.querySelector("p").innerText=t[bt],this.elemHider.querySelector("p").innerText=t[St],this.wordsVisible?this.elemWordsToggle.querySelector("p").innerText=t[ht].turnOff:this.elemWordsToggle.querySelector("p").innerText=t[ht].turnOn,this.elemLanguage.querySelector("p").innerText=t[at],this.elemAbout.querySelector("p").innerText=t[wt],this.elemRevealer.querySelector("p").innerText=t[xt]}addEventListenerToLanguageOptions(){this.elemToast.addEventListener("animationend",()=>this.elemToast.classList.remove(ii)),this.elemLanguageOptions.addEventListener("change",t=>{let e=t.target.value;Oi()&&(e===ri?localStorage.removeItem(Vt):localStorage.setItem(Vt,e),this.elemToast.classList.add(ii)),this.fillUiWithUserLanguage()})}insertLanguageOptions(t){let e=[],i=[Lt,Et,kt];t=t.filter(n=>n!==Ji).sort(),t.includes(Z)?(e.push(Z),e.push(...t.filter(n=>n!==Z&&!i.includes(n)))):(t.includes(Lt)||t.includes(Et)||t.includes(kt))&&(e.push(Z),e.push(...t.filter(n=>!i.includes(n))));for(let n=0;n<e.length;n++)e[n].includes("-")&&e[n].toLowerCase().replace("-","_")===e[n+1].toLowerCase()&&e.splice(n+1,1);let r=localStorage.getItem(Vt)??"";this.elemLanguageOptions.insertAdjacentHTML("beforeend",`<option value="${ri}" ${e.includes(r)?"selected":""}>(Unset)</option>`);for(let n of e){let a=n===r?"selected":"";this.elemLanguageOptions.insertAdjacentHTML("beforeend",`<option value="${n}" ${a}>${n}</option>`)}}};var Ze=class extends Qe{init(){let{clientWidth:t,clientHeight:e}=this.elemAppRoot,i=this.CANVAS.transferControlToOffscreen();_t.postMessage([{task:"offscreenCanvas",args:{canvas:i}},{task:"resizeCanvas",args:{width:t,height:e}},{task:"load",args:{model:this.models[this.currentModelIndex],version:this.version}}],[i])}async main(){await super.main(),_t.postMessage([{task:"start",args:{}}])}async onModelLoad(){this.refreshViewpointMatrix(this.modelCoordInitial),this.bringBackAppIntoWindow(),await this.main()}registerEvents(){document.addEventListener("pointermove",t=>this.onPointerMove(t)),super.registerEvents()}async switchModel(t){await super.switchModel(t);let{clientWidth:e,clientHeight:i}=this.elemAppRoot;_t.postMessage([{task:"resizeCanvas",args:{width:e,height:i}},{task:"release"},{task:"load",args:{model:this.models[this.currentModelIndex],version:this.version}}])}onPointerMove(t){if(this.isMenuOpen())return;let e=this.transformViewX(t.x),i=this.transformViewY(t.y);_t.postMessage([{task:"lookAt",args:{viewX:e,viewY:i}},{task:"touch",args:{viewX:e,viewY:i}}]),super.onPointerMove(t)}onPointerLeave(){_t.postMessage([{task:"lookAt",args:{viewX:0,viewY:0}}]),super.onPointerLeave()}onWindowResize(){let{clientWidth:t,clientHeight:e}=this.elemAppRoot;_t.postMessage([{task:"resizeCanvas",args:{width:t,height:e}}]),super.onWindowResize()}};if(!Object.prototype.hasOwnProperty.call(window,"fetch")||!Object.prototype.hasOwnProperty.call(window,"caches"))throw new Error(ji);var _t=oi();function Yr(s){Hs();let t=new Ze(s);_t.onmessage=async e=>{let{task:i,args:r}=e.data;if(i==="load")return await t.onModelLoad();if(i==="touch")return t.sayWhenTouched(r.part)},t.init()}Yr(companionOption);})();
